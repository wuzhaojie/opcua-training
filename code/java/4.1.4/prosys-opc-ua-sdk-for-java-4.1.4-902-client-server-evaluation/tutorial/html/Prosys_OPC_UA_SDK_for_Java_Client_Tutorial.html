<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<meta name="author" content="Client Tutorial">
<title>Prosys OPC UA SDK for Java</title>
<style>
 article,
 aside,
 details,
 figcaption,
 figure,
 footer,
 header,
 hgroup,
 main,
 nav,
 section,
 summary {
     display: block
 }

 audio,
 canvas,
 video {
     display: inline-block
 }

 audio:not([controls]) {
     display: none;
     height: 0
 }

 [hidden],
 template {
     display: none
 }

 script {
     display: none!important
 }

 html {
     font-family: sans-serif;
     -ms-text-size-adjust: 100%;
     -webkit-text-size-adjust: 100%
 }

 a {
     background: transparent
 }

 a:focus {
     outline: thin dotted
 }

 a:active,
 a:hover {
     outline: 0
 }

 h1 {
     font-size: 2em;
     margin: .67em 0
 }

 abbr[title] {
     border-bottom: 1px dotted
 }

 b,
 strong {
     font-weight: bold
 }

 dfn {
     font-style: italic
 }

 hr {
     -moz-box-sizing: content-box;
     box-sizing: content-box;
     height: 0
 }

 mark {
     background: #ff0;
     color: #000
 }

 code,
 kbd,
 pre,
 samp {
     font-family: monospace;
     font-size: 1em
 }

 pre {
     white-space: pre-wrap
 }

 q {
     quotes: "\201C" "\201D" "\2018" "\2019"
 }

 small {
     font-size: 80%
 }

 sub,
 sup {
     font-size: 75%;
     line-height: 0;
     position: relative;
     vertical-align: baseline
 }

 sup {
     top: -.5em
 }

 sub {
     bottom: -.25em
 }

 img {
     border: 0
 }

 svg:not(:root) {
     overflow: hidden
 }

 figure {
     margin: 0
 }

 fieldset {
     border: 1px solid silver;
     margin: 0 2px;
     padding: .35em .625em .75em
 }

 legend {
     border: 0;
     padding: 0
 }

 button,
 input,
 select,
 textarea {
     font-family: inherit;
     font-size: 100%;
     margin: 0
 }

 button,
 input {
     line-height: normal
 }

 button,
 select {
     text-transform: none
 }

 button,
 html input[type="button"],
 input[type="reset"],
 input[type="submit"] {
     -webkit-appearance: button;
     cursor: pointer
 }

 button[disabled],
 html input[disabled] {
     cursor: default
 }

 input[type="checkbox"],
 input[type="radio"] {
     box-sizing: border-box;
     padding: 0
 }

 input[type="search"] {
     -webkit-appearance: textfield;
     -moz-box-sizing: content-box;
     -webkit-box-sizing: content-box;
     box-sizing: content-box
 }

 input[type="search"]::-webkit-search-cancel-button,
 input[type="search"]::-webkit-search-decoration {
     -webkit-appearance: none
 }

 button::-moz-focus-inner,
 input::-moz-focus-inner {
     border: 0;
     padding: 0
 }

 textarea {
     overflow: auto;
     vertical-align: top
 }

 table {
     border-collapse: collapse;
     border-spacing: 0
 }

 *,
 *:before,
 *:after {
     -moz-box-sizing: border-box;
     -webkit-box-sizing: border-box;
     box-sizing: border-box
 }

 html,
 body {
     font-size: 100%
 }

 body {
     background: #fff;
     color: rgba(0, 0, 0, .8);
     padding: 0;
     margin: 0;
     font-family: "Open Sans", "DejaVu Sans", sans-serif;
     font-weight: normal;
     font-style: normal;
     /*            line-height: 1;*/
     position: relative;
     cursor: auto;
     tab-size: 4;
     -moz-osx-font-smoothing: grayscale;
     -webkit-font-smoothing: antialiased
 }

 a:hover {
     cursor: pointer
 }

 img,
 object,
 embed {
     max-width: 100%;
     height: auto
 }

 object,
 embed {
     height: 100%
 }

 img {
     -ms-interpolation-mode: bicubic
 }

 .left {
     float: left!important
 }

 .right {
     float: right!important
 }

 .text-left {
     text-align: left!important
 }

 .text-right {
     text-align: right!important
 }

 .text-center {
     text-align: center!important
 }

 .text-justify {
     text-align: justify!important
 }

 .hide {
     display: none
 }

 img,
 object,
 svg {
     display: inline-block;
     vertical-align: middle;
     margin-top: 1em;
 }

 textarea {
     height: auto;
     min-height: 50px
 }

 select {
     width: 100%
 }

 .center {
     margin-left: auto;
     margin-right: auto
 }

 .spread {
     width: 100%
 }

 /*
        p.lead,
        .paragraph.lead>p,
        #preamble>.sectionbody>.paragraph:first-of-type p {
            font-size: 1.21875em;
            line-height: 1.6
        }
*/

 .subheader,
 .admonitionblock td.content > .title,
 .audioblock > .title,
 .exampleblock > .title,
 .imageblock > .title,
 .listingblock > .title,
 .literalblock > .title,
 .stemblock > .title,
 .openblock > .title,
 .paragraph > .title,
 .quoteblock > .title,
 table.tableblock > .title,
 .verseblock > .title,
 .videoblock > .title,
 .dlist > .title,
 .olist > .title,
 .ulist > .title,
 .qlist > .title,
 .hdlist > .title {
     line-height: 1.45;
     color: #004c97;
     /*            font-weight: 400;*/
     margin-top: .3em;
     margin-bottom: .25em
 }

 div,
 dl,
 dt,
 dd,
 ul,
 ol,
 li,
 h1,
 h2,
 h3,
 #toctitle,
 .sidebarblock > .content > .title,
 h4,
 h5,
 h6,
 pre,
 form,
 p,
 blockquote,
 th,
 td {
     margin: 0;
     padding: 0;
     direction: ltr
 }

 a {
     color: #2156a5;
     text-decoration: underline;
     line-height: inherit
 }

 a:hover,
 a:focus {
     color: #1d4b8f
 }

 a img {
     border: none
 }

 p {
     font-family: inherit;
     font-weight: normal;
     font-size: 1em;
     /*            changed*/
     line-height: 1.5em;
     margin-bottom: 1.25em;
     text-rendering: optimizeLegibility
 }

 p aside {
     font-size: .875em;
     line-height: 1.35;
     font-style: italic
 }

 h1,
 h2,
 h3,
 #toctitle,
 .sidebarblock > .content > .title,
 h4,
 h5,
 h6 {
     font-family: "Open Sans", "DejaVu Sans", sans-serif;
     font-weight: normal;
     font-style: normal;
     color: #004c97;
     text-rendering: optimizeLegibility;
     margin-top: 1em;
     margin-bottom: .5em;
     line-height: 1.0125em
 }

 h1 small,
 h2 small,
 h3 small,
 #toctitle small,
 .sidebarblock > .content > .title small,
 h4 small,
 h5 small,
 h6 small {
     font-size: 60%;
     color: #e99b8f;
     line-height: 0
 }

 h1 {
     font-size: 2.125em
 }

 h2 {
     font-size: 1.6875em
     color: black;
 }

 h3,
 #toctitle,
 .sidebarblock > .content > .title {
     font-size: 1.375em
 }

 h4,
 h5 {
     font-size: 1.125em
 }

 h6 {
     font-size: 1em
 }

 hr {
     border: solid #ddddd8;
     border-width: 1px 0 0;
     clear: both;
     margin: 1.25em 0 1.1875em;
     height: 0
 }

 em,
 i {
     font-style: italic;
     line-height: inherit
 }

 strong,
 b {
     font-weight: bold;
     line-height: inherit
 }

 small {
     font-size: 60%;
     line-height: inherit
 }

 code {
     font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace;
     font-weight: 400;
     color: rgba(0, 0, 0, .9)
 }

 ul,
 ol,
 dl {
     font-size: 1em;
     /*            changed*/
     line-height: 1.5em;
     margin-bottom: 1.25em;
     list-style-position: outside;
     font-family: inherit
 }

 ul,
 ol {
     margin-left: 1.5em
 }

 ul li ul,
 ul li ol {
     margin-left: 1.25em;
     margin-bottom: 0;
     font-size: 1em
 }

 ul.square li ul,
 ul.circle li ul,
 ul.disc li ul {
     list-style: inherit
 }

 ul.square {
     list-style-type: square
 }

 ul.circle {
     list-style-type: circle
 }

 ul.disc {
     list-style-type: disc
 }

 ol li ul,
 ol li ol {
     margin-left: 1.25em;
     margin-bottom: 0
 }

 dl dt {
     margin-bottom: .3125em;
     font-weight: bold
 }

 dl dd {
     margin-bottom: 1.25em
 }

 abbr,
 acronym {
     text-transform: uppercase;
     font-size: 90%;
     color: rgba(0, 0, 0, .8);
     border-bottom: 1px dotted #ddd;
     cursor: help
 }

 abbr {
     text-transform: none
 }

 blockquote {
     margin: 0 0 1.25em;
     padding: .5625em 1.25em 0 1.1875em;
     border-left: 1px solid #ddd
 }

 blockquote cite {
     display: block;
     font-size: .9375em;
     color: rgba(0, 0, 0, .6)
 }

 blockquote cite:before {
     content: "\2014 \0020"
 }

 blockquote cite a,
 blockquote cite a:visited {
     color: rgba(0, 0, 0, .6)
 }

 blockquote,
 blockquote p {
     /*            changed*/
     line-height: 1.5em;
     color: rgba(0, 0, 0, .85)
 }

 @media only screen and (min-width:768px) {
     h1,
     h2,
     h3,
     #toctitle,
     .sidebarblock > .content > .title,
     h4,
     h5,
     h6 {
         line-height: 1.2
     }
     h1 {
         font-size: 2.75em
     }
     h2 {
         font-size: 2.3125em
     }
     h3,
     #toctitle,
     .sidebarblock > .content > .title {
         font-size: 1.6875em
     }
     h4 {
         font-size: 1.4375em
     }
 }

 table {
     background: #fff;
     margin-bottom: 1.25em;
     border: solid 1px #dedede
 }

 table thead,
 table tfoot {
     background: #f7f8f7;
     font-weight: bold
 }

 table thead tr th,
 table thead tr td,
 table tfoot tr th,
 table tfoot tr td {
     padding: .5em .625em .625em;
     font-size: inherit;
     color: rgba(0, 0, 0, .8);
     text-align: left
 }

 table tr th,
 table tr td {
     padding: .5625em .625em;
     font-size: inherit;
     color: rgba(0, 0, 0, .8)
 }

 table tr.even,
 table tr.alt,
 table tr:nth-of-type(even) {
     background: #f8f8f7
 }

 table thead tr th,
 table tfoot tr th,
 table tbody tr td,
 table tr td,
 table tfoot tr td {
     display: table-cell;
     line-height: 1.6
 }

 h1,
 h2,
 h3,
 #toctitle,
 .sidebarblock > .content > .title,
 h4,
 h5,
 h6 {
     line-height: 1.2;
     /*            word-spacing: -.05em*/
 }

 h1 strong,
 h2 strong,
 h3 strong,
 #toctitle strong,
 .sidebarblock > .content > .title strong,
 h4 strong,
 h5 strong,
 h6 strong {
     font-weight: 400
 }

 .clearfix:before,
 .clearfix:after,
 .float-group:before,
 .float-group:after {
     content: " ";
     display: table
 }

 .clearfix:after,
 .float-group:after {
     clear: both
 }

 *:not(pre) > code {
     font-size: .9375em;
     font-style: normal!important;
     letter-spacing: 0;
     padding: .1em .5ex;
     /*            word-spacing: -.15em;*/
     background-color: #f7f7f8;
     -webkit-border-radius: 4px;
     border-radius: 4px;
     line-height: 1.45;
     text-rendering: optimizeSpeed;
     word-wrap: break-word
 }

 *:not(pre) > code.nobreak {
     word-wrap: normal
 }

 *:not(pre) > code.nowrap {
     white-space: nowrap
 }

 pre,
 pre > code {
     line-height: 1.45;
     color: rgba(0, 0, 0, .9);
     font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace;
     font-weight: 400;
     text-rendering: optimizeSpeed
 }

 em em {
     font-style: normal
 }

 strong strong {
     font-weight: 400
 }

 .keyseq {
     color: rgba(51, 51, 51, .8)
 }

 kbd {
     font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace;
     display: inline-block;
     color: rgba(0, 0, 0, .8);
     font-size: .65em;
     line-height: 1.45;
     background-color: #f7f7f7;
     border: 1px solid #ccc;
     -webkit-border-radius: 3px;
     border-radius: 3px;
     -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em white inset;
     box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em #fff inset;
     margin: 0 .15em;
     padding: .2em .5em;
     vertical-align: middle;
     position: relative;
     top: -.1em;
     white-space: nowrap
 }

 .keyseq kbd:first-child {
     margin-left: 0
 }

 .keyseq kbd:last-child {
     margin-right: 0
 }

 .menuseq,
 .menuref {
     color: #000
 }

 .menuseq b:not(.caret),
 .menuref {
     font-weight: inherit
 }

 .menuseq {
     word-spacing: -.02em
 }

 .menuseq b.caret {
     font-size: 1.25em;
     line-height: .8
 }

 .menuseq i.caret {
     font-weight: bold;
     text-align: center;
     width: .45em
 }

 b.button:before,
 b.button:after {
     position: relative;
     top: -1px;
     font-weight: 400
 }

 b.button:before {
     content: "[";
     padding: 0 3px 0 2px
 }

 b.button:after {
     content: "]";
     padding: 0 2px 0 3px
 }

 p a > code:hover {
     color: rgba(0, 0, 0, .9)
 }

 #header,
 #content,
 #footnotes,
 #footer {
     width: 100%;
     margin-left: auto;
     margin-right: auto;
     margin-top: 0;
     margin-bottom: 0;
     max-width: 62.5em;
     *zoom: 1;
     position: relative;
     padding-left: .9375em;
     padding-right: .9375em
 }

 #header:before,
 #header:after,
 #content:before,
 #content:after,
 #footnotes:before,
 #footnotes:after,
 #footer:before,
 #footer:after {
     content: " ";
     display: table
 }

 #header:after,
 #content:after,
 #footnotes:after,
 #footer:after {
     clear: both
 }

 #content {
     margin-top: 1.25em;
     font-family: "Open Sans", sans-serif;
 }

 #content:before {
     content: none
 }

 #header > h1:first-child {
     color: rgba(0, 0, 0, .85);
     margin-top: 2.25rem;
     margin-bottom: 0
 }

 #header > h1:first-child + #toc {
     margin-top: 8px;
     border-top: 1px solid #ddddd8
 }

 #header > h1:only-child,
 body.toc2 #header > h1:nth-last-child(2) {
     border-bottom: 1px solid #ddddd8;
     padding-bottom: 8px
 }

 #header .details {
     border-bottom: 1px solid #ddddd8;
     line-height: 1.45;
     padding-top: .35em;
     padding-bottom: .25em;
     padding-left: .25em;
     color: rgba(0, 0, 0, 1);
     display: -ms-flexbox;
     display: -webkit-flex;
     display: flex;
     -ms-flex-flow: row wrap;
     -webkit-flex-flow: row wrap;
     flex-flow: row wrap
 }

 #header .details span:first-child {
     margin-left: -.125em
 }

 #header .details span.email a {
     color: rgba(0, 0, 0, .85)
 }

 #header .details br {
     display: none
 }

 #header .details br + span:before {
     content: "\00a0\2013\00a0"
 }

 #header .details br + span.author:before {
     content: "\00a0\22c5\00a0";
     color: rgba(0, 0, 0, .85)
 }

 #header .details br + span#revremark:before {
     content: "\00a0|\00a0"
 }

 #header #revnumber {
     text-transform: capitalize
 }

 #header #revnumber:after {
     content: "\00a0"
 }

 #content > h1:first-child:not([class]) {
     color: rgba(0, 0, 0, .85);
     border-bottom: 1px solid #ddddd8;
     padding-bottom: 8px;
     margin-top: 0;
     padding-top: 1rem;
     margin-bottom: 1.25rem
 }

 #toc {
     border-bottom: 1px solid #efefed;
     padding-bottom: .5em
 }

 #toc > ul {
     margin-left: .125em
 }

 #toc ul.sectlevel0 > li > a {
     font-style: italic
 }

 #toc ul.sectlevel0 ul.sectlevel1 {
     margin: .5em 0
 }

 #toc ul {
     font-family: "Open Sans", "DejaVu Sans", sans-serif;
     list-style-type: none
 }

 #toc li {
     line-height: 1.3334;
     margin-top: .3334em
 }

 #toc a {
     text-decoration: none
 }

 #toc a:active {
     text-decoration: underline
 }

 #toctitle {
     color: #111;
     font-size: 1.2em
 }

 @media only screen and (min-width:768px) {
     #toctitle {
         font-size: 1.375em
     }
     body.toc2 {
         padding-left: 15em;
         padding-right: 0
     }
     #toc.toc2 {
         margin-top: 0!important;
         background-color: #f8f8f7;
         position: fixed;
         width: 15em;
         left: 0;
         top: 0;
         border-right: 1px solid #efefed;
         border-top-width: 0!important;
         border-bottom-width: 0!important;
         z-index: 1000;
         padding: 1.25em 1em;
         height: 100%;
         overflow: auto
     }
     #toc.toc2 #toctitle {
         margin-top: 0;
         margin-bottom: .8rem;
         font-size: 1.2em
     }
     #toc.toc2 > ul {
         font-size: .9em;
         margin-bottom: 0
     }
     #toc.toc2 ul ul {
         margin-left: 0;
         padding-left: 1em
     }
     #toc.toc2 ul.sectlevel0 ul.sectlevel1 {
         padding-left: 0;
         margin-top: .5em;
         margin-bottom: .5em
     }
     body.toc2.toc-right {
         padding-left: 0;
         padding-right: 15em
     }
     body.toc2.toc-right #toc.toc2 {
         border-right-width: 0;
         border-left: 1px solid #efefed;
         left: auto;
         right: 0
     }
 }

 @media only screen and (min-width:1280px) {
     body.toc2 {
         padding-left: 20em;
         padding-right: 0
     }
     #toc.toc2 {
         width: 20em
     }
     #toc.toc2 #toctitle {
         font-size: 1.375em
     }
     #toc.toc2 > ul {
         font-size: .95em
     }
     #toc.toc2 ul ul {
         padding-left: 1.25em
     }
     body.toc2.toc-right {
         padding-left: 0;
         padding-right: 20em
     }
 }

 #content #toc {
     border-style: solid;
     border-width: 1px;
     border-color: #e0e0dc;
     margin-bottom: 1.25em;
     padding: 1.25em;
     background: #f8f8f7;
     -webkit-border-radius: 4px;
     border-radius: 4px
 }

 #content #toc > :first-child {
     margin-top: 0
 }

 #content #toc > :last-child {
     margin-bottom: 0
 }

 #footer {
     max-width: 100%;
     background-color: rgba(0, 0, 0, .8);
     padding: 1.25em
 }

 #footer-text {
     color: rgba(255, 255, 255, .8);
     line-height: 1.44
 }

 .sect1 {
     padding-bottom: .625em
 }

 @media only screen and (min-width:768px) {
     .sect1 {
         padding-bottom: 1.25em
     }
 }

 .sect1 + .sect1 {
     border-top: 1px solid #efefed
 }

 #content h1 > a.anchor,
 h2 > a.anchor,
 h3 > a.anchor,
 #toctitle > a.anchor,
 .sidebarblock > .content > .title > a.anchor,
 h4 > a.anchor,
 h5 > a.anchor,
 h6 > a.anchor {
     position: absolute;
     z-index: 1001;
     width: 1.5ex;
     margin-left: -1.5ex;
     display: block;
     text-decoration: none!important;
     visibility: hidden;
     text-align: center;
     font-weight: 400
 }

 #content h1 > a.anchor:before,
 h2 > a.anchor:before,
 h3 > a.anchor:before,
 #toctitle > a.anchor:before,
 .sidebarblock > .content > .title > a.anchor:before,
 h4 > a.anchor:before,
 h5 > a.anchor:before,
 h6 > a.anchor:before {
     content: "\00A7";
     font-size: .85em;
     display: block;
     padding-top: .1em
 }

 #content h1:hover > a.anchor,
 #content h1 > a.anchor:hover,
 h2:hover > a.anchor,
 h2 > a.anchor:hover,
 h3:hover > a.anchor,
 #toctitle:hover > a.anchor,
 .sidebarblock > .content > .title:hover > a.anchor,
 h3 > a.anchor:hover,
 #toctitle > a.anchor:hover,
 .sidebarblock > .content > .title > a.anchor:hover,
 h4:hover > a.anchor,
 h4 > a.anchor:hover,
 h5:hover > a.anchor,
 h5 > a.anchor:hover,
 h6:hover > a.anchor,
 h6 > a.anchor:hover {
     visibility: visible
 }

 #content h1 > a.link,
 h2 > a.link,
 h3 > a.link,
 #toctitle > a.link,
 .sidebarblock > .content > .title > a.link,
 h4 > a.link,
 h5 > a.link,
 h6 > a.link {
     color: #;
     text-decoration: none
 }

 #content h1 > a.link:hover,
 h2 > a.link:hover,
 h3 > a.link:hover,
 #toctitle > a.link:hover,
 .sidebarblock > .content > .title > a.link:hover,
 h4 > a.link:hover,
 h5 > a.link:hover,
 h6 > a.link:hover {
     color: #a53221
 }

 .audioblock,
 .imageblock,
 .literalblock,
 .listingblock,
 .stemblock,
 .videoblock {
     margin-bottom: 1.25em
 }

 .admonitionblock td.content > .title,
 .audioblock > .title,
 .exampleblock > .title,
 .imageblock > .title,
 .listingblock > .title,
 .literalblock > .title,
 .stemblock > .title,
 .openblock > .title,
 .paragraph > .title,
 .quoteblock > .title,
 table.tableblock > .title,
 .verseblock > .title,
 .videoblock > .title,
 .dlist > .title,
 .olist > .title,
 .ulist > .title,
 .qlist > .title,
 .hdlist > .title {
     text-rendering: optimizeLegibility;
     text-align: left;
     font-family: "Open Sans", "DejaVu Sans", sans-serif;
     font-size: 1rem;
     font-style: italic
 }

 table.tableblock > caption.title {
     white-space: nowrap;
     overflow: visible;
     max-width: 0
 }

 .paragraph.lead > p,
 #preamble > .sectionbody > .paragraph:first-of-type p {
     color: rgba(0, 0, 0, .85)
 }

 table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p {
     font-size: inherit
 }

 .admonitionblock > table {
     border-collapse: separate;
     border: 0;
     background: none;
     width: 100%
 }

 .admonitionblock > table td.icon {
     text-align: center;
     width: 80px
 }

 .admonitionblock > table td.icon img {
     max-width: initial
 }

 .admonitionblock > table td.icon .title {
     font-weight: bold;
     font-family: "Open Sans", "DejaVu Sans", sans-serif;
     text-transform: uppercase
 }

 .admonitionblock > table td.content {
     padding-left: 1.125em;
     padding-right: 1.25em;
     border-left: 1px solid #ddddd8;
     color: rgba(0, 0, 0, .6)
 }

 .admonitionblock > table td.content > :last-child > :last-child {
     margin-bottom: 0
 }

 .exampleblock > .content {
     border-style: solid;
     border-width: 1px;
     border-color: #e6e6e6;
     margin-bottom: 1.25em;
     padding: 1.25em;
     background: #fff;
     -webkit-border-radius: 4px;
     border-radius: 4px
 }

 .exampleblock > .content > :first-child {
     margin-top: 0
 }

 .exampleblock > .content > :last-child {
     margin-bottom: 0
 }

 .sidebarblock {
     border-style: solid;
     border-width: 1px;
     border-color: #e0e0dc;
     margin-bottom: 1.25em;
     padding: 1.25em;
     background: #f8f8f7;
     -webkit-border-radius: 4px;
     border-radius: 4px
 }

 .sidebarblock > :first-child {
     margin-top: 0
 }

 .sidebarblock > :last-child {
     margin-bottom: 0
 }

 .sidebarblock > .content > .title {
     color: #7a2518;
     margin-top: 0;
     text-align: center
 }

 .exampleblock > .content > :last-child > :last-child,
 .exampleblock > .content .olist > ol > li:last-child > :last-child,
 .exampleblock > .content .ulist > ul > li:last-child > :last-child,
 .exampleblock > .content .qlist > ol > li:last-child > :last-child,
 .sidebarblock > .content > :last-child > :last-child,
 .sidebarblock > .content .olist > ol > li:last-child > :last-child,
 .sidebarblock > .content .ulist > ul > li:last-child > :last-child,
 .sidebarblock > .content .qlist > ol > li:last-child > :last-child {
     margin-bottom: 0
 }

 .literalblock pre,
 .listingblock pre:not(.highlight),
 .listingblock pre[class="highlight"],
 .listingblock pre[class^="highlight "],
 .listingblock pre.CodeRay,
 .listingblock pre.prettyprint {
     background: #f7f7f8
 }

 .sidebarblock .literalblock pre,
 .sidebarblock .listingblock pre:not(.highlight),
 .sidebarblock .listingblock pre[class="highlight"],
 .sidebarblock .listingblock pre[class^="highlight "],
 .sidebarblock .listingblock pre.CodeRay,
 .sidebarblock .listingblock pre.prettyprint {
     background: #f2f1f1
 }

 .literalblock pre,
 .literalblock pre[class],
 .listingblock pre,
 .listingblock pre[class] {
     -webkit-border-radius: 4px;
     border-radius: 4px;
     word-wrap: break-word;
     padding: 1em;
     font-size: .8125em
 }

 .literalblock pre.nowrap,
 .literalblock pre[class].nowrap,
 .listingblock pre.nowrap,
 .listingblock pre[class].nowrap {
     overflow-x: auto;
     white-space: pre;
     word-wrap: normal
 }

 @media only screen and (min-width:768px) {
     .literalblock pre,
     .literalblock pre[class],
     .listingblock pre,
     .listingblock pre[class] {
         font-size: .90625em
     }
 }

 @media only screen and (min-width:1280px) {
     .literalblock pre,
     .literalblock pre[class],
     .listingblock pre,
     .listingblock pre[class] {
         font-size: 1em
     }
 }

 .literalblock.output pre {
     color: #f7f7f8;
     background-color: rgba(0, 0, 0, .9)
 }

 .listingblock pre.highlightjs {
     padding: 0
 }

 .listingblock pre.highlightjs > code {
     padding: 1em;
     -webkit-border-radius: 4px;
     border-radius: 4px
 }

 .listingblock pre.prettyprint {
     border-width: 0
 }

 .listingblock > .content {
     position: relative
 }

 .listingblock code[data-lang]:before {
     display: none;
     content: attr(data-lang);
     position: absolute;
     font-size: .75em;
     top: .425rem;
     right: .5rem;
     line-height: 1;
     text-transform: uppercase;
     color: #999
 }

 .listingblock:hover code[data-lang]:before {
     display: block
 }

 .listingblock.terminal pre .command:before {
     content: attr(data-prompt);
     padding-right: .5em;
     color: #999
 }

 .listingblock.terminal pre .command:not([data-prompt]):before {
     content: "$"
 }

 table.pyhltable {
     border-collapse: separate;
     border: 0;
     margin-bottom: 0;
     background: none
 }

 table.pyhltable td {
     vertical-align: top;
     padding-top: 0;
     padding-bottom: 0;
     line-height: 1.45
 }

 table.pyhltable td.code {
     padding-left: .75em;
     padding-right: 0
 }

 pre.pygments .lineno,
 table.pyhltable td:not(.code) {
     color: #999;
     padding-left: 0;
     padding-right: .5em;
     border-right: 1px solid #ddddd8
 }

 pre.pygments .lineno {
     display: inline-block;
     margin-right: .25em
 }

 table.pyhltable .linenodiv {
     background: none!important;
     padding-right: 0!important
 }

 .quoteblock {
     margin: 0 1em 1.25em 1.5em;
     display: table
 }

 .quoteblock > .title {
     margin-left: -1.5em;
     margin-bottom: .75em
 }

 .quoteblock blockquote,
 .quoteblock blockquote p {
     color: rgba(0, 0, 0, .85);
     font-size: 1.15rem;
     line-height: 1.75;
     /*            word-spacing: .1em;*/
     letter-spacing: 0;
     font-style: italic;
     text-align: justify
 }

 .quoteblock blockquote {
     margin: 0;
     padding: 0;
     border: 0
 }

 .quoteblock blockquote:before {
     content: "\201c";
     float: left;
     font-size: 2.75em;
     font-weight: bold;
     line-height: .6em;
     margin-left: -.6em;
     color: #7a2518;
     text-shadow: 0 1px 2px rgba(0, 0, 0, .1)
 }

 .quoteblock blockquote > .paragraph:last-child p {
     margin-bottom: 0
 }

 .quoteblock .attribution {
     margin-top: .5em;
     margin-right: .5ex;
     text-align: right
 }

 .quoteblock .quoteblock {
     margin-left: 0;
     margin-right: 0;
     padding: .5em 0;
     border-left: 3px solid rgba(0, 0, 0, .6)
 }

 .quoteblock .quoteblock blockquote {
     padding: 0 0 0 .75em
 }

 .quoteblock .quoteblock blockquote:before {
     display: none
 }

 .verseblock {
     margin: 0 1em 1.25em 1em
 }

 .verseblock pre {
     font-family: "Open Sans", "DejaVu Sans", sans;
     font-size: 1.15rem;
     color: rgba(0, 0, 0, .85);
     /*            font-weight: 300;*/
     text-rendering: optimizeLegibility
 }

 .verseblock pre strong {
     font-weight: 400
 }

 .verseblock .attribution {
     margin-top: 1.25rem;
     margin-left: .5ex
 }

 .quoteblock .attribution,
 .verseblock .attribution {
     font-size: .9375em;
     line-height: 1.45;
     font-style: italic
 }

 .quoteblock .attribution br,
 .verseblock .attribution br {
     display: none
 }

 .quoteblock .attribution cite,
 .verseblock .attribution cite {
     display: block;
     letter-spacing: -.025em;
     color: rgba(0, 0, 0, .6)
 }

 .quoteblock.abstract {
     margin: 0 0 1.25em 0;
     display: block
 }

 .quoteblock.abstract blockquote,
 .quoteblock.abstract blockquote p {
     text-align: left;
     word-spacing: 0
 }

 .quoteblock.abstract blockquote:before,
 .quoteblock.abstract blockquote p:first-of-type:before {
     display: none
 }

 table.tableblock {
     max-width: 100%;
     border-collapse: separate
 }

 table.tableblock td > .paragraph:last-child p > p:last-child,
 table.tableblock th > p:last-child,
 table.tableblock td > p:last-child {
     margin-bottom: 0
 }

 table.tableblock,
 th.tableblock,
 td.tableblock {
     border: 0 solid #dedede
 }

 table.grid-all > thead > tr > .tableblock,
 table.grid-all > tbody > tr > .tableblock {
     border-width: 0 1px 1px 0
 }

 table.grid-all > tfoot > tr > .tableblock {
     border-width: 1px 1px 0 0
 }

 table.grid-cols > * > tr > .tableblock {
     border-width: 0 1px 0 0
 }

 table.grid-rows > thead > tr > .tableblock,
 table.grid-rows > tbody > tr > .tableblock {
     border-width: 0 0 1px 0
 }

 table.grid-rows > tfoot > tr > .tableblock {
     border-width: 1px 0 0 0
 }

 table.grid-all > * > tr > .tableblock:last-child,
 table.grid-cols > * > tr > .tableblock:last-child {
     border-right-width: 0
 }

 table.grid-all > tbody > tr:last-child > .tableblock,
 table.grid-all > thead:last-child > tr > .tableblock,
 table.grid-rows > tbody > tr:last-child > .tableblock,
 table.grid-rows > thead:last-child > tr > .tableblock {
     border-bottom-width: 0
 }

 table.frame-all {
     border-width: 1px
 }

 table.frame-sides {
     border-width: 0 1px
 }

 table.frame-topbot {
     border-width: 1px 0
 }

 th.halign-left,
 td.halign-left {
     text-align: left
 }

 th.halign-right,
 td.halign-right {
     text-align: right
 }

 th.halign-center,
 td.halign-center {
     text-align: center
 }

 th.valign-top,
 td.valign-top {
     vertical-align: top
 }

 th.valign-bottom,
 td.valign-bottom {
     vertical-align: bottom
 }

 th.valign-middle,
 td.valign-middle {
     vertical-align: middle
 }

 table thead th,
 table tfoot th {
     font-weight: bold
 }

 tbody tr th {
     display: table-cell;
     line-height: 1.6;
     background: #f7f8f7
 }

 tbody tr th,
 tbody tr th p,
 tfoot tr th,
 tfoot tr th p {
     color: rgba(0, 0, 0, .8);
     font-weight: bold
 }

 p.tableblock > code:only-child {
     background: none;
     padding: 0
 }

 p.tableblock {
     font-size: 1em
 }

 td > div.verse {
     white-space: pre
 }

 ol {
     margin-left: 1.75em
 }

 ul li ol {
     margin-left: 1.5em
 }

 dl dd {
     margin-left: 1.125em
 }

 dl dd:last-child,
 dl dd:last-child > :last-child {
     margin-bottom: 0
 }

 ol > li p,
 ul > li p,
 ul dd,
 ol dd,
 .olist .olist,
 .ulist .ulist,
 .ulist .olist,
 .olist .ulist {
     margin-bottom: .625em
 }

 ul.checklist,
 ul.none,
 ol.none,
 ul.no-bullet,
 ol.no-bullet,
 ol.unnumbered,
 ul.unstyled,
 ol.unstyled {
     list-style-type: none
 }

 ul.no-bullet,
 ol.no-bullet,
 ol.unnumbered {
     margin-left: .625em
 }

 ul.unstyled,
 ol.unstyled {
     margin-left: 0
 }

 ul.checklist {
     margin-left: .625em
 }

 ul.checklist li > p:first-child > .fa-square-o:first-child,
 ul.checklist li > p:first-child > .fa-check-square-o:first-child {
     width: 1.25em;
     font-size: .8em;
     position: relative;
     bottom: .125em
 }

 ul.checklist li > p:first-child > input[type="checkbox"]:first-child {
     margin-right: .25em
 }

 ul.inline {
     margin: 0 auto .625em auto;
     margin-left: -1.375em;
     margin-right: 0;
     padding: 0;
     list-style: none;
     overflow: hidden
 }

 ul.inline > li {
     list-style: none;
     float: left;
     margin-left: 1.375em;
     display: block
 }

 ul.inline > li > * {
     display: block
 }

 .unstyled dl dt {
     font-weight: normal;
     font-style: normal
 }

 ol.arabic {
     list-style-type: decimal
 }

 ol.decimal {
     list-style-type: decimal-leading-zero
 }

 ol.loweralpha {
     list-style-type: lower-alpha
 }

 ol.upperalpha {
     list-style-type: upper-alpha
 }

 ol.lowerroman {
     list-style-type: lower-roman
 }

 ol.upperroman {
     list-style-type: upper-roman
 }

 ol.lowergreek {
     list-style-type: lower-greek
 }

 .hdlist > table,
 .colist > table {
     border: 0;
     background: none
 }

 .hdlist > table > tbody > tr,
 .colist > table > tbody > tr {
     background: none
 }

 td.hdlist1,
 td.hdlist2 {
     vertical-align: top;
     padding: 0 .625em
 }

 td.hdlist1 {
     font-weight: bold;
     padding-bottom: 1.25em
 }

 .literalblock + .colist,
 .listingblock + .colist {
     margin-top: -.5em
 }

 .colist > table tr > td:first-of-type {
     padding: .4em .75em 0 .75em;
     line-height: 1;
     vertical-align: top
 }

 .colist > table tr > td:first-of-type img {
     max-width: initial
 }

 .colist > table tr > td:last-of-type {
     padding: .25em 0
 }

 .thumb,
 .th {
     line-height: 0;
     display: inline-block;
     border: solid 4px #fff;
     -webkit-box-shadow: 0 0 0 1px #ddd;
     box-shadow: 0 0 0 1px #ddd
 }

 .imageblock.left,
 .imageblock[style*="float: left"] {
     margin: .25em .625em 1.25em 0
 }

 .imageblock.right,
 .imageblock[style*="float: right"] {
     margin: .25em 0 1.25em .625em
 }

 .imageblock > .title {
     margin-bottom: 0
 }

 .imageblock.thumb,
 .imageblock.th {
     border-width: 6px
 }

 .imageblock.thumb > .title,
 .imageblock.th > .title {
     padding: 0 .125em
 }

 .image.left,
 .image.right {
     margin-top: .25em;
     margin-bottom: .25em;
     display: inline-block;
     line-height: 0
 }

 .image.left {
     margin-right: .625em
 }

 .image.right {
     margin-left: .625em
 }

 a.image {
     text-decoration: none;
     display: inline-block
 }

 a.image object {
     pointer-events: none
 }

 sup.footnote,
 sup.footnoteref {
     font-size: .875em;
     position: static;
     vertical-align: super
 }

 sup.footnote a,
 sup.footnoteref a {
     text-decoration: none
 }

 sup.footnote a:active,
 sup.footnoteref a:active {
     text-decoration: underline
 }

 #footnotes {
     padding-top: .75em;
     padding-bottom: .75em;
     margin-bottom: .625em
 }

 #footnotes hr {
     width: 20%;
     min-width: 6.25em;
     margin: -.25em 0 .75em 0;
     border-width: 1px 0 0 0
 }

 #footnotes .footnote {
     padding: 0 .375em 0 .225em;
     line-height: 1.3334;
     font-size: .875em;
     margin-left: 1.2em;
     text-indent: -1.05em;
     margin-bottom: .2em
 }

 #footnotes .footnote a:first-of-type {
     font-weight: bold;
     text-decoration: none
 }

 #footnotes .footnote:last-of-type {
     margin-bottom: 0
 }

 #content #footnotes {
     margin-top: -.625em;
     margin-bottom: 0;
     padding: .75em 0
 }

 .gist .file-data > table {
     border: 0;
     background: #fff;
     width: 100%;
     margin-bottom: 0
 }

 .gist .file-data > table td.line-data {
     width: 99%
 }

 div.unbreakable {
     page-break-inside: avoid
 }

 .big {
     font-size: larger
 }

 .small {
     font-size: smaller
 }

 .underline {
     text-decoration: underline
 }

 .overline {
     text-decoration: overline
 }

 .line-through {
     text-decoration: line-through
 }

 .aqua {
     color: #00bfbf
 }

 .aqua-background {
     background-color: #00fafa
 }

 .black {
     color: #000
 }

 .black-background {
     background-color: #000
 }

 .blue {
     color: #0000bf
 }

 .blue-background {
     background-color: #0000fa
 }

 .fuchsia {
     color: #bf00bf
 }

 .fuchsia-background {
     background-color: #fa00fa
 }

 .gray {
     color: #606060
 }

 .gray-background {
     background-color: #7d7d7d
 }

 .green {
     color: #006000
 }

 .green-background {
     background-color: #007d00
 }

 .lime {
     color: #00bf00
 }

 .lime-background {
     background-color: #00fa00
 }

 .maroon {
     color: #600000
 }

 .maroon-background {
     background-color: #7d0000
 }

 .navy {
     color: #000060
 }

 .navy-background {
     background-color: #00007d
 }

 .olive {
     color: #606000
 }

 .olive-background {
     background-color: #7d7d00
 }

 .purple {
     color: #600060
 }

 .purple-background {
     background-color: #7d007d
 }

 .red {
     color: #bf0000
 }

 .red-background {
     background-color: #fa0000
 }

 .silver {
     color: #909090
 }

 .silver-background {
     background-color: #bcbcbc
 }

 .teal {
     color: #006060
 }

 .teal-background {
     background-color: #007d7d
 }

 .white {
     color: #bfbfbf
 }

 .white-background {
     background-color: #fafafa
 }

 .yellow {
     color: #bfbf00
 }

 .yellow-background {
     background-color: #fafa00
 }

 span.icon > .fa {
     cursor: default
 }

 a span.icon > .fa {
     cursor: inherit
 }

 .admonitionblock td.icon [class^="fa icon-"] {
     font-size: 2.5em;
     text-shadow: 1px 1px 2px rgba(0, 0, 0, .5);
     cursor: default
 }

 .admonitionblock td.icon .icon-note:before {
     content: "\f05a";
     color: #19407c
 }

 .admonitionblock td.icon .icon-tip:before {
     content: "\f0eb";
     text-shadow: 1px 1px 2px rgba(155, 155, 0, .8);
     color: #111
 }

 .admonitionblock td.icon .icon-warning:before {
     content: "\f071";
     color: #bf6900
 }

 .admonitionblock td.icon .icon-caution:before {
     content: "\f06d";
     color: #bf3400
 }

 .admonitionblock td.icon .icon-important:before {
     content: "\f06a";
     color: #bf0000
 }

 .conum[data-value] {
     display: inline-block;
     color: #fff!important;
     background-color: rgba(0, 0, 0, .8);
     -webkit-border-radius: 100px;
     border-radius: 100px;
     text-align: center;
     font-size: .75em;
     width: 1.67em;
     height: 1.67em;
     line-height: 1.67em;
     font-family: "Open Sans", "DejaVu Sans", sans-serif;
     font-style: normal;
     font-weight: bold
 }

 .conum[data-value] * {
     color: #fff!important
 }

 .conum[data-value] + b {
     display: none
 }

 .conum[data-value]:after {
     content: attr(data-value)
 }

 pre .conum[data-value] {
     position: relative;
     top: -.125em
 }

 b.conum * {
     color: inherit!important
 }

 .conum:not([data-value]):empty {
     display: none
 }

 dt,
 th.tableblock,
 td.content,
 div.footnote {
     text-rendering: optimizeLegibility
 }

 h1,
 h2,
 p,
 td.content,
 span.alt {
     /*            letter-spacing: -.01em*/
 }

 p strong,
 td.content strong,
 div.footnote strong {
     letter-spacing: -.005em
 }

 p,
 blockquote,
 dt,
 td.content,
 span.alt {
     font-size: 1.0625rem
 }

 p {
     margin-bottom: .5rem
 }

 .sidebarblock p,
 .sidebarblock dt,
 .sidebarblock td.content,
 p.tableblock {
     font-size: 1em
 }

 .exampleblock > .content {
     background-color: #fffef7;
     border-color: #e0e0dc;
     -webkit-box-shadow: 0 1px 4px #e0e0dc;
     box-shadow: 0 1px 4px #e0e0dc
 }

 .print-only {
     display: none!important
 }

 @media print {
     @page {
         margin: 1.75cm 1.5cm
     }
     * {
         -webkit-box-shadow: none!important;
         box-shadow: none!important;
         text-shadow: none!important
     }
     a {
         color: inherit!important;
         text-decoration: underline!important
     }
     a.bare,
     a[href^="#"],
     a[href^="mailto:"] {
         text-decoration: none!important
     }
     a[href^="http:"]:not(.bare):after,
     a[href^="https:"]:not(.bare):after {
         content: "(" attr(href) ")";
         display: inline-block;
         font-size: .875em;
         padding-left: .25em
     }
     abbr[title]:after {
         content: " (" attr(title) ")"
     }
     pre,
     blockquote,
     tr,
     img,
     object,
     svg {
         page-break-inside: avoid
     }
     thead {
         display: table-header-group
     }
     svg {
         max-width: 100%
     }
     p,
     blockquote,
     dt,
     td.content {
         font-size: 1em;
         orphans: 3;
         widows: 3
     }
     h2,
     h3,
     #toctitle,
     .sidebarblock > .content > .title {
         page-break-after: avoid
     }
     #toc,
     .sidebarblock,
     .exampleblock > .content {
         background: none!important
     }
     #toc {
         border-bottom: 1px solid #ddddd8!important;
         padding-bottom: 0!important
     }
     .sect1 {
         padding-bottom: 0!important
     }
     .sect1 + .sect1 {
         border: 0!important
     }
     #header > h1:first-child {
         margin-top: 1.25rem
     }
     body.book #header {
         text-align: center
     }
     body.book #header > h1:first-child {
         border: 0!important;
         margin: 2.5em 0 1em 0
     }
     body.book #header .details {
         border: 0!important;
         display: block;
         padding: 0!important
     }
     body.book #header .details span:first-child {
         margin-left: 0!important
     }
     body.book #header .details br {
         display: block
     }
     body.book #header .details br + span:before {
         content: none!important
     }
     body.book #toc {
         border: 0!important;
         text-align: left!important;
         padding: 0!important;
         margin: 0!important
     }
     body.book #toc,
     body.book #preamble,
     body.book h1.sect0,
     body.book .sect1 > h2 {
         page-break-before: always
     }
     .listingblock code[data-lang]:before {
         display: block
     }
     #footer {
         background: none!important;
         padding: 0 .9375em
     }
     #footer-text {
         color: rgba(0, 0, 0, .6)!important;
         font-size: .9em
     }
     .hide-on-print {
         display: none!important
     }
     .print-only {
         display: block!important
     }
     .hide-for-print {
         display: none!important
     }
     .show-for-print {
         display: inherit!important
     }
 }

 </style > <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" > <style >
 /* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */

 /*pre.CodeRay {background-color:#f7f7f8;}*/

 .CodeRay .line-numbers {
     border-right: 1px solid #d8d8d8;
     padding: 0 0.5em 0 .25em
 }

 .CodeRay span.line-numbers {
     display: inline-block;
     margin-right: .5em;
     color: rgba(0, 0, 0, .3)
 }

 .CodeRay .line-numbers strong {
     color: rgba(0, 0, 0, .4)
 }

 table.CodeRay {
     border-collapse: separate;
     border-spacing: 0;
     margin-bottom: 0;
     border: 0;
     background: none
 }

 table.CodeRay td {
     vertical-align: top;
     line-height: 1.45
 }

 table.CodeRay td.line-numbers {
     text-align: right
 }

 table.CodeRay td.line-numbers > pre {
     padding: 0;
     color: rgba(0, 0, 0, .3)
 }

 table.CodeRay td.code {
     padding: 0 0 0 .5em
 }

 table.CodeRay td.code > pre {
     padding: 0
 }

 .CodeRay .debug {
     color: #fff !important;
     background: #000080 !important
 }

 .CodeRay .annotation {
     color: #007
 }

 .CodeRay .attribute-name {
     color: #000080
 }

 .CodeRay .attribute-value {
     color: #700
 }

 .CodeRay .binary {
     color: #509
 }

 .CodeRay .comment {
     color: #998;
     font-style: italic
 }

 .CodeRay .char {
     color: #04d
 }

 .CodeRay .char .content {
     color: #04d
 }

 .CodeRay .char .delimiter {
     color: #039
 }

 .CodeRay .class {
     color: #458;
     font-weight: bold
 }

 .CodeRay .complex {
     color: #a08
 }

 .CodeRay .constant,
 .CodeRay .predefined-constant {
     color: #008080
 }

 .CodeRay .color {
     color: #099
 }

 .CodeRay .class-variable {
     color: #369
 }

 .CodeRay .decorator {
     color: #b0b
 }

 .CodeRay .definition {
     color: #099
 }

 .CodeRay .delimiter {
     color: #000
 }

 .CodeRay .doc {
     color: #970
 }

 .CodeRay .doctype {
     color: #34b
 }

 .CodeRay .doc-string {
     color: #d42
 }

 .CodeRay .escape {
     color: #666
 }

 .CodeRay .entity {
     color: #800
 }

 .CodeRay .error {
     color: #808
 }

 .CodeRay .exception {
     color: inherit
 }

 .CodeRay .filename {
     color: #099
 }

 .CodeRay .function {
     color: #900;
     font-weight: bold
 }

 .CodeRay .global-variable {
     color: #008080
 }

 .CodeRay .hex {
     color: #058
 }

 .CodeRay .integer,
 .CodeRay .float {
     color: #099
 }

 .CodeRay .include {
     color: #555
 }

 .CodeRay .inline {
     color: #000
 }

 .CodeRay .inline .inline {
     background: #ccc
 }

 .CodeRay .inline .inline .inline {
     background: #bbb
 }

 .CodeRay .inline .inline-delimiter {
     color: #d14
 }

 .CodeRay .inline-delimiter {
     color: #d14
 }

 .CodeRay .important {
     color: #555;
     font-weight: bold
 }

 .CodeRay .interpreted {
     color: #b2b
 }

 .CodeRay .instance-variable {
     color: #008080
 }

 .CodeRay .label {
     color: #970
 }

 .CodeRay .local-variable {
     color: #963
 }

 .CodeRay .octal {
     color: #40e
 }

 .CodeRay .predefined {
     color: #369
 }

 .CodeRay .preprocessor {
     color: #579
 }

 .CodeRay .pseudo-class {
     color: #555
 }

 .CodeRay .directive {
     font-weight: bold
 }

 .CodeRay .type {
     font-weight: bold
 }

 .CodeRay .predefined-type {
     color: inherit
 }

 .CodeRay .reserved,
 .CodeRay .keyword {
     color: #000;
     font-weight: bold
 }

 .CodeRay .key {
     color: #808
 }

 .CodeRay .key .delimiter {
     color: #606
 }

 .CodeRay .key .char {
     color: #80f
 }

 .CodeRay .value {
     color: #088
 }

 .CodeRay .regexp .delimiter {
     color: #808
 }

 .CodeRay .regexp .content {
     color: #808
 }

 .CodeRay .regexp .modifier {
     color: #808
 }

 .CodeRay .regexp .char {
     color: #d14
 }

 .CodeRay .regexp .function {
     color: #404;
     font-weight: bold
 }

 .CodeRay .string {
     color: #d20
 }

 .CodeRay .string .string .string {
     background: #ffd0d0
 }

 .CodeRay .string .content {
     color: #d14
 }

 .CodeRay .string .char {
     color: #d14
 }

 .CodeRay .string .delimiter {
     color: #d14
 }

 .CodeRay .shell {
     color: #d14
 }

 .CodeRay .shell .delimiter {
     color: #d14
 }

 .CodeRay .symbol {
     color: #990073
 }

 .CodeRay .symbol .content {
     color: #a60
 }

 .CodeRay .symbol .delimiter {
     color: #630
 }

 .CodeRay .tag {
     color: #008080
 }

 .CodeRay .tag-special {
     color: #d70
 }

 .CodeRay .variable {
     color: #036
 }

 .CodeRay .insert {
     background: #afa
 }

 .CodeRay .delete {
     background: #faa
 }

 .CodeRay .change {
     color: #aaf;
     background: #007
 }

 .CodeRay .head {
     color: #f8f;
     background: #505
 }

 .CodeRay .insert .insert {
     color: #080
 }

 .CodeRay .delete .delete {
     color: #800
 }

 .CodeRay .change .change {
     color: #66f
 }

 .CodeRay .head .head {
     color: #f4f
 }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Prosys OPC UA SDK for Java</h1>
<div class="details">
<span id="author" class="author">Client Tutorial</span><br>
<span id="revdate">Version 4.0.0</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">1. Introduction</a></li>
<li><a href="#installation">2. Installation</a></li>
<li><a href="#sample-applications">3. Sample Applications</a></li>
<li><a href="#uaclient-object">4. UaClient Object</a></li>
<li><a href="#server-connection">5. Server Connection</a></li>
<li><a href="#security-settings">6. Security Settings</a>
<ul class="sectlevel2">
<li><a href="#application-identity">6.1. Application Identity</a>
<ul class="sectlevel3">
<li><a href="#application-description">6.1.1. Application Description</a></li>
<li><a href="#application-instance-certificate">6.1.2. Application Instance Certificate</a></li>
<li><a href="#issuer-certificate">6.1.3. Issuer Certificate</a></li>
<li><a href="#multiple-application-instance-certificates">6.1.4. Multiple Application Instance Certificates</a></li>
<li><a href="#https-certificate">6.1.5. HTTPS Certificate</a></li>
<li><a href="#assigning-the-application-identity">6.1.6. Assigning the Application Identity</a></li>
</ul>
</li>
<li><a href="#security-modes">6.2. Security Modes</a>
<ul class="sectlevel3">
<li><a href="#securitymode-for-ua-tcp">6.2.1. SecurityMode for UA TCP</a></li>
<li><a href="#httpssecuritypolicy">6.2.2. HTTPSSecurityPolicy</a></li>
</ul>
</li>
<li><a href="#user-identity">6.3. User Identity</a></li>
<li><a href="#validating-server-certificates">6.4. Validating Server Certificates</a>
<ul class="sectlevel3">
<li><a href="#validating-https-certificates">6.4.1. Validating HTTPS Certificates</a></li>
</ul>
</li>
<li><a href="#teach-yourself-the-security-details">6.5. Teach Yourself the Security Details</a></li>
</ul>
</li>
<li><a href="#connecting-and-disconnecting">7. Connecting and Disconnecting</a>
<ul class="sectlevel2">
<li><a href="#connection-monitoring">7.1. Connection Monitoring</a>
<ul class="sectlevel3">
<li><a href="#serviceexception">7.1.1. ServiceException</a></li>
<li><a href="#timeout">7.1.2. Timeout</a></li>
<li><a href="#server-status-monitoring">7.1.3. Server Status Monitoring</a></li>
<li><a href="#automatic-reconnect">7.1.4. Automatic Reconnect</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#opc-ua-server-address-space">8. OPC UA Server Address Space</a>
<ul class="sectlevel2">
<li><a href="#browse-the-address-space">8.1. Browse the Address Space</a></li>
<li><a href="#browsing-through-the-nodes">8.2. Browsing Through the Nodes</a></li>
</ul>
</li>
<li><a href="#read-values">9. Read Values</a></li>
<li><a href="#write-values">10. Write Values</a></li>
<li><a href="#exceptions-when-operations-fail">11. Exceptions When Operations Fail</a></li>
<li><a href="#subscriptions">12. Subscribe to Data Changes</a></li>
<li><a href="#subscribe-to-events">13. Subscribe to Events</a></li>
<li><a href="#history-access">14. History Access</a>
<ul class="sectlevel2">
<li><a href="#reading-history">14.1. Reading History</a></li>
<li><a href="#updating-or-deleting-history">14.2. Updating or Deleting History</a></li>
</ul>
</li>
<li><a href="#calling-methods">15. Calling Methods</a></li>
<li><a href="#registering-and-unregistering-nodes">16. Registering and Unregistering Nodes</a></li>
<li><a href="#usingNodes">17. Using Node Objects</a></li>
<li><a href="#information-modeling-and-code-generation">18. Information Modeling and Code Generation</a>
<ul class="sectlevel2">
<li><a href="#prosys-opc-ua-sdk-for-java-code-generator">18.1. Prosys OPC UA SDK for Java Code Generator</a></li>
<li><a href="#using-the-generated-classes-from-applications">18.2. Using the Generated Classes from Applications</a></li>
<li><a href="#registering-the-model">18.3. Registering the Model</a></li>
<li><a href="#using-instances-of-generated-types">18.4. Using Instances of Generated Types</a></li>
</ul>
</li>
<li><a href="#reverse-connections">19. Reverse Connections</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hello and welcome to OPC UA!</p>
</div>
<div class="paragraph">
<p>This is the Prosys OPC UA SDK for Java tutorial for client application development. With this quick introduction you should be able to grab the basic ideas behind the Prosys OPC UA SDK for Java.</p>
</div>
<div class="paragraph">
<p>Note that this tutorial assumes that you are already familiar with the basic concepts of OPC UA communications, although you can get started without much prior knowledge.</p>
</div>
<div class="paragraph">
<p>For a full reference on OPC UA communications, we recommend the book <em>OPC Unified Architecture</em> by Mahnke, Leitner and Damm (Springer-Verlag, 2009, ISBN 978-3-540-68898-3).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installation"><a class="anchor" href="#installation"></a>2. Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>See the installation instructions in the 'README.txt' file (or the brief version on the download page). The README file also contains notes about the usage and deployment of external libraries used by the SDK.</p>
</div>
<div class="paragraph">
<p>There is also a basic starting guide with tips on Java development tools and on using the Prosys OPC UA SDK for Java with the Eclipse IDE located in the 'Prosys_OPC_UA_SDK_for_Java_Starting_Guide' PDF file next to this guide in the distribution package.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sample-applications"><a class="anchor" href="#sample-applications"></a>3. Sample Applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The SDK contains a sample client application in the <code>SampleConsoleClient</code> Java class. This tutorial will refer to the code in the sample application while explaining the different steps to take in order to accomplish the main tasks of an OPC UA client.</p>
</div>
<div class="paragraph">
<p>In addition, the samples also contain a <code>SimpleClient</code> Java class that presents a very straightforward example of the most simplified client application you can create with the SDK.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="uaclient-object"><a class="anchor" href="#uaclient-object"></a>4. UaClient Object</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The UaClient class is the main class you will be working with. It encapsulates the connection to the OPC UA server and handles the various details of the actual OPC UA communications, thus providing you with a simple interface to access from your applications. These are the lines in the 'SampleConsoleClient.java' file that create the <code>UaClient</code> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">protected</span> UaClient client;
...
client = <span class="keyword">new</span> UaClient(serverAddress);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="server-connection"><a class="anchor" href="#server-connection"></a>5. Server Connection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the previous example, the <code>serverAddress</code> argument defines the server you are connecting to. Some sample addresses are provided in the following table:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">opc.tcp://&lt;hostname&gt;:52520/OPCUA/SampleConsoleServer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prosys OPC UA SDK for Java Sample Console Server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">opc.https://&lt;hostname&gt;:52443/OPCUA/SampleConsoleServer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prosys OPC UA SDK for Java Sample Console Server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">opc.tcp://&lt;hostname&gt;:53530/OPCUA/SimulationServer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prosys OPC UA Simulation Server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">opc.tcp://&lt;hostname&gt;:62541/Quickstarts/DataAccessServer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OPC Foundation QuickStart Data Access Server</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>&lt;hostname&gt; is the hostname of the computer in which the server is running.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The servers define a list of endpoints that they are listening to. The actual hostname in the endpoint may differ from the one that you use for connection. For Windows hostname resolution, see <a href="http://technet.microsoft.com/en-us/library/bb727005.aspx" class="bare">http://technet.microsoft.com/en-us/library/bb727005.aspx</a>. If you are using the client in Linux, you cannot use NetBIOS computer names to access Windows servers. In general, it is best to use TCP/IP DNS names from all clients. Alternatively, you can always use the IP address of the computer.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You need to define the complete address either in the constructor or with the <code>setAddress()</code> method. The first part of the address defines the transport protocol to use. <code>opc.tcp</code> refers to UA TCP communication which is usually the preferred protocol. An alternative protocol is <code>opc.https</code>, which some servers may support as well.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-settings"><a class="anchor" href="#security-settings"></a>6. Security Settings</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OPC UA applications enable full security that is integrated into the communications. You can decide in the client which kind of security settings you want to use or make available in your application. Usually, the end user should be able to configure the security level of each connection according to his needs.</p>
</div>
<div class="sect2">
<h3 id="application-identity"><a class="anchor" href="#application-identity"></a>6.1. Application Identity</h3>
<div class="paragraph">
<p>All OPC UA applications must define some characteristics of themselves. This information is communicated to other applications via the OPC UA protocol when the applications are connected.</p>
</div>
<div class="paragraph">
<p>For secure communications, the applications must also define an <em>Application Instance Certificate</em>, which they use to authenticate themselves to other applications they are communicating with. Depending on the selected security level, servers may only accept connections from clients that they trust.</p>
</div>
<div class="sect3">
<h4 id="application-description"><a class="anchor" href="#application-description"></a>6.1.1. Application Description</h4>
<div class="paragraph">
<p>The characteristics of an OPC UA application is defined in the following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">static</span> <span class="predefined-type">String</span> APP_NAME = <span class="string"><span class="delimiter">'</span><span class="content">SampleConsoleClient</span><span class="delimiter">'</span></span>;
[...]
ApplicationDescription appDescription = <span class="keyword">new</span> ApplicationDescription();
<span class="comment">// 'localhost' (all lower case) in the ApplicationName and</span>
<span class="comment">// ApplicationURI is converted to the actual host name of the computer</span>
<span class="comment">// in which the application is run</span>
appDescription.setApplicationName(<span class="keyword">new</span> LocalizedText(APP_NAME +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">@localhost</span><span class="delimiter">&quot;</span></span>));
appDescription.setApplicationUri(<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:localhost:OPCUA:</span><span class="delimiter">&quot;</span></span> + APP_NAME);
appDescription.setProductUri(<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:prosysopc.com:OPCUA:</span><span class="delimiter">&quot;</span></span> + APP_NAME);
appDescription.setApplicationType(ApplicationType.Client);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>ApplicationName</strong> is used in user interfaces as a name identifier for each application instance.</p>
</div>
<div class="paragraph">
<p><strong>ApplicationUri</strong> is a unique identifier for each running instance.</p>
</div>
<div class="paragraph">
<p><strong>ProductUri</strong>, on the other hand, is used to identify your product and should therefore be the same for all instances. It should refer to your own domain, for example, to ensure that it is globally unique.</p>
</div>
<div class="paragraph">
<p>Since the identifiers should be unique for each instance (i.e. installation), it is a good habit to include the hostname of the computer in which the application is running in both the ApplicationName and the ApplicationUri. The SDK supports this by automatically converting <code>localhost</code> to the actual hostname of the computer (e.g. 'myhost'). Alternatively, you can use <code>hostname</code>, which will be replaced with the full hostname, including the possible domain name part (e.g. 'myhost.mydomain.com').</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The URIs must be valid identifiers, i.e. they must begin with a scheme, such as ‘urn:’ and may not contain any space characters. There are some applications in the market, which use invalid URIs and may therefore cause some errors or warnings with your application.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="application-instance-certificate"><a class="anchor" href="#application-instance-certificate"></a>6.1.2. Application Instance Certificate</h4>
<div class="paragraph">
<p>You can define the Application Instance Certificate for the client by setting an <code>ApplicationIdentity</code> for the <code>UaClient</code> object. The simplest way to do this is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="directive">final</span> ApplicationIdentity identity = ApplicationIdentity.loadOrCreateCertificate(
                    appDescription,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Sample Organisation</span><span class="delimiter">&quot;</span></span>,
        <span class="comment">/* Private Key Password, optional */</span><span class="string"><span class="delimiter">&quot;</span><span class="content">opcua</span><span class="delimiter">&quot;</span></span>,
        <span class="comment">/* Key File Path */</span>privatePath,
        <span class="comment">/* CA certificate &amp; private key, optional */</span><span class="predefined-constant">null</span>,
        <span class="comment">/* Key Sizes for instance certificates to create, optional */</span>keySizes,
        <span class="comment">/* Enable renewing the certificate */</span><span class="predefined-constant">true</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this sample we are creating a self-signed certificate using the service of <code>ApplicationIdentity.loadOrCreateCertificate()</code>. On the first run, it creates the certificate and the private key and stores them in the files <code>SampleConsoleClient@hostname_keysize.der</code> and <code>SampleConsoleClient@hostname_keysize.pem</code> respectively (<code>hostname</code> is replaced with the actual hostname of the machine where the application is running and <code>keysize</code> is replaced with the size of the public and private key). The private key is used by the client to create a secret token that is sent to the server. The certificate is used by the server to decrypt the token and validate that the client created it.</p>
</div>
<div class="paragraph">
<p>The fourth parameter in <code>loadOrCreateCertificate()</code> simply defines the path where the certificate files are stored. Do not mind about it at the moment, it will be clarified later.</p>
</div>
<div class="paragraph">
<p>The last parameter enables automatic certificate renewal when a certificate expires.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As the name refers, the certificate is used to identify each application instance. That means that on every computer, the application has a different certificate. The certificate contains the ApplicationUri, which also identifies the computer in which the application is run, and must match the one defined in the <code>ApplicationDescription</code>. Therefore, we provide the <code>appDescription</code> as a parameter for <code>loadOrCreateCertificate()</code>, which extracts the ApplicationUri from it.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If your application does not use security, you may also create the identity without any certificate by using the default constructor. However, you should always set the <code>ApplicationDescription</code> to the identity.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that if some other application gets the same key pair, it can pretend to be the same client application. The private key should be kept safe in order to reliably verify the identity of this application. Additionally, you may secure the usage of the private key with a password that is required to open it for use (but you need to add that in clear text in your application code or prompt it from the user). The certificate is public and can be distributed and stored freely in the servers and anywhere else.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The SDK stores private keys in '.pem' format, which supports password protection. If you get the certificate and private key from an external CA, you may get a '.pfx' file: if such is present (and '.pem' is not present), the application will use it to read the private key.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="issuer-certificate"><a class="anchor" href="#issuer-certificate"></a>6.1.3. Issuer Certificate</h4>
<div class="paragraph">
<p>More ideally, the certificates would be signed by a recognized Certificate Authority (CA) instead of using the self-signed keys as above.</p>
</div>
<div class="paragraph">
<p>If you wish to create your own <code>KeyPair</code> in your application, you can do that with the SDK like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">KeyPair</span> issuerCertificate =
        ApplicationIdentity.loadOrCreateIssuerCertificate(
                <span class="string"><span class="delimiter">&quot;</span><span class="content">ProsysSampleCA</span><span class="delimiter">&quot;</span></span>, privatePath, <span class="string"><span class="delimiter">&quot;</span><span class="content">opcua</span><span class="delimiter">&quot;</span></span>, <span class="integer">3650</span>, <span class="predefined-constant">false</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The sample code creates the issuer key pair with a private key password (“opcua”) for “ProsysSampleCA” for 10 years (3650 days). The key pair is stored in the <code>privatePath</code> (which refers to the PKI directory of the validator, as above).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The self-made issuer key does not replace a real CA. In real installations, it is always best to establish a central CA and create all keys for the applications using the CA. In this scenario, you can copy the certificate of the CA to the trust list of each OPC UA application. This will enable the applications to automatically trust all keys created by the CA.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="multiple-application-instance-certificates"><a class="anchor" href="#multiple-application-instance-certificates"></a>6.1.4. Multiple Application Instance Certificates</h4>
<div class="paragraph">
<p>OPC UA specification defines different security profiles, which may require different kind of Application Instance Certificates, for example with different key sizes. The SDK enables usage of several certificates by defining an array of keySizes, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Use 0 to use the default keySize and default file names (for other</span>
<span class="comment">// values the file names will include the key size.</span>
<span class="type">int</span><span class="type">[]</span> keySizes = <span class="keyword">new</span> <span class="type">int</span><span class="type">[]</span> { <span class="integer">0</span>, <span class="integer">4096</span> };</code></pre>
</div>
</div>
<div class="paragraph">
<p>The identity is then initialized as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Define the client application identity, including the security</span>
<span class="comment">// certificate</span>
<span class="directive">final</span> ApplicationIdentity identity = ApplicationIdentity
        .loadOrCreateCertificate(appDescription, <span class="string"><span class="delimiter">&quot;</span><span class="content">Sample Organisation</span><span class="delimiter">&quot;</span></span>,
        <span class="comment">/* Private Key Password */</span><span class="string"><span class="delimiter">&quot;</span><span class="content">opcua</span><span class="delimiter">&quot;</span></span>,
        <span class="comment">/* Key File Path */</span>privatePath,
        <span class="comment">/* CA certificate &amp; private key */</span>issuerCertificate,
        <span class="comment">/* Key Sizes for instance certificates to create */</span>keySizes,
        <span class="comment">/* Enable renewing the certificate */</span><span class="predefined-constant">true</span>);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="https-certificate"><a class="anchor" href="#https-certificate"></a>6.1.5. HTTPS Certificate</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Starting from 4.0.0 HTTPS Certificate is no longer needed or created on the client side. See Migration Guide and Release Notes for more details.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="assigning-the-application-identity"><a class="anchor" href="#assigning-the-application-identity"></a>6.1.6. Assigning the Application Identity</h4>
<div class="paragraph">
<p>Now, we can finally just assign the created identity to the <code>UaClient</code> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">client.setApplicationIdentity(identity);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="security-modes"><a class="anchor" href="#security-modes"></a>6.2. Security Modes</h3>
<div class="sect3">
<h4 id="securitymode-for-ua-tcp"><a class="anchor" href="#securitymode-for-ua-tcp"></a>6.2.1. SecurityMode for UA TCP</h4>
<div class="paragraph">
<p>Once the certificates are defined, you may decide the level of security that is used in the UA TCP binary communications by setting the <code>SecurityMode</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">client.setSecurityMode(SecurityMode.NONE);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This setting enables access without any security features. It is usually easier to verify that the communication can be established without security, however please note that this <code>SecurityMode</code> should only be used in isolated networks. If you only need to ensure that the messages cannot be tampered you can set the SecurityMode to signed mode, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">client.setSecurityMode(SecurityMode.BASIC128RSA15_SIGN);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will add digital signatures to every communication message, ensuring that no one can alter the communication on the wire. However the messages wont be encrypted. In order to that, you can encrypt all messages and ensure that third parties cannot listen to the communication either by using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">client.setSecurityMode(SecurityMode.BASIC128RSA15_SIGN_ENCRYPT);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Only SecurityModes having encryption is recommended for public networks.</p>
</div>
<div class="paragraph">
<p>BASIC128RSA15 is the most lightweight security profile and supported by most OPC UA applications.</p>
</div>
<div class="paragraph">
<p>Other alternative security profiles defined in OPC UA 1.03 are BASIC256 and BASIC256SHA256.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>BASIC128RSA15 and BASIC256 are deprecated in OPC UA 1.04, due to some security issues and they are no longer recommended.</p>
</div>
<div class="paragraph">
<p>OPC UA 1.04 also defines new security policies, AES128_SHA256_RSAOAEP, AES256_SHA256_RSAPSS to replace the deprecated ones. Since different applications will support different policies in practice, you may still need to use the deprecated policies sometimes.</p>
</div>
<div class="paragraph">
<p>It is also recommended to enable the users of your application to configure the security policy to use.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In practice, you can use only security modes that are enabled in the server that you are connecting to. If you don&#8217;t know which they are, call</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">client.getSupportedSecurityModes();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="httpssecuritypolicy"><a class="anchor" href="#httpssecuritypolicy"></a>6.2.2. HTTPSSecurityPolicy</h4>
<div class="paragraph">
<p>If you use the HTTPS protocol for server communication the <code>UaClient</code> will negotiate a usable TLS security policy with the server application. You can define which policies your application supports with</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// The TLS security policies to use for HTTPS</span>
<span class="predefined-type">Set</span>&lt;HttpsSecurityPolicy&gt; supportedHttpsModes = <span class="keyword">new</span> <span class="predefined-type">HashSet</span>&lt;HttpsSecurityPolicy&gt;();
<span class="comment">// HTTPS was added in UA 1.02</span>
supportedHttpsModes.addAll(HttpsSecurityPolicy.ALL_102);
supportedHttpsModes.addAll(HttpsSecurityPolicy.ALL_103);
supportedHttpsModes.addAll(HttpsSecurityPolicy.ALL_104);
client.getHttpsSettings().setHttpsSecurityPolicies(supportedHttpsModes);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The constants <code>ALL_102</code>, <code>ALL_103</code> and <code>ALL_104</code> define which (HTTPS) security policies were considered safe in which OPC UA specification versions.</p>
</div>
<div class="paragraph">
<p>In order to be able to make a connection with HTTPS, you must also be able to validate the certificates properly. See <a href="#validating-https-certificates">Validating HTTPS Certificates</a> for details about that.</p>
</div>
<div class="paragraph">
<p>In general, HTTPS is quite tricky in practice, and you should really consider twice if you really want to use that. Check how your servers support it and use it if you need it. But usually you should do better with the UA TCP protocol instead.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="user-identity"><a class="anchor" href="#user-identity"></a>6.3. User Identity</h3>
<div class="paragraph">
<p>In addition to verifying the identity of the applications, OPC UA also enables verification of user identities. In <code>UaClient</code>, you can define the identity of the user with the <code>UserIdentity</code> class. The <code>SampleConsoleClient</code> does not do that by default, as each server defines what kind of user identities it supports. You can define a user identity that uses a standard username and password combination</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">client.setUserIdentity(<span class="keyword">new</span> UserIdentity(<span class="string"><span class="delimiter">&quot;</span><span class="content">my_name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">my_password</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another alternative is to use a certificate and private key, similar to the application instance identity, or a WS-SecurityToken provided by an external security system (e.g. SAML or Kerberos). To find out which user token types are supported by the server, call</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">client.getSupportedUserIdentityTokens();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="validating-server-certificates"><a class="anchor" href="#validating-server-certificates"></a>6.4. Validating Server Certificates</h3>
<div class="paragraph">
<p>An integral part of all OPC UA applications, in addition to defining their own security information, is of course, to validate the security information of the other party.</p>
</div>
<div class="paragraph">
<p>To validate the certificates of OPC UA servers, you need to define a <code>CertificateValidator</code> in the <code>UaClient</code>. This validator is used to validate the certificates received from the servers automatically.</p>
</div>
<div class="paragraph">
<p>To provide a standard certificate validation mechanism, the OPC UA Java Stack contains a specific implementation of the <code>CertificateValidator</code>, the <code>DefaultCertificateValidator</code>. You can create the validator as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="comment">// Use PKI files to keep track of the trusted and rejected server</span>
    <span class="comment">// certificates...</span>
    <span class="directive">final</span> PkiDirectoryCertificateStore certStore = <span class="keyword">new</span> PkiDirectoryCertificateStore();
    <span class="directive">final</span> DefaultCertificateValidator validator = <span class="keyword">new</span> DefaultCertificateValidator(certStore);
    client.setCertificateValidator(validator);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The way this validator stores the received certificates is defined by the <code>certStore</code>, which in the example is an instance of <code>PkiDirectoryCertificateStore</code>. It keeps the certificates in a file directory structure, such as
'PKI/CA/certs' and 'PKI/CA/rejected'. The trusted certificates are stored in the 'certs' folder and the untrusted in 'rejected'. By default, the certificates are not trusted so they are stored in 'rejected'. You can then manually move the trusted certificates to the 'certs' directory.</p>
</div>
<div class="paragraph">
<p>Additionally, you can plug a custom handler to the Validator by defining a <code>ValidationListener</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">validator.setValidationListener(validationListener);

<span class="directive">private</span> <span class="directive">static</span> DefaultCertificateValidatorListener validationListener = <span class="keyword">new</span> MyCertificateValidationListener();</code></pre>
</div>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
 * A sampler listener for certificate validation results.
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyCertificateValidationListener</span> <span class="directive">implements</span> DefaultCertificateValidatorListener {

  <span class="annotation">@Override</span>
  <span class="directive">public</span> ValidationResult onValidate(Cert certificate, ApplicationDescription applicationDescription,
      <span class="predefined-type">EnumSet</span>&lt;CertificateCheck&gt; passedChecks) {
    <span class="comment">// Called whenever the PkiFileBasedCertificateValidator has</span>
    <span class="comment">// validated a certificate {</span>
                [...]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The SampleConsoleClient application uses the listener to prompt the user whether to accept the server certificate. The user can accept the certificate permanently, just once or reject it completely. In the first case, the certificate is placed in the 'certs' folder automatically, and in the latter cases, it is placed in the 'rejected' folder. In the last case, connection to the server is cancelled due to the certificate rejection.</p>
</div>
<div class="paragraph">
<p>You are, of course, free to use the listener to define any custom logic, but in principle, you should only trust certificates for which <code>passedChecks</code> equals <code>CertificateCheck.COMPULSORY</code>. Normally you can trust self-signed certificates, so that check is not included in the <code>COMPULSORY</code> definition. Most OPC UA certificates will probably be self-signed, because they are easy to generate automatically. A proper Certificate Authority should be preferred in real systems to enable a properly managed system for certificate management.</p>
</div>
<div class="sect3">
<h4 id="validating-https-certificates"><a class="anchor" href="#validating-https-certificates"></a>6.4.1. Validating HTTPS Certificates</h4>
<div class="paragraph">
<p>HTTPS connection is established with special HTTPS certificates that differ from the Application Instance Certificates. Only client needs to validate the server&#8217;s HTTPS Certificate, the server does not validate client&#8217;s HTTPS Certificate. By default <code>MessageSecurityMode</code> is <code>None</code> with HTTPS, in which case the servers will not authenticate the client applications. In order to enable application authentication, <code>MessageSecurityMode</code> <code>Sign</code> must be used. In this case the applications are authenticated using the Application Instance Certificates similar to the UA TCP communication.</p>
</div>
<div class="paragraph">
<p>In order to validate the HTTPS Certificates of servers, you can plug a validator (which can also be the same that you use for validating Application Instance Certificates) to <code>HttpsSettings</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">client.getHttpsSettings().setHttpsCertificateValidator(validator);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Typically, HTTPS certificates are signed with CA certificates, so in order to trust a HTTPS certificate of a server in your application, you must copy the respective CA certificate to the certificate store as trusted.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="teach-yourself-the-security-details"><a class="anchor" href="#teach-yourself-the-security-details"></a>6.5. Teach Yourself the Security Details</h3>
<div class="paragraph">
<p>OPC UA uses security heavily to guarantee that the applications can be safely used in real production environments. The security only works when configured properly, so you should make yourself familiar with the concepts and learn to configure these systems.</p>
</div>
<div class="paragraph">
<p>Read the <em>OPC Unified Architecture</em> book by Mahnke et al. for more details on the OPC UA security settings and how they should be applied. The security technology follows standard PKI (Public Key Infrastructure) principles, so all material related to that can also be used to understand the basics.</p>
</div>
<div class="paragraph">
<p>Also, try different settings in different environments so that you know more than you guess.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="connecting-and-disconnecting"><a class="anchor" href="#connecting-and-disconnecting"></a>7. Connecting and Disconnecting</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once you have managed to get over the first compulsory hurdles of defining where and how to connect, you can simply connect to the server with</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">client.connect();</code></pre>
</div>
</div>
<div class="paragraph">
<p>If that fails, you will get an exception. If the actual connection cannot be made, you will get a <code>ServerConnectionException</code>. If you get a connection, but something goes wrong in the server, the <code>UaClient</code> typically throws a <code>ServiceException</code>. You may also see a <code>ServiceFaultException</code>, <code>ServiceResultException</code> or some other runtime exception, which are thrown from the actual OPC UA Stack.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Often the original exception from the Stack is also available as the <code>Cause</code> from the <code>ServiceException</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you have the connection, you can start playing with the server. When running the <code>SampleConsoleClient</code> application, you are presented with a menu in the console output where you can pick up the tasks you may want to try out.</p>
</div>
<div class="paragraph">
<p>Once you are finished testing, you can disconnect the client by simply calling</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">client.disconnect();</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="connection-monitoring"><a class="anchor" href="#connection-monitoring"></a>7.1. Connection Monitoring</h3>
<div class="paragraph">
<p>Each service call that you make to the server can fail, for example, if the connection is lost due to network problems or the server is simply shut down.</p>
</div>
<div class="sect3">
<h4 id="serviceexception"><a class="anchor" href="#serviceexception"></a>7.1.1. ServiceException</h4>
<div class="paragraph">
<p>The service calls (described in the following sections) raise a <code>ServiceException</code> in case of communication or other service errors.</p>
</div>
</div>
<div class="sect3">
<h4 id="timeout"><a class="anchor" href="#timeout"></a>7.1.2. Timeout</h4>
<div class="paragraph">
<p>The OPC UA Java Stack handles temporary communication errors by retrying to establish a lost connection in certain cases. It also takes care of timeout handling, i.e. the synchronous service calls are monitored for a response until the timeout delay occurs without a response. You can define the default timeout (in milliseconds) to use in the <code>UaClient</code> with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">client.setTimeout(<span class="integer">30000</span>);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="server-status-monitoring"><a class="anchor" href="#server-status-monitoring"></a>7.1.3. Server Status Monitoring</h4>
<div class="paragraph">
<p>When connected to a server, the <code>UaClient</code> periodically monitors the value of ServerStatus, which is a compulsory Object in the OPC UA server address space. It will perform a check every <code>StatusCheckInterval</code>, which is 1 second by default. The client uses a specific timeout setting, <code>StatusCheckTimeout</code> (default value is 10 seconds) to detect communication breaks.</p>
</div>
<div class="paragraph">
<p>You can listen to changes in the status by defining your own <code>ServerStatusListener</code>, for example as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
 * A sampler listener for server status changes.
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyServerStatusListener</span> <span class="directive">implements</span> ServerStatusListener {
  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> onShutdown(UaClient uaClient, <span class="type">long</span> secondsTillShutdown, LocalizedText shutdownReason) {
    <span class="comment">// Called when the server state changes to Shutdown</span>
    SampleConsoleClient.printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Server shutdown in %d seconds. Reason: %s</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>, secondsTillShutdown,
        shutdownReason.getText());
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> onStateChange(UaClient uaClient, ServerState oldState, ServerState newState) {
    <span class="comment">// Called whenever the server state changes</span>
    SampleConsoleClient.printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">ServerState changed from %s to %s</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>, oldState, newState);
    <span class="keyword">if</span> (newState.equals(ServerState.Unknown)) {
      SampleConsoleClient.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">ServerStatusError: </span><span class="delimiter">&quot;</span></span> + uaClient.getServerStatusError());
    }
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> onStatusChange(UaClient uaClient, ServerStatusDataType status, StatusCode code) {
    <span class="comment">// Called whenever the server status changes, typically every</span>
    <span class="comment">// StatusCheckInterval defined in the UaClient.</span>
    <span class="comment">// SampleConsoleClient.println(&quot;ServerStatus: &quot; + status + &quot;, code: &quot; + code);</span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then set the client to use the new listener with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">protected</span> ServerStatusListener serverStatusListener = <span class="keyword">new</span> MyServerStatusListener();
...
client.addServerStatusListener(serverStatusListener);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="automatic-reconnect"><a class="anchor" href="#automatic-reconnect"></a>7.1.4. Automatic Reconnect</h4>
<div class="paragraph">
<p>The <code>UaClient</code> enables automatic reconnections in case the communication fails. Whenever the status read fails due to a connection or timeout error or if the server notifies about a shutdown, the <code>UaClient</code> will start to perform reconnect attempts every second in accordance to the procedure suggested in the OPC UA specifications.</p>
</div>
<div class="paragraph">
<p>If you wish to disable the automatic reconnect feature, call <code>UaClient.setAutoReconnect(false)</code>. In this case, you can try to reconnect yourself by calling <code>UaClient.reconnect()</code> until it succeeds.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="opc-ua-server-address-space"><a class="anchor" href="#opc-ua-server-address-space"></a>8. OPC UA Server Address Space</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OPC UA server applications provide all the data that they have available in their address space which is constructed in a standardised way according to the OPC UA Address Space Model. This helps client applications locate all relevant data from the server even if they don&#8217;t have any prior knowledge about it.</p>
</div>
<div class="paragraph">
<p>The OPC UA client applications identify data in the OPC UA server using Node Identifiers (NodeIds). NodeIds are used to uniquely identify all information in the address space which consists of Nodes that can be Objects, Variables or various Types. Nodes have Attributes that define their properties and, for example, contain the data that the Node provides (in the Value Attribute). Nodes are connected to each by References that signify their relationship, for example, the HasComponent Reference connects an Object and a Variable inside it. NodeIds are used when the client sends read or write requests to the server, for example. If the client applications don&#8217;t have the NodeId of a certain Node available, they can <em>browse</em> the server address space to find it.</p>
</div>
<div class="paragraph">
<p>You can use the <a href="https://www.prosysopc.com/products/opc-ua-client/">Prosys OPC UA Client</a> application to explore the address space of any OPC UA server visually and access the information inside it.</p>
</div>
<div class="sect2">
<h3 id="browse-the-address-space"><a class="anchor" href="#browse-the-address-space"></a>8.1. Browse the Address Space</h3>
<div class="paragraph">
<p>Typically, the first thing to do is to find the server items you wish to read or write. The OPC UA address space is a bit more complex structure than you might expect, but nevertheless, you can explore it by browsing.</p>
</div>
<div class="paragraph">
<p>In the <code>UaClient</code>, the address space is accessed through the <code>AddressSpace</code> property. You can call <code>browse()</code> to request Nodes from the server.</p>
</div>
<div class="paragraph">
<p>The <code>SampleConsoleClient</code> uses an internal variable, called <code>nodeId</code> to keep track of the "current Node" that is the target of all client operations. The <code>nodeId</code> is initialized to the value <code>Identifiers.RootFolder</code>, which is a standard NodeId defined in the OPC UA specification. It corresponds to the root of the address space, which all servers must support. In addition, the servers must provide three standard subfolders under the <code>RootFolder</code>: <code>ObjectsFolder</code>, <code>TypesFolder</code> and <code>ViewsFolder</code>. You can start browsing from one of these to dynamically explore the available data and metadata (such as types) available from the server.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>Identifiers</code> class is generated in the OPC UA Java Stack to contain the NodeId of every Node that is defined in the OPC UA specification.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>So, in order to browse the address space with the <code>SampleConsoleClient</code>, you start from the <code>RootFolder</code> and follow References between the Nodes. There may be a huge number of References from a Node, so you can define some communication limits to the server. You can set these with the different properties of the <code>AddressSpace</code>, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">client.getAddressSpace().setMaxReferencesPerNode(<span class="integer">1000</span>);
client.getAddressSpace().setReferenceTypeId(Identifiers.HierarchicalReferences);</code></pre>
</div>
</div>
<div class="paragraph">
<p>by which you define a limit of 1000 References per call to the server and that you only wish to receive the hierarchical References between the Nodes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>AdressSpace</code> will in fact use the <code>MaxReferencesPerNode</code> internally while communicating with the server. In practice, it will make subsequent calls to the server until it receives all the References, even in the case that the current Node has more References than defined by the limit. The limit is just necessary to avoid timeouts and too large messages in the communication.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now, if you call</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;ReferenceDescription&gt; references = client.getAddressSpace().browse(nodeId);</code></pre>
</div>
</div>
<div class="paragraph">
<p>you will get a list of <code>ReferenceDescription</code> entries from the server. From these, you can find the target Nodes, which you can browse next. In the <code>SampleConsoleClient</code>, you may choose which Node to browse next, or to end browsing and stay at the Node you are at that point. Check the sample code to see the specifics of the methods that are used to let you browse around the address space.</p>
</div>
</div>
<div class="sect2">
<h3 id="browsing-through-the-nodes"><a class="anchor" href="#browsing-through-the-nodes"></a>8.2. Browsing Through the Nodes</h3>
<div class="paragraph">
<p>An alternative way to browsing using specific NodeIds is to follow the references between Node objects. You can access the References simply with <code>node.getReferences()</code>, for example.
See the section <a href="#usingNodes">Using Node Objects</a> for more about that.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="read-values"><a class="anchor" href="#read-values"></a>9. Read Values</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once you have a Node selected, you can read the Attributes of the Node. There are actually several alternative read calls that you can make in the <code>UaClient</code>. In <code>SampleConsoleClient</code> we use the basic</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">DataValue value = client.readAttribute(nodeId, attributeId);</code></pre>
</div>
</div>
<div class="paragraph">
<p>which reads the value of a single Attribute from a Node in the server. The Attribute to read is defined by the <code>attributeId</code>. Valid IDs are defined in the <code>Attributes</code> class. Note that different Node types (or NodeClasses according to the OPC UA terminology) support different Attributes. For example, the <code>Attributes.Value</code> attribute is only supported by the <code>Variable</code> and <code>VariableType</code> Nodes.</p>
</div>
<div class="paragraph">
<p>In general, you should avoid calling the read methods for individual items. If you need to read several items at the same time, you should use <code>readAttributes()</code> (to read several Attributes from one Node), <code>readValues()</code> (to read the Value Attribute for several Variables) or consider using <code>read()</code>. The <code>read()</code> method is a bit more complicated to use, but it will only make a single call to the server to read any number of Attributes of any Nodes.</p>
</div>
<div class="paragraph">
<p>If you actually want to monitor Variables that are changing on the server, you had better use the Subscriptions, as described below in <a href="#subscriptions">Subscribe to Data Changes</a>.</p>
</div>
<div class="paragraph">
<p>The method will throw <code>ServiceException</code> or <code>StatusException</code> if the call does fail (see <a href="#exceptions-when-operations-fail">Exceptions When Operations Fail</a> for more information).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="write-values"><a class="anchor" href="#write-values"></a>10. Write Values</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Similar to reading, you can also write values to the server. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">boolean</span> status = client.writeAttribute(nodeId, attributeId, value);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The method will throw <code>ServiceException</code> or <code>StatusException</code> if the call does fail (see <a href="#exceptions-when-operations-fail">Exceptions When Operations Fail</a> for more information).</p>
</div>
<div class="paragraph">
<p>The return value will indicate if the write operation completes successfully and synchronously (true) or completes asynchronously (false).</p>
</div>
<div class="paragraph">
<p>Similar to the read methods, you also have better options for writing several values at the same time: <code>writeAttributes()</code>, <code>writeValues()</code> and the generic <code>write()</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exceptions-when-operations-fail"><a class="anchor" href="#exceptions-when-operations-fail"></a>11. Exceptions When Operations Fail</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If any service call or operation fails, you will get an <code>Exception</code>. For service call errors, such as when the server could not handle the service request at all, you can expect a <code>ServiceException</code>. When performing a single operation, any failure (for example calling <code>readAttribute()</code> with an invalid <code>nodeId</code> or <code>attributeId</code> or calling <code>writeValue()</code> to a variable that does not permit changes) will produce a <code>StatusException</code>.</p>
</div>
<div class="paragraph">
<p>If you perform several operations inside a single call (such as <code>readValues()</code>), you can only expect a <code>ServiceException</code>. For each operation you will get a <code>StatusCode</code> that indicates which individual operation succeeded and which failed. Use <code>StatusCode.isBad()</code> and <code>.isGood()</code> to check whether the operation failed or not. The <code>StatusCode</code> provides a complete status code, which you can check against all status codes defined in the OPC UA specification. In case of failure, you may also get additional information in a <code>DiagnosticInfo</code> structure. These fields are present in the exceptions. You can also examine the result codes of the last service call from <code>client.getLastServiceDiagnostics()</code> and <code>getLastOperationDiagnostics()</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>StatusCode</code> defines actually three different severities: Good, Bad and Uncertain. Good usually comes without additional information, whereas Bad and Uncertain will also include a more detailed error code. The status codes defined in the OPC UA specification are available from the OPC UA Java Stack class <code>StatusCodes</code>. The actual values are <code>UnsignedInteger</code>s to which you can compare them. For example <code>StatusCodes.Bad_UserAccessDenied.equals(exception.getStatusCode().getValue())</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="subscriptions"><a class="anchor" href="#subscriptions"></a>12. Subscribe to Data Changes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to monitor changes in the server, you need to define subscriptions. These include a number of monitored items, which you listen to. To monitor data changes, you use the <code>MonitoredDataItem</code> class. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">subscription = <span class="keyword">new</span> Subscription();
MonitoredDataItem item = <span class="keyword">new</span> MonitoredDataItem(nodeId, attributeId, MonitoringMode.Reporting);
subscription.addItem(item);
client.addSubscription(subscription);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This defines a subscription with a single item. Of course you can define any number of subscriptions and each with any number of items. The subscription defines the default monitoring properties for all its items, but the items may also define individual sampling intervals (see the properties of <code>MonitoredDataItem</code>) that can be set with the <code>setSamplingInterval()</code> method.</p>
</div>
<div class="paragraph">
<p>In the client, you can then just listen to the change notifications which the server is instructed to send when the item values change according to the subscription properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">item.setDataChangeListener(dataChangeListener);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The listener is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">  <span class="directive">protected</span> MonitoredDataItemListener dataChangeListener = <span class="keyword">new</span> MyMonitoredDataItemListener(<span class="local-variable">this</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
 * A sample listener for monitored data changes.
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyMonitoredDataItemListener</span> <span class="directive">implements</span> MonitoredDataItemListener {
  <span class="directive">private</span> <span class="directive">final</span> SampleConsoleClient client;

   <span class="directive">public</span> MyMonitoredDataItemListener(SampleConsoleClient client) {
    <span class="local-variable">super</span>();
    <span class="local-variable">this</span>.client = client;
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> onDataChange(MonitoredDataItem sender, DataValue prevValue, DataValue value) {
    SampleConsoleClient.println(client.dataValueToString(sender.getNodeId(), sender.getAttributeId(), value));
  }
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can add a notification listener either to the subscription or to each item. The latter will provide you more detailed information on the data changes, but creating the listener to the subscription can be easier to use and more light-weight. The <code>SampleConsoleClient</code> demonstrates both, but uses mainly the item-based listener.</p>
</div>
<div class="paragraph">
<p>You may also wish to listen to the alive and timeout events in the subscription. These will help you verify that the server is actively monitoring the values, even in the case that the values are not actually changing and therefore new data change notifications are not being sent. The example below demonstrates how to add such a listener to a subscription:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">protected</span> SubscriptionAliveListener subscriptionAliveListener = <span class="keyword">new</span> MySubscriptionAliveListener();
...
subscription.addAliveListener(subscriptionAliveListener);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The functionality related to different events needs be implemented in the respective methods of the listener class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
 * A sampler listener for subscription alive events.
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MySubscriptionAliveListener</span> <span class="directive">implements</span> SubscriptionAliveListener {

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> onAfterCreate(Subscription s) {
    <span class="comment">// the subscription was (re)created to the server</span>
    <span class="comment">// this happens if the subscription was timed out during</span>
    <span class="comment">// a communication break and had to be recreated after reconnection</span>
    SampleConsoleClient.println(<span class="predefined-type">String</span>.format(<span class="string"><span class="delimiter">&quot;</span><span class="content">%tc Subscription created: ID=%d lastAlive=%tc</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Calendar</span>.getInstance(),
        s.getSubscriptionId().getValue(), s.getLastAlive()));
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> onAlive(Subscription s) {
    <span class="comment">// the server acknowledged that the connection is alive,</span>
    <span class="comment">// although there were no changes to send</span>
    SampleConsoleClient.println(<span class="predefined-type">String</span>.format(<span class="string"><span class="delimiter">&quot;</span><span class="content">%tc Subscription alive: ID=%d lastAlive=%tc</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Calendar</span>.getInstance(),
        s.getSubscriptionId().getValue(), s.getLastAlive()));
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> onLifetimeTimeout(Subscription s) {
    SampleConsoleClient.println(<span class="predefined-type">String</span>.format(<span class="string"><span class="delimiter">&quot;</span><span class="content">%tc Subscription lifetime ended: ID=%d lastAlive=%tc</span><span class="delimiter">&quot;</span></span>,
        <span class="predefined-type">Calendar</span>.getInstance(), s.getSubscriptionId().getValue(), s.getLastAlive()));

  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> onTimeout(Subscription s) {
    <span class="comment">// the server did not acknowledge that the connection is alive, and the</span>
    <span class="comment">// maxKeepAliveCount has been exceeded</span>
    SampleConsoleClient.println(<span class="predefined-type">String</span>.format(<span class="string"><span class="delimiter">&quot;</span><span class="content">%tc Subscription timeout: ID=%d lastAlive=%tc</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Calendar</span>.getInstance(),
        s.getSubscriptionId().getValue(), s.getLastAlive()));

  }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="subscribe-to-events"><a class="anchor" href="#subscribe-to-events"></a>13. Subscribe to Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In addition to subscribing to data changes in the server Variables, you may also listen to events from event notifiers. You can use the same subscriptions, but instead of <code>MonitoredDataItem</code> you use <code>MonitoredEventItem</code>. You define an event listener, which gets notified when new events are received from the server. Additionally, you must also define the event filter (using the <code>EventFilter</code> class, which defines the event fields you wish to monitor (with the <code>SelectClauses</code> property of the <code>EventFilter</code> class) and optionally also which events you wish to receive (with the <code>WhereClause</code> property of the <code>EventFilter</code> class).</p>
</div>
<div class="paragraph">
<p>We have defined the fields as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">        <span class="directive">protected</span> <span class="directive">final</span> QualifiedName<span class="type">[]</span> eventFieldNames = {
                <span class="keyword">new</span> QualifiedName(<span class="string"><span class="delimiter">&quot;</span><span class="content">EventType</span><span class="delimiter">&quot;</span></span>), <span class="keyword">new</span> QualifiedName(<span class="string"><span class="delimiter">&quot;</span><span class="content">Message</span><span class="delimiter">&quot;</span></span>),
                <span class="keyword">new</span> QualifiedName(<span class="string"><span class="delimiter">&quot;</span><span class="content">SourceName</span><span class="delimiter">&quot;</span></span>), <span class="keyword">new</span> QualifiedName(<span class="string"><span class="delimiter">&quot;</span><span class="content">Time</span><span class="delimiter">&quot;</span></span>),
                <span class="keyword">new</span> QualifiedName(<span class="string"><span class="delimiter">&quot;</span><span class="content">Severity</span><span class="delimiter">&quot;</span></span>), <span class="keyword">new</span> QualifiedName(<span class="string"><span class="delimiter">&quot;</span><span class="content">ActiveState/Id</span><span class="delimiter">&quot;</span></span>)
        };</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The current version of the client is actually adding two custom fields in <code>eventFieldNames</code> as well. These are initialized to <code>null</code> and created at run-time, because the QualifiedName-identifiers need a <code>namespaceIndex</code> which depends on the dynamic index in the server. See the code sample for details in <code>initEventFieldNames()</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>createBrowsePath()</code> method used in the <code>SampleConsoleClient</code> is a special feature of the sample. It breaks the QualifiedNames, which have ‘/’ delimiters to a browse path, i.e. an array of QualifiedNames.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We can define <code>SelectClauses</code> for the filter respectively:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">NodeId eventTypeId = Identifiers.BaseEventType;
UnsignedInteger eventAttributeId = <span class="predefined-type">Attributes</span>.Value;
<span class="predefined-type">String</span> indexRange = <span class="predefined-constant">null</span>;
SimpleAttributeOperand<span class="type">[]</span> selectClauses =
        <span class="keyword">new</span> SimpleAttributeOperand[eventFields.length + <span class="integer">1</span>];
<span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; eventFields.length; i++) {
        QualifiedName<span class="type">[]</span> browsePath = createBrowsePath(eventFields[i]);
        selectClauses[i] = <span class="keyword">new</span> SimpleAttributeOperand(eventTypeId, browsePath, eventAttributeId, indexRange);
}
<span class="comment">// Add a field to get the NodeId of the event source</span>
selectClauses[eventFields.length] = <span class="keyword">new</span> SimpleAttributeOperand(
        eventTypeId, <span class="predefined-constant">null</span>, <span class="predefined-type">Attributes</span>.NodeId, <span class="predefined-constant">null</span>);
EventFilter filter = <span class="keyword">new</span> EventFilter();
<span class="comment">// Event field selection</span>
filter.setSelectClauses(selectClauses);</code></pre>
</div>
</div>
<div class="paragraph">
<p>And next we filter the events we want to receive using the <code>WhereClause</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Event filtering: the following sample creates a</span>
<span class="comment">// &quot;Not OfType GeneralModelChangeEventType&quot; filter</span>
ContentFilterBuilder fb = <span class="keyword">new</span> ContentFilterBuilder();

<span class="comment">// The element operand refers to another operand -</span>
<span class="comment">// operand #1 in this case which is the next,</span>
<span class="comment">// LiteralOperand</span>
fb.add(FilterOperator.Not, <span class="keyword">new</span> ElementOperand(
        UnsignedInteger.valueOf(<span class="integer">1</span>)));
<span class="directive">final</span> LiteralOperand filteredType = <span class="keyword">new</span> LiteralOperand(
        <span class="keyword">new</span> Variant(Identifiers.GeneralModelChangeEventType));
fb.add(FilterOperator.OfType, filteredType);
filter.setWhereClause(fb.getContentFilter());</code></pre>
</div>
</div>
<div class="paragraph">
<p>This one just filters out possible ModelChangeEvents. There are various operators that you can use. Most of them require two arguments, e.g. <code>fb.add(FilterOperator.Equals, operand1, operand2)</code>. Note however, that the <code>WhereClause</code> of the filter is optional; if you leave it out, you will get all events under the object Node that you subscribe to.</p>
</div>
<div class="paragraph">
<p>So, finally we are ready to create the event item using the <code>filter</code> that was just created and the NodeId of the node that should be listened to in the <code>nodeId</code> variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MonitoredEventItem eventItem = <span class="keyword">new</span> MonitoredEventItem(nodeId, filter);
eventItem.addEventListener(eventListener);
subscription.addItem(eventItem);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The event listener is defined as follows, and used to react to the event notification:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">  <span class="directive">protected</span> <span class="directive">final</span> MonitoredEventItemListener eventListener = <span class="keyword">new</span> MyMonitoredEventItemListener(<span class="local-variable">this</span>, eventFieldNames);</code></pre>
</div>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
 * A sampler listener for monitored event notifications.
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyMonitoredEventItemListener</span> <span class="directive">implements</span> MonitoredEventItemListener {
  <span class="directive">private</span> <span class="directive">final</span> SampleConsoleClient client;
  <span class="directive">private</span> <span class="directive">final</span> QualifiedName<span class="type">[]</span> requestedEventFields;

  <span class="comment">/**
   * @param client
   * @param eventFieldNames
   */</span>
  <span class="directive">public</span> MyMonitoredEventItemListener(SampleConsoleClient client, QualifiedName<span class="type">[]</span> requestedEventFields) {
    <span class="local-variable">super</span>();
    <span class="local-variable">this</span>.requestedEventFields = requestedEventFields;
    <span class="local-variable">this</span>.client = client;
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> onEvent(MonitoredEventItem sender, Variant<span class="type">[]</span> eventFields) {
    SampleConsoleClient.println(client.eventToString(sender.getNodeId(), requestedEventFields, eventFields));
  }
};</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="history-access"><a class="anchor" href="#history-access"></a>14. History Access</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OPC UA servers may also provide history information for the Nodes, including historical time series data and events. You can read the AccessLevel and UserAccessLevel attributes of a Variable Node to see whether history is available (if yes, then <code>AccessLevel.HistoryRead</code> should be included).</p>
</div>
<div class="sect2">
<h3 id="reading-history"><a class="anchor" href="#reading-history"></a>14.1. Reading History</h3>
<div class="paragraph">
<p>To actually read history data, you have several options. The basic way is to use <code>UaClient.historyRead()</code>, which is recommended if you need to do several readings at once. This example reads a complete history for a single Node (specified by <code>nodeId</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HistoryReadDetails details = <span class="keyword">new</span> ReadRawModifiedDetails(<span class="predefined-constant">false</span>,
        DateTime.MIN_VALUE, DateTime.currentTime(),
        UnsignedInteger.MAX_VALUE, <span class="predefined-constant">true</span>);
HistoryReadValueId nodesToRead = <span class="keyword">new</span> HistoryReadValueId(
        nodeId, <span class="predefined-constant">null</span>,
        QualifiedName.DEFAULT_BINARY_ENCODING, <span class="predefined-constant">null</span>);
HistoryReadResult<span class="type">[]</span> result = client.historyRead(details,
        TimestampsToReturn.Both, <span class="predefined-constant">true</span>, nodesToRead);

HistoryData d = result[<span class="integer">0</span>].getHistoryData().decode();
DataValue<span class="type">[]</span> values = d.getDataValues();</code></pre>
</div>
</div>
<div class="paragraph">
<p>What you need to be aware of is that there are several “methods” that the <code>historyRead()</code> actually supports, depending on which <code>HistoryReadDetails</code> you use. For example, in the above example we used <code>ReadRawModifiedDetails</code>, to read a raw history (the same structure is used to read modified history as well, therefore the name).</p>
</div>
<div class="paragraph">
<p>To make your life a bit easier, <code>UaClient</code> also defines several convenience methods to make specific history requests. For example, the above can also be performed with</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">DataValue<span class="type">[]</span> result = client.historyReadRaw(nodeId,
        DateTime.MIN_VALUE, DateTime.currentTime(),
        UnsignedInteger.MAX_VALUE, <span class="predefined-constant">true</span>, <span class="predefined-constant">null</span>, TimestampsToReturn.Source);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="updating-or-deleting-history"><a class="anchor" href="#updating-or-deleting-history"></a>14.2. Updating or Deleting History</h3>
<div class="paragraph">
<p>To modify existing history data in the server, you can use the <code>historyUpdate()</code> method or, again, one of the convenience methods that provide you with more semantics. See the documentation for the various <code>historyUpdateXxx()</code> and <code>historyDeleteXxx()</code> methods in <code>UaClient</code> for more about those.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="calling-methods"><a class="anchor" href="#calling-methods"></a>15. Calling Methods</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OPC UA also defines a mechanism to call Methods in the server Objects.</p>
</div>
<div class="paragraph">
<p>To find out if an Object defines Methods, you can call</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;UaMethod&gt; methods = client.getAddressSpace().getMethods(nodeId);</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>UaMethod</code> is a Node object, which gets stored into the <code>NodeCache</code> (see <a href="#usingNodes">Using Node Objects</a>). If you wish to perform a light browse, you can just call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;ReferenceDescription&gt; methodRefs = client.getAddressSpace().browseMethods(nodeId);</code></pre>
</div>
</div>
<div class="paragraph">
<p>to get a list of the Method References from the Node.</p>
</div>
<div class="paragraph">
<p>The <code>UaMethod</code> is initialized with the <code>InputArguments</code> and <code>OutputArguments</code> properties, which you can examine for the argument name, type, etc.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Argument<span class="type">[]</span> inputArguments = method.getInputArguments();
Argument<span class="type">[]</span> outputArguments = method.getOutputArguments();</code></pre>
</div>
</div>
<div class="paragraph">
<p>To actually call the Method, you need to provide a valid value (as <code>Variant</code>) for each of the InputArguments, and just call it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Variant<span class="type">[]</span> outputs = client.call(nodeId, methodId, inputs);</code></pre>
</div>
</div>
<div class="paragraph">
<p>As a result you get values for the <code>OutputArguments</code>.</p>
</div>
<div class="paragraph">
<p>Note also that you will usually need to use the <code>DataTypeConverter</code> to convert the <code>inputArguments</code> to the correct data type, before calling the Method. The OPC UA specification defines that the server may not convert the arguments, if they are provided with incorrect data types. So you will get <code>Bad_InvalidArgument</code> errors for each argument that is not provided in the correct data type. See the sample code (inside <code>SampleConsoleClient.readInputArguments()</code>) for more details.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registering-and-unregistering-nodes"><a class="anchor" href="#registering-and-unregistering-nodes"></a>16. Registering and Unregistering Nodes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>These services are meant for improved performance. You can request the server to prepare some Nodes to which you will refer often in your client application by registering them with the RegisterNodes service call. The server may also define new and more efficient NodeIds for the Nodes and the client can then use the new NodeIds instead of the NodeIds it received by browsing the address space.</p>
</div>
<div class="paragraph">
<p>You can access these from the <code>AddressSpace</code>. To register a Node for quick access, call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">NodeId<span class="type">[]</span> registeredNodeId = client.getAddressSpace().registerNodes(nodeId);</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you are done, you can unregister the Nodes using, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">NodeId<span class="type">[]</span> nodes = client.getAddressSpace().unregisterAllNodes();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
These methods are not usually necessary and not always supported by the servers anyway, so you can usually ignore them. If the server manufacturer suggests, you could consider using them.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="usingNodes"><a class="anchor" href="#usingNodes"></a>17. Using Node Objects</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>AddressSpace</code> object in the <code>UaClient</code> can also cache Nodes on the client side. These <code>UaNode</code> objects will help you to browse the address space and to use the information in your application more conveniently.</p>
</div>
<div class="paragraph">
<p>You can simply request the Node objects from the address space using the methods <code>getNode()</code>, <code>getType()</code>, <code>getMethods()</code>, etc.</p>
</div>
<div class="paragraph">
<p>To see it in action, just go and explore the sample code in more detail – especially the methods <code>printCurrentNode()</code> and <code>referenceToString()</code>.</p>
</div>
<div class="paragraph">
<p><code>getNode()</code> is even more useful when used together with code generation. If you register generated classes, you can use complete UA types in your application through the respective Java classes. Read on to learn more about that.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="information-modeling-and-code-generation"><a class="anchor" href="#information-modeling-and-code-generation"></a>18. Information Modeling and Code Generation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Prosys OPC UA SDK for Java supports loading existing OPC UA information models in the NodeSet2 XML format (a standard format defined in the OPC UA specification). By default, type definitions from the most important companion specifications are already generated for the client SDK. You can also define your own information models and utilise the type definitions in client applications by importing the XML files. For modeling, you can use the <a href="https://www.prosysopc.com/products/opc-ua-modeler/">OPC UA Modeler</a> application.</p>
</div>
<div class="sect2">
<h3 id="prosys-opc-ua-sdk-for-java-code-generator"><a class="anchor" href="#prosys-opc-ua-sdk-for-java-code-generator"></a>18.1. Prosys OPC UA SDK for Java Code Generator</h3>
<div class="paragraph">
<p>You can generate Java classes based on information models stored in the NodeSet2 XML format with the help of the Code Generator provided with the Prosys OPC UA SDK for Java. The Code Generator is located in the 'codegen' folder of the distribution package.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>For instructions on using the Code Generator provided with the Prosys OPC UA SDK for Java, please refer to the Code Generator Manual in the 'codegen' folder of the distribution package.</strong></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Follow the instructions in the included manual and experiment with the samples to learn how to configure and execute the code generation procedure. Then you may return to this tutorial and read the following sections on how to utilize the generated classes in your own applications.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-the-generated-classes-from-applications"><a class="anchor" href="#using-the-generated-classes-from-applications"></a>18.2. Using the Generated Classes from Applications</h3>
<div class="paragraph">
<p>The classes generated with the Code Generator enable simple usage of the type definitions defined in the source information models. With the generated classes, the client application is able to handle the instances of the custom types in OPC UA servers as Java Node objects.</p>
</div>
<div class="paragraph">
<p>This section explains how the Java classes generated using the Code Generator can be imported to and utilized in applications developed using the Prosys OPC UA Java Client SDK.</p>
</div>
</div>
<div class="sect2">
<h3 id="registering-the-model"><a class="anchor" href="#registering-the-model"></a>18.3. Registering the Model</h3>
<div class="paragraph">
<p>The generated Java classes for ObjectTypes and VariableTypes are more extended versions of the standard <code>UaNode</code> implementations. In order for the SDK to use the generated classes instead of the basic implementations, the SDK must be made aware of the generated classes. This is called registering the model.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-instances-of-generated-types"><a class="anchor" href="#using-instances-of-generated-types"></a>18.4. Using Instances of Generated Types</h3>
<div class="paragraph">
<p>The client implementation classes are generated into 'client' sub-packages under the defined generation folders.</p>
</div>
<div class="paragraph">
<p>To use the generated Java classes in your applications:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add the generated files to your project source path.</p>
</li>
<li>
<p>Register generated classes with <code>UaClient.registerModel(CodegenModel model)</code>. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">client.registerModel(example.packagename.client.ClientInformationModel.MODEL);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Starting from 4.0.0, you can ignore this, if you have generated support for Automatic Discovery of Generated Models in Code Generator. Please see the Codegen Manual for more information.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Read instances with <code>client.getAddressSpace().getNode(NodeId id)</code>. You have to cast the result to the correct generated type. Alternatively you can pass a Class parameter of the correct type as additional parameter, e.g.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AnalogItemType node = client.getAddressSpace().getNode(&lt;NodeId&gt;, AnalogItemType.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The SDK distribution package provides a sample information model in the 'SampleTypes.xml' file inside
the 'models' folders of both of the Code Generator versions (i.e. command line and Maven). The
classes generated based on this model are used in the following example. A complete example of the procedure for using an instance of the <code>ValveObjectType</code> from the 'SampleTypes.xml' information model is also demonstrated in the example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// 1. Register the generated classes in your UaClient object by</span>
<span class="comment">// using the ClientInformationModel class that is generated in the client package.</span>
client.registerModel(example.packagename.client.ClientInformationModel.MODEL);

<span class="comment">// 2. Get a node from the server using an AddressSpace object.</span>
<span class="comment">// Give the nodeId of the instance as a parameter.</span>
<span class="comment">// Cast the return value to the corresponding generated class</span>
ValveObjectType sampleValve =
  (ValveObjectType) client.getAddressSpace().getNode(nodeId);

<span class="comment">// 3. Use the instance.</span>
<span class="comment">// e.g. get the cached value of the PowerInput Property</span>
sampleValve.getPowerInput();</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Calling the getter for component values will internally get the node from the <code>AddressSpace</code> and get the value from it. It does not directly make a read call to the server, unless the node is not present in the <code>AddressSpace</code>'s <code>NodeCache</code>. You need to use <code>read()</code> methods in the <code>UaClient</code> if you need the latest values.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Calling the setter for component values sets the value to the local node, i.e. it is not written to the server. You need to use <code>write()</code> methods in the <code>UaClient</code> to write the value to the server.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="reverse-connections"><a class="anchor" href="#reverse-connections"></a>19. Reverse Connections</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OPC UA Specification 1.04 defines a new way to open UA TCP connections, called Reverse Connection. In this mode, the server application will open the connection, contrary to the normal connection opened by the client. This can be useful in situations where the server is behind a firewall that cannot let client connections go through to the server.</p>
</div>
<div class="paragraph">
<p>In order to enable the reverse connection, the client application will first open a TCP/IP socket in a custom port. The Server may then open the connection to the client socket. After that the client will create the UA TCP secure channel and session to the server as usual, including all security details.</p>
</div>
<div class="paragraph">
<p>In <code>UaClient</code> this can be achieved by defining the socket to be listened with either <code>UaClient.setReversePort()</code> or <code>UaClient.setReverseAddress()</code>. Now, when you call <code>connect()</code>, the client will go waiting for connections from servers. Note that you should not define the connection address to <code>UaClient</code> in this case.</p>
</div>
<div class="paragraph">
<p>You should also define a listener to validate incoming connections from the server using <code>UaClient.setReverseConnectionListener()</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyReverseConnectionListener</span> <span class="directive">implements</span> ReverseConnectionListener {

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">boolean</span> onConnect(<span class="predefined-type">String</span> serverApplicationUri, <span class="predefined-type">String</span> endpointUrl, <span class="predefined-type">SocketAddress</span> remoteAddress) {
    <span class="comment">/*
     * You can perform here validation for reverse connections. Return false, if you wish to stop
     * the connection. Note that the connection is already initiated by the server at the
     * SocketAddress.
     *
     * NOTE! The endpointUrl parameter is sent by the Server and used in the Client in calls forming
     * the higher level communication channel. It is not the actual address the client is connecting
     * (as the socket is already open to the remoteAddress) and most of the time is one of the
     * endpointUrls used in normal non-reverse connections for the Server.
     */</span>
    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Accepting reverse connection to server: </span><span class="delimiter">&quot;</span></span> + serverApplicationUri + <span class="string"><span class="delimiter">&quot;</span><span class="content"> at: </span><span class="delimiter">&quot;</span></span> + remoteAddress
        + <span class="string"><span class="delimiter">&quot;</span><span class="content"> , using endpointUrl: </span><span class="delimiter">&quot;</span></span> + endpointUrl);
    <span class="keyword">return</span> <span class="predefined-constant">true</span>;
  }

}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
At this point in the communication the channel is not encrypted. Therefore when possible you should validate that the server is within the list of known servers by checking the remote <code>SocketAddress</code> of the server. The server ApplicationURI and EndpointUrl are given by the server when they connect. You can use all the security options as in usual connections to validate that the client is communicating with a trusted server.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2019-03-21 17:54:13 EET
</div>
</div>
</body>
</html>