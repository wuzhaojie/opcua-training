<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<meta name="author" content="Server Tutorial">
<title>Prosys OPC UA SDK for Java</title>
<style>
 article,
 aside,
 details,
 figcaption,
 figure,
 footer,
 header,
 hgroup,
 main,
 nav,
 section,
 summary {
     display: block
 }

 audio,
 canvas,
 video {
     display: inline-block
 }

 audio:not([controls]) {
     display: none;
     height: 0
 }

 [hidden],
 template {
     display: none
 }

 script {
     display: none!important
 }

 html {
     font-family: sans-serif;
     -ms-text-size-adjust: 100%;
     -webkit-text-size-adjust: 100%
 }

 a {
     background: transparent
 }

 a:focus {
     outline: thin dotted
 }

 a:active,
 a:hover {
     outline: 0
 }

 h1 {
     font-size: 2em;
     margin: .67em 0
 }

 abbr[title] {
     border-bottom: 1px dotted
 }

 b,
 strong {
     font-weight: bold
 }

 dfn {
     font-style: italic
 }

 hr {
     -moz-box-sizing: content-box;
     box-sizing: content-box;
     height: 0
 }

 mark {
     background: #ff0;
     color: #000
 }

 code,
 kbd,
 pre,
 samp {
     font-family: monospace;
     font-size: 1em
 }

 pre {
     white-space: pre-wrap
 }

 q {
     quotes: "\201C" "\201D" "\2018" "\2019"
 }

 small {
     font-size: 80%
 }

 sub,
 sup {
     font-size: 75%;
     line-height: 0;
     position: relative;
     vertical-align: baseline
 }

 sup {
     top: -.5em
 }

 sub {
     bottom: -.25em
 }

 img {
     border: 0
 }

 svg:not(:root) {
     overflow: hidden
 }

 figure {
     margin: 0
 }

 fieldset {
     border: 1px solid silver;
     margin: 0 2px;
     padding: .35em .625em .75em
 }

 legend {
     border: 0;
     padding: 0
 }

 button,
 input,
 select,
 textarea {
     font-family: inherit;
     font-size: 100%;
     margin: 0
 }

 button,
 input {
     line-height: normal
 }

 button,
 select {
     text-transform: none
 }

 button,
 html input[type="button"],
 input[type="reset"],
 input[type="submit"] {
     -webkit-appearance: button;
     cursor: pointer
 }

 button[disabled],
 html input[disabled] {
     cursor: default
 }

 input[type="checkbox"],
 input[type="radio"] {
     box-sizing: border-box;
     padding: 0
 }

 input[type="search"] {
     -webkit-appearance: textfield;
     -moz-box-sizing: content-box;
     -webkit-box-sizing: content-box;
     box-sizing: content-box
 }

 input[type="search"]::-webkit-search-cancel-button,
 input[type="search"]::-webkit-search-decoration {
     -webkit-appearance: none
 }

 button::-moz-focus-inner,
 input::-moz-focus-inner {
     border: 0;
     padding: 0
 }

 textarea {
     overflow: auto;
     vertical-align: top
 }

 table {
     border-collapse: collapse;
     border-spacing: 0
 }

 *,
 *:before,
 *:after {
     -moz-box-sizing: border-box;
     -webkit-box-sizing: border-box;
     box-sizing: border-box
 }

 html,
 body {
     font-size: 100%
 }

 body {
     background: #fff;
     color: rgba(0, 0, 0, .8);
     padding: 0;
     margin: 0;
     font-family: "Open Sans", "DejaVu Sans", sans-serif;
     font-weight: normal;
     font-style: normal;
     /*            line-height: 1;*/
     position: relative;
     cursor: auto;
     tab-size: 4;
     -moz-osx-font-smoothing: grayscale;
     -webkit-font-smoothing: antialiased
 }

 a:hover {
     cursor: pointer
 }

 img,
 object,
 embed {
     max-width: 100%;
     height: auto
 }

 object,
 embed {
     height: 100%
 }

 img {
     -ms-interpolation-mode: bicubic
 }

 .left {
     float: left!important
 }

 .right {
     float: right!important
 }

 .text-left {
     text-align: left!important
 }

 .text-right {
     text-align: right!important
 }

 .text-center {
     text-align: center!important
 }

 .text-justify {
     text-align: justify!important
 }

 .hide {
     display: none
 }

 img,
 object,
 svg {
     display: inline-block;
     vertical-align: middle;
     margin-top: 1em;
 }

 textarea {
     height: auto;
     min-height: 50px
 }

 select {
     width: 100%
 }

 .center {
     margin-left: auto;
     margin-right: auto
 }

 .spread {
     width: 100%
 }

 /*
        p.lead,
        .paragraph.lead>p,
        #preamble>.sectionbody>.paragraph:first-of-type p {
            font-size: 1.21875em;
            line-height: 1.6
        }
*/

 .subheader,
 .admonitionblock td.content > .title,
 .audioblock > .title,
 .exampleblock > .title,
 .imageblock > .title,
 .listingblock > .title,
 .literalblock > .title,
 .stemblock > .title,
 .openblock > .title,
 .paragraph > .title,
 .quoteblock > .title,
 table.tableblock > .title,
 .verseblock > .title,
 .videoblock > .title,
 .dlist > .title,
 .olist > .title,
 .ulist > .title,
 .qlist > .title,
 .hdlist > .title {
     line-height: 1.45;
     color: #004c97;
     /*            font-weight: 400;*/
     margin-top: .3em;
     margin-bottom: .25em
 }

 div,
 dl,
 dt,
 dd,
 ul,
 ol,
 li,
 h1,
 h2,
 h3,
 #toctitle,
 .sidebarblock > .content > .title,
 h4,
 h5,
 h6,
 pre,
 form,
 p,
 blockquote,
 th,
 td {
     margin: 0;
     padding: 0;
     direction: ltr
 }

 a {
     color: #2156a5;
     text-decoration: underline;
     line-height: inherit
 }

 a:hover,
 a:focus {
     color: #1d4b8f
 }

 a img {
     border: none
 }

 p {
     font-family: inherit;
     font-weight: normal;
     font-size: 1em;
     /*            changed*/
     line-height: 1.5em;
     margin-bottom: 1.25em;
     text-rendering: optimizeLegibility
 }

 p aside {
     font-size: .875em;
     line-height: 1.35;
     font-style: italic
 }

 h1,
 h2,
 h3,
 #toctitle,
 .sidebarblock > .content > .title,
 h4,
 h5,
 h6 {
     font-family: "Open Sans", "DejaVu Sans", sans-serif;
     font-weight: normal;
     font-style: normal;
     color: #004c97;
     text-rendering: optimizeLegibility;
     margin-top: 1em;
     margin-bottom: .5em;
     line-height: 1.0125em
 }

 h1 small,
 h2 small,
 h3 small,
 #toctitle small,
 .sidebarblock > .content > .title small,
 h4 small,
 h5 small,
 h6 small {
     font-size: 60%;
     color: #e99b8f;
     line-height: 0
 }

 h1 {
     font-size: 2.125em
 }

 h2 {
     font-size: 1.6875em
     color: black;
 }

 h3,
 #toctitle,
 .sidebarblock > .content > .title {
     font-size: 1.375em
 }

 h4,
 h5 {
     font-size: 1.125em
 }

 h6 {
     font-size: 1em
 }

 hr {
     border: solid #ddddd8;
     border-width: 1px 0 0;
     clear: both;
     margin: 1.25em 0 1.1875em;
     height: 0
 }

 em,
 i {
     font-style: italic;
     line-height: inherit
 }

 strong,
 b {
     font-weight: bold;
     line-height: inherit
 }

 small {
     font-size: 60%;
     line-height: inherit
 }

 code {
     font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace;
     font-weight: 400;
     color: rgba(0, 0, 0, .9)
 }

 ul,
 ol,
 dl {
     font-size: 1em;
     /*            changed*/
     line-height: 1.5em;
     margin-bottom: 1.25em;
     list-style-position: outside;
     font-family: inherit
 }

 ul,
 ol {
     margin-left: 1.5em
 }

 ul li ul,
 ul li ol {
     margin-left: 1.25em;
     margin-bottom: 0;
     font-size: 1em
 }

 ul.square li ul,
 ul.circle li ul,
 ul.disc li ul {
     list-style: inherit
 }

 ul.square {
     list-style-type: square
 }

 ul.circle {
     list-style-type: circle
 }

 ul.disc {
     list-style-type: disc
 }

 ol li ul,
 ol li ol {
     margin-left: 1.25em;
     margin-bottom: 0
 }

 dl dt {
     margin-bottom: .3125em;
     font-weight: bold
 }

 dl dd {
     margin-bottom: 1.25em
 }

 abbr,
 acronym {
     text-transform: uppercase;
     font-size: 90%;
     color: rgba(0, 0, 0, .8);
     border-bottom: 1px dotted #ddd;
     cursor: help
 }

 abbr {
     text-transform: none
 }

 blockquote {
     margin: 0 0 1.25em;
     padding: .5625em 1.25em 0 1.1875em;
     border-left: 1px solid #ddd
 }

 blockquote cite {
     display: block;
     font-size: .9375em;
     color: rgba(0, 0, 0, .6)
 }

 blockquote cite:before {
     content: "\2014 \0020"
 }

 blockquote cite a,
 blockquote cite a:visited {
     color: rgba(0, 0, 0, .6)
 }

 blockquote,
 blockquote p {
     /*            changed*/
     line-height: 1.5em;
     color: rgba(0, 0, 0, .85)
 }

 @media only screen and (min-width:768px) {
     h1,
     h2,
     h3,
     #toctitle,
     .sidebarblock > .content > .title,
     h4,
     h5,
     h6 {
         line-height: 1.2
     }
     h1 {
         font-size: 2.75em
     }
     h2 {
         font-size: 2.3125em
     }
     h3,
     #toctitle,
     .sidebarblock > .content > .title {
         font-size: 1.6875em
     }
     h4 {
         font-size: 1.4375em
     }
 }

 table {
     background: #fff;
     margin-bottom: 1.25em;
     border: solid 1px #dedede
 }

 table thead,
 table tfoot {
     background: #f7f8f7;
     font-weight: bold
 }

 table thead tr th,
 table thead tr td,
 table tfoot tr th,
 table tfoot tr td {
     padding: .5em .625em .625em;
     font-size: inherit;
     color: rgba(0, 0, 0, .8);
     text-align: left
 }

 table tr th,
 table tr td {
     padding: .5625em .625em;
     font-size: inherit;
     color: rgba(0, 0, 0, .8)
 }

 table tr.even,
 table tr.alt,
 table tr:nth-of-type(even) {
     background: #f8f8f7
 }

 table thead tr th,
 table tfoot tr th,
 table tbody tr td,
 table tr td,
 table tfoot tr td {
     display: table-cell;
     line-height: 1.6
 }

 h1,
 h2,
 h3,
 #toctitle,
 .sidebarblock > .content > .title,
 h4,
 h5,
 h6 {
     line-height: 1.2;
     /*            word-spacing: -.05em*/
 }

 h1 strong,
 h2 strong,
 h3 strong,
 #toctitle strong,
 .sidebarblock > .content > .title strong,
 h4 strong,
 h5 strong,
 h6 strong {
     font-weight: 400
 }

 .clearfix:before,
 .clearfix:after,
 .float-group:before,
 .float-group:after {
     content: " ";
     display: table
 }

 .clearfix:after,
 .float-group:after {
     clear: both
 }

 *:not(pre) > code {
     font-size: .9375em;
     font-style: normal!important;
     letter-spacing: 0;
     padding: .1em .5ex;
     /*            word-spacing: -.15em;*/
     background-color: #f7f7f8;
     -webkit-border-radius: 4px;
     border-radius: 4px;
     line-height: 1.45;
     text-rendering: optimizeSpeed;
     word-wrap: break-word
 }

 *:not(pre) > code.nobreak {
     word-wrap: normal
 }

 *:not(pre) > code.nowrap {
     white-space: nowrap
 }

 pre,
 pre > code {
     line-height: 1.45;
     color: rgba(0, 0, 0, .9);
     font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace;
     font-weight: 400;
     text-rendering: optimizeSpeed
 }

 em em {
     font-style: normal
 }

 strong strong {
     font-weight: 400
 }

 .keyseq {
     color: rgba(51, 51, 51, .8)
 }

 kbd {
     font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace;
     display: inline-block;
     color: rgba(0, 0, 0, .8);
     font-size: .65em;
     line-height: 1.45;
     background-color: #f7f7f7;
     border: 1px solid #ccc;
     -webkit-border-radius: 3px;
     border-radius: 3px;
     -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em white inset;
     box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em #fff inset;
     margin: 0 .15em;
     padding: .2em .5em;
     vertical-align: middle;
     position: relative;
     top: -.1em;
     white-space: nowrap
 }

 .keyseq kbd:first-child {
     margin-left: 0
 }

 .keyseq kbd:last-child {
     margin-right: 0
 }

 .menuseq,
 .menuref {
     color: #000
 }

 .menuseq b:not(.caret),
 .menuref {
     font-weight: inherit
 }

 .menuseq {
     word-spacing: -.02em
 }

 .menuseq b.caret {
     font-size: 1.25em;
     line-height: .8
 }

 .menuseq i.caret {
     font-weight: bold;
     text-align: center;
     width: .45em
 }

 b.button:before,
 b.button:after {
     position: relative;
     top: -1px;
     font-weight: 400
 }

 b.button:before {
     content: "[";
     padding: 0 3px 0 2px
 }

 b.button:after {
     content: "]";
     padding: 0 2px 0 3px
 }

 p a > code:hover {
     color: rgba(0, 0, 0, .9)
 }

 #header,
 #content,
 #footnotes,
 #footer {
     width: 100%;
     margin-left: auto;
     margin-right: auto;
     margin-top: 0;
     margin-bottom: 0;
     max-width: 62.5em;
     *zoom: 1;
     position: relative;
     padding-left: .9375em;
     padding-right: .9375em
 }

 #header:before,
 #header:after,
 #content:before,
 #content:after,
 #footnotes:before,
 #footnotes:after,
 #footer:before,
 #footer:after {
     content: " ";
     display: table
 }

 #header:after,
 #content:after,
 #footnotes:after,
 #footer:after {
     clear: both
 }

 #content {
     margin-top: 1.25em;
     font-family: "Open Sans", sans-serif;
 }

 #content:before {
     content: none
 }

 #header > h1:first-child {
     color: rgba(0, 0, 0, .85);
     margin-top: 2.25rem;
     margin-bottom: 0
 }

 #header > h1:first-child + #toc {
     margin-top: 8px;
     border-top: 1px solid #ddddd8
 }

 #header > h1:only-child,
 body.toc2 #header > h1:nth-last-child(2) {
     border-bottom: 1px solid #ddddd8;
     padding-bottom: 8px
 }

 #header .details {
     border-bottom: 1px solid #ddddd8;
     line-height: 1.45;
     padding-top: .35em;
     padding-bottom: .25em;
     padding-left: .25em;
     color: rgba(0, 0, 0, 1);
     display: -ms-flexbox;
     display: -webkit-flex;
     display: flex;
     -ms-flex-flow: row wrap;
     -webkit-flex-flow: row wrap;
     flex-flow: row wrap
 }

 #header .details span:first-child {
     margin-left: -.125em
 }

 #header .details span.email a {
     color: rgba(0, 0, 0, .85)
 }

 #header .details br {
     display: none
 }

 #header .details br + span:before {
     content: "\00a0\2013\00a0"
 }

 #header .details br + span.author:before {
     content: "\00a0\22c5\00a0";
     color: rgba(0, 0, 0, .85)
 }

 #header .details br + span#revremark:before {
     content: "\00a0|\00a0"
 }

 #header #revnumber {
     text-transform: capitalize
 }

 #header #revnumber:after {
     content: "\00a0"
 }

 #content > h1:first-child:not([class]) {
     color: rgba(0, 0, 0, .85);
     border-bottom: 1px solid #ddddd8;
     padding-bottom: 8px;
     margin-top: 0;
     padding-top: 1rem;
     margin-bottom: 1.25rem
 }

 #toc {
     border-bottom: 1px solid #efefed;
     padding-bottom: .5em
 }

 #toc > ul {
     margin-left: .125em
 }

 #toc ul.sectlevel0 > li > a {
     font-style: italic
 }

 #toc ul.sectlevel0 ul.sectlevel1 {
     margin: .5em 0
 }

 #toc ul {
     font-family: "Open Sans", "DejaVu Sans", sans-serif;
     list-style-type: none
 }

 #toc li {
     line-height: 1.3334;
     margin-top: .3334em
 }

 #toc a {
     text-decoration: none
 }

 #toc a:active {
     text-decoration: underline
 }

 #toctitle {
     color: #111;
     font-size: 1.2em
 }

 @media only screen and (min-width:768px) {
     #toctitle {
         font-size: 1.375em
     }
     body.toc2 {
         padding-left: 15em;
         padding-right: 0
     }
     #toc.toc2 {
         margin-top: 0!important;
         background-color: #f8f8f7;
         position: fixed;
         width: 15em;
         left: 0;
         top: 0;
         border-right: 1px solid #efefed;
         border-top-width: 0!important;
         border-bottom-width: 0!important;
         z-index: 1000;
         padding: 1.25em 1em;
         height: 100%;
         overflow: auto
     }
     #toc.toc2 #toctitle {
         margin-top: 0;
         margin-bottom: .8rem;
         font-size: 1.2em
     }
     #toc.toc2 > ul {
         font-size: .9em;
         margin-bottom: 0
     }
     #toc.toc2 ul ul {
         margin-left: 0;
         padding-left: 1em
     }
     #toc.toc2 ul.sectlevel0 ul.sectlevel1 {
         padding-left: 0;
         margin-top: .5em;
         margin-bottom: .5em
     }
     body.toc2.toc-right {
         padding-left: 0;
         padding-right: 15em
     }
     body.toc2.toc-right #toc.toc2 {
         border-right-width: 0;
         border-left: 1px solid #efefed;
         left: auto;
         right: 0
     }
 }

 @media only screen and (min-width:1280px) {
     body.toc2 {
         padding-left: 20em;
         padding-right: 0
     }
     #toc.toc2 {
         width: 20em
     }
     #toc.toc2 #toctitle {
         font-size: 1.375em
     }
     #toc.toc2 > ul {
         font-size: .95em
     }
     #toc.toc2 ul ul {
         padding-left: 1.25em
     }
     body.toc2.toc-right {
         padding-left: 0;
         padding-right: 20em
     }
 }

 #content #toc {
     border-style: solid;
     border-width: 1px;
     border-color: #e0e0dc;
     margin-bottom: 1.25em;
     padding: 1.25em;
     background: #f8f8f7;
     -webkit-border-radius: 4px;
     border-radius: 4px
 }

 #content #toc > :first-child {
     margin-top: 0
 }

 #content #toc > :last-child {
     margin-bottom: 0
 }

 #footer {
     max-width: 100%;
     background-color: rgba(0, 0, 0, .8);
     padding: 1.25em
 }

 #footer-text {
     color: rgba(255, 255, 255, .8);
     line-height: 1.44
 }

 .sect1 {
     padding-bottom: .625em
 }

 @media only screen and (min-width:768px) {
     .sect1 {
         padding-bottom: 1.25em
     }
 }

 .sect1 + .sect1 {
     border-top: 1px solid #efefed
 }

 #content h1 > a.anchor,
 h2 > a.anchor,
 h3 > a.anchor,
 #toctitle > a.anchor,
 .sidebarblock > .content > .title > a.anchor,
 h4 > a.anchor,
 h5 > a.anchor,
 h6 > a.anchor {
     position: absolute;
     z-index: 1001;
     width: 1.5ex;
     margin-left: -1.5ex;
     display: block;
     text-decoration: none!important;
     visibility: hidden;
     text-align: center;
     font-weight: 400
 }

 #content h1 > a.anchor:before,
 h2 > a.anchor:before,
 h3 > a.anchor:before,
 #toctitle > a.anchor:before,
 .sidebarblock > .content > .title > a.anchor:before,
 h4 > a.anchor:before,
 h5 > a.anchor:before,
 h6 > a.anchor:before {
     content: "\00A7";
     font-size: .85em;
     display: block;
     padding-top: .1em
 }

 #content h1:hover > a.anchor,
 #content h1 > a.anchor:hover,
 h2:hover > a.anchor,
 h2 > a.anchor:hover,
 h3:hover > a.anchor,
 #toctitle:hover > a.anchor,
 .sidebarblock > .content > .title:hover > a.anchor,
 h3 > a.anchor:hover,
 #toctitle > a.anchor:hover,
 .sidebarblock > .content > .title > a.anchor:hover,
 h4:hover > a.anchor,
 h4 > a.anchor:hover,
 h5:hover > a.anchor,
 h5 > a.anchor:hover,
 h6:hover > a.anchor,
 h6 > a.anchor:hover {
     visibility: visible
 }

 #content h1 > a.link,
 h2 > a.link,
 h3 > a.link,
 #toctitle > a.link,
 .sidebarblock > .content > .title > a.link,
 h4 > a.link,
 h5 > a.link,
 h6 > a.link {
     color: #;
     text-decoration: none
 }

 #content h1 > a.link:hover,
 h2 > a.link:hover,
 h3 > a.link:hover,
 #toctitle > a.link:hover,
 .sidebarblock > .content > .title > a.link:hover,
 h4 > a.link:hover,
 h5 > a.link:hover,
 h6 > a.link:hover {
     color: #a53221
 }

 .audioblock,
 .imageblock,
 .literalblock,
 .listingblock,
 .stemblock,
 .videoblock {
     margin-bottom: 1.25em
 }

 .admonitionblock td.content > .title,
 .audioblock > .title,
 .exampleblock > .title,
 .imageblock > .title,
 .listingblock > .title,
 .literalblock > .title,
 .stemblock > .title,
 .openblock > .title,
 .paragraph > .title,
 .quoteblock > .title,
 table.tableblock > .title,
 .verseblock > .title,
 .videoblock > .title,
 .dlist > .title,
 .olist > .title,
 .ulist > .title,
 .qlist > .title,
 .hdlist > .title {
     text-rendering: optimizeLegibility;
     text-align: left;
     font-family: "Open Sans", "DejaVu Sans", sans-serif;
     font-size: 1rem;
     font-style: italic
 }

 table.tableblock > caption.title {
     white-space: nowrap;
     overflow: visible;
     max-width: 0
 }

 .paragraph.lead > p,
 #preamble > .sectionbody > .paragraph:first-of-type p {
     color: rgba(0, 0, 0, .85)
 }

 table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p {
     font-size: inherit
 }

 .admonitionblock > table {
     border-collapse: separate;
     border: 0;
     background: none;
     width: 100%
 }

 .admonitionblock > table td.icon {
     text-align: center;
     width: 80px
 }

 .admonitionblock > table td.icon img {
     max-width: initial
 }

 .admonitionblock > table td.icon .title {
     font-weight: bold;
     font-family: "Open Sans", "DejaVu Sans", sans-serif;
     text-transform: uppercase
 }

 .admonitionblock > table td.content {
     padding-left: 1.125em;
     padding-right: 1.25em;
     border-left: 1px solid #ddddd8;
     color: rgba(0, 0, 0, .6)
 }

 .admonitionblock > table td.content > :last-child > :last-child {
     margin-bottom: 0
 }

 .exampleblock > .content {
     border-style: solid;
     border-width: 1px;
     border-color: #e6e6e6;
     margin-bottom: 1.25em;
     padding: 1.25em;
     background: #fff;
     -webkit-border-radius: 4px;
     border-radius: 4px
 }

 .exampleblock > .content > :first-child {
     margin-top: 0
 }

 .exampleblock > .content > :last-child {
     margin-bottom: 0
 }

 .sidebarblock {
     border-style: solid;
     border-width: 1px;
     border-color: #e0e0dc;
     margin-bottom: 1.25em;
     padding: 1.25em;
     background: #f8f8f7;
     -webkit-border-radius: 4px;
     border-radius: 4px
 }

 .sidebarblock > :first-child {
     margin-top: 0
 }

 .sidebarblock > :last-child {
     margin-bottom: 0
 }

 .sidebarblock > .content > .title {
     color: #7a2518;
     margin-top: 0;
     text-align: center
 }

 .exampleblock > .content > :last-child > :last-child,
 .exampleblock > .content .olist > ol > li:last-child > :last-child,
 .exampleblock > .content .ulist > ul > li:last-child > :last-child,
 .exampleblock > .content .qlist > ol > li:last-child > :last-child,
 .sidebarblock > .content > :last-child > :last-child,
 .sidebarblock > .content .olist > ol > li:last-child > :last-child,
 .sidebarblock > .content .ulist > ul > li:last-child > :last-child,
 .sidebarblock > .content .qlist > ol > li:last-child > :last-child {
     margin-bottom: 0
 }

 .literalblock pre,
 .listingblock pre:not(.highlight),
 .listingblock pre[class="highlight"],
 .listingblock pre[class^="highlight "],
 .listingblock pre.CodeRay,
 .listingblock pre.prettyprint {
     background: #f7f7f8
 }

 .sidebarblock .literalblock pre,
 .sidebarblock .listingblock pre:not(.highlight),
 .sidebarblock .listingblock pre[class="highlight"],
 .sidebarblock .listingblock pre[class^="highlight "],
 .sidebarblock .listingblock pre.CodeRay,
 .sidebarblock .listingblock pre.prettyprint {
     background: #f2f1f1
 }

 .literalblock pre,
 .literalblock pre[class],
 .listingblock pre,
 .listingblock pre[class] {
     -webkit-border-radius: 4px;
     border-radius: 4px;
     word-wrap: break-word;
     padding: 1em;
     font-size: .8125em
 }

 .literalblock pre.nowrap,
 .literalblock pre[class].nowrap,
 .listingblock pre.nowrap,
 .listingblock pre[class].nowrap {
     overflow-x: auto;
     white-space: pre;
     word-wrap: normal
 }

 @media only screen and (min-width:768px) {
     .literalblock pre,
     .literalblock pre[class],
     .listingblock pre,
     .listingblock pre[class] {
         font-size: .90625em
     }
 }

 @media only screen and (min-width:1280px) {
     .literalblock pre,
     .literalblock pre[class],
     .listingblock pre,
     .listingblock pre[class] {
         font-size: 1em
     }
 }

 .literalblock.output pre {
     color: #f7f7f8;
     background-color: rgba(0, 0, 0, .9)
 }

 .listingblock pre.highlightjs {
     padding: 0
 }

 .listingblock pre.highlightjs > code {
     padding: 1em;
     -webkit-border-radius: 4px;
     border-radius: 4px
 }

 .listingblock pre.prettyprint {
     border-width: 0
 }

 .listingblock > .content {
     position: relative
 }

 .listingblock code[data-lang]:before {
     display: none;
     content: attr(data-lang);
     position: absolute;
     font-size: .75em;
     top: .425rem;
     right: .5rem;
     line-height: 1;
     text-transform: uppercase;
     color: #999
 }

 .listingblock:hover code[data-lang]:before {
     display: block
 }

 .listingblock.terminal pre .command:before {
     content: attr(data-prompt);
     padding-right: .5em;
     color: #999
 }

 .listingblock.terminal pre .command:not([data-prompt]):before {
     content: "$"
 }

 table.pyhltable {
     border-collapse: separate;
     border: 0;
     margin-bottom: 0;
     background: none
 }

 table.pyhltable td {
     vertical-align: top;
     padding-top: 0;
     padding-bottom: 0;
     line-height: 1.45
 }

 table.pyhltable td.code {
     padding-left: .75em;
     padding-right: 0
 }

 pre.pygments .lineno,
 table.pyhltable td:not(.code) {
     color: #999;
     padding-left: 0;
     padding-right: .5em;
     border-right: 1px solid #ddddd8
 }

 pre.pygments .lineno {
     display: inline-block;
     margin-right: .25em
 }

 table.pyhltable .linenodiv {
     background: none!important;
     padding-right: 0!important
 }

 .quoteblock {
     margin: 0 1em 1.25em 1.5em;
     display: table
 }

 .quoteblock > .title {
     margin-left: -1.5em;
     margin-bottom: .75em
 }

 .quoteblock blockquote,
 .quoteblock blockquote p {
     color: rgba(0, 0, 0, .85);
     font-size: 1.15rem;
     line-height: 1.75;
     /*            word-spacing: .1em;*/
     letter-spacing: 0;
     font-style: italic;
     text-align: justify
 }

 .quoteblock blockquote {
     margin: 0;
     padding: 0;
     border: 0
 }

 .quoteblock blockquote:before {
     content: "\201c";
     float: left;
     font-size: 2.75em;
     font-weight: bold;
     line-height: .6em;
     margin-left: -.6em;
     color: #7a2518;
     text-shadow: 0 1px 2px rgba(0, 0, 0, .1)
 }

 .quoteblock blockquote > .paragraph:last-child p {
     margin-bottom: 0
 }

 .quoteblock .attribution {
     margin-top: .5em;
     margin-right: .5ex;
     text-align: right
 }

 .quoteblock .quoteblock {
     margin-left: 0;
     margin-right: 0;
     padding: .5em 0;
     border-left: 3px solid rgba(0, 0, 0, .6)
 }

 .quoteblock .quoteblock blockquote {
     padding: 0 0 0 .75em
 }

 .quoteblock .quoteblock blockquote:before {
     display: none
 }

 .verseblock {
     margin: 0 1em 1.25em 1em
 }

 .verseblock pre {
     font-family: "Open Sans", "DejaVu Sans", sans;
     font-size: 1.15rem;
     color: rgba(0, 0, 0, .85);
     /*            font-weight: 300;*/
     text-rendering: optimizeLegibility
 }

 .verseblock pre strong {
     font-weight: 400
 }

 .verseblock .attribution {
     margin-top: 1.25rem;
     margin-left: .5ex
 }

 .quoteblock .attribution,
 .verseblock .attribution {
     font-size: .9375em;
     line-height: 1.45;
     font-style: italic
 }

 .quoteblock .attribution br,
 .verseblock .attribution br {
     display: none
 }

 .quoteblock .attribution cite,
 .verseblock .attribution cite {
     display: block;
     letter-spacing: -.025em;
     color: rgba(0, 0, 0, .6)
 }

 .quoteblock.abstract {
     margin: 0 0 1.25em 0;
     display: block
 }

 .quoteblock.abstract blockquote,
 .quoteblock.abstract blockquote p {
     text-align: left;
     word-spacing: 0
 }

 .quoteblock.abstract blockquote:before,
 .quoteblock.abstract blockquote p:first-of-type:before {
     display: none
 }

 table.tableblock {
     max-width: 100%;
     border-collapse: separate
 }

 table.tableblock td > .paragraph:last-child p > p:last-child,
 table.tableblock th > p:last-child,
 table.tableblock td > p:last-child {
     margin-bottom: 0
 }

 table.tableblock,
 th.tableblock,
 td.tableblock {
     border: 0 solid #dedede
 }

 table.grid-all > thead > tr > .tableblock,
 table.grid-all > tbody > tr > .tableblock {
     border-width: 0 1px 1px 0
 }

 table.grid-all > tfoot > tr > .tableblock {
     border-width: 1px 1px 0 0
 }

 table.grid-cols > * > tr > .tableblock {
     border-width: 0 1px 0 0
 }

 table.grid-rows > thead > tr > .tableblock,
 table.grid-rows > tbody > tr > .tableblock {
     border-width: 0 0 1px 0
 }

 table.grid-rows > tfoot > tr > .tableblock {
     border-width: 1px 0 0 0
 }

 table.grid-all > * > tr > .tableblock:last-child,
 table.grid-cols > * > tr > .tableblock:last-child {
     border-right-width: 0
 }

 table.grid-all > tbody > tr:last-child > .tableblock,
 table.grid-all > thead:last-child > tr > .tableblock,
 table.grid-rows > tbody > tr:last-child > .tableblock,
 table.grid-rows > thead:last-child > tr > .tableblock {
     border-bottom-width: 0
 }

 table.frame-all {
     border-width: 1px
 }

 table.frame-sides {
     border-width: 0 1px
 }

 table.frame-topbot {
     border-width: 1px 0
 }

 th.halign-left,
 td.halign-left {
     text-align: left
 }

 th.halign-right,
 td.halign-right {
     text-align: right
 }

 th.halign-center,
 td.halign-center {
     text-align: center
 }

 th.valign-top,
 td.valign-top {
     vertical-align: top
 }

 th.valign-bottom,
 td.valign-bottom {
     vertical-align: bottom
 }

 th.valign-middle,
 td.valign-middle {
     vertical-align: middle
 }

 table thead th,
 table tfoot th {
     font-weight: bold
 }

 tbody tr th {
     display: table-cell;
     line-height: 1.6;
     background: #f7f8f7
 }

 tbody tr th,
 tbody tr th p,
 tfoot tr th,
 tfoot tr th p {
     color: rgba(0, 0, 0, .8);
     font-weight: bold
 }

 p.tableblock > code:only-child {
     background: none;
     padding: 0
 }

 p.tableblock {
     font-size: 1em
 }

 td > div.verse {
     white-space: pre
 }

 ol {
     margin-left: 1.75em
 }

 ul li ol {
     margin-left: 1.5em
 }

 dl dd {
     margin-left: 1.125em
 }

 dl dd:last-child,
 dl dd:last-child > :last-child {
     margin-bottom: 0
 }

 ol > li p,
 ul > li p,
 ul dd,
 ol dd,
 .olist .olist,
 .ulist .ulist,
 .ulist .olist,
 .olist .ulist {
     margin-bottom: .625em
 }

 ul.checklist,
 ul.none,
 ol.none,
 ul.no-bullet,
 ol.no-bullet,
 ol.unnumbered,
 ul.unstyled,
 ol.unstyled {
     list-style-type: none
 }

 ul.no-bullet,
 ol.no-bullet,
 ol.unnumbered {
     margin-left: .625em
 }

 ul.unstyled,
 ol.unstyled {
     margin-left: 0
 }

 ul.checklist {
     margin-left: .625em
 }

 ul.checklist li > p:first-child > .fa-square-o:first-child,
 ul.checklist li > p:first-child > .fa-check-square-o:first-child {
     width: 1.25em;
     font-size: .8em;
     position: relative;
     bottom: .125em
 }

 ul.checklist li > p:first-child > input[type="checkbox"]:first-child {
     margin-right: .25em
 }

 ul.inline {
     margin: 0 auto .625em auto;
     margin-left: -1.375em;
     margin-right: 0;
     padding: 0;
     list-style: none;
     overflow: hidden
 }

 ul.inline > li {
     list-style: none;
     float: left;
     margin-left: 1.375em;
     display: block
 }

 ul.inline > li > * {
     display: block
 }

 .unstyled dl dt {
     font-weight: normal;
     font-style: normal
 }

 ol.arabic {
     list-style-type: decimal
 }

 ol.decimal {
     list-style-type: decimal-leading-zero
 }

 ol.loweralpha {
     list-style-type: lower-alpha
 }

 ol.upperalpha {
     list-style-type: upper-alpha
 }

 ol.lowerroman {
     list-style-type: lower-roman
 }

 ol.upperroman {
     list-style-type: upper-roman
 }

 ol.lowergreek {
     list-style-type: lower-greek
 }

 .hdlist > table,
 .colist > table {
     border: 0;
     background: none
 }

 .hdlist > table > tbody > tr,
 .colist > table > tbody > tr {
     background: none
 }

 td.hdlist1,
 td.hdlist2 {
     vertical-align: top;
     padding: 0 .625em
 }

 td.hdlist1 {
     font-weight: bold;
     padding-bottom: 1.25em
 }

 .literalblock + .colist,
 .listingblock + .colist {
     margin-top: -.5em
 }

 .colist > table tr > td:first-of-type {
     padding: .4em .75em 0 .75em;
     line-height: 1;
     vertical-align: top
 }

 .colist > table tr > td:first-of-type img {
     max-width: initial
 }

 .colist > table tr > td:last-of-type {
     padding: .25em 0
 }

 .thumb,
 .th {
     line-height: 0;
     display: inline-block;
     border: solid 4px #fff;
     -webkit-box-shadow: 0 0 0 1px #ddd;
     box-shadow: 0 0 0 1px #ddd
 }

 .imageblock.left,
 .imageblock[style*="float: left"] {
     margin: .25em .625em 1.25em 0
 }

 .imageblock.right,
 .imageblock[style*="float: right"] {
     margin: .25em 0 1.25em .625em
 }

 .imageblock > .title {
     margin-bottom: 0
 }

 .imageblock.thumb,
 .imageblock.th {
     border-width: 6px
 }

 .imageblock.thumb > .title,
 .imageblock.th > .title {
     padding: 0 .125em
 }

 .image.left,
 .image.right {
     margin-top: .25em;
     margin-bottom: .25em;
     display: inline-block;
     line-height: 0
 }

 .image.left {
     margin-right: .625em
 }

 .image.right {
     margin-left: .625em
 }

 a.image {
     text-decoration: none;
     display: inline-block
 }

 a.image object {
     pointer-events: none
 }

 sup.footnote,
 sup.footnoteref {
     font-size: .875em;
     position: static;
     vertical-align: super
 }

 sup.footnote a,
 sup.footnoteref a {
     text-decoration: none
 }

 sup.footnote a:active,
 sup.footnoteref a:active {
     text-decoration: underline
 }

 #footnotes {
     padding-top: .75em;
     padding-bottom: .75em;
     margin-bottom: .625em
 }

 #footnotes hr {
     width: 20%;
     min-width: 6.25em;
     margin: -.25em 0 .75em 0;
     border-width: 1px 0 0 0
 }

 #footnotes .footnote {
     padding: 0 .375em 0 .225em;
     line-height: 1.3334;
     font-size: .875em;
     margin-left: 1.2em;
     text-indent: -1.05em;
     margin-bottom: .2em
 }

 #footnotes .footnote a:first-of-type {
     font-weight: bold;
     text-decoration: none
 }

 #footnotes .footnote:last-of-type {
     margin-bottom: 0
 }

 #content #footnotes {
     margin-top: -.625em;
     margin-bottom: 0;
     padding: .75em 0
 }

 .gist .file-data > table {
     border: 0;
     background: #fff;
     width: 100%;
     margin-bottom: 0
 }

 .gist .file-data > table td.line-data {
     width: 99%
 }

 div.unbreakable {
     page-break-inside: avoid
 }

 .big {
     font-size: larger
 }

 .small {
     font-size: smaller
 }

 .underline {
     text-decoration: underline
 }

 .overline {
     text-decoration: overline
 }

 .line-through {
     text-decoration: line-through
 }

 .aqua {
     color: #00bfbf
 }

 .aqua-background {
     background-color: #00fafa
 }

 .black {
     color: #000
 }

 .black-background {
     background-color: #000
 }

 .blue {
     color: #0000bf
 }

 .blue-background {
     background-color: #0000fa
 }

 .fuchsia {
     color: #bf00bf
 }

 .fuchsia-background {
     background-color: #fa00fa
 }

 .gray {
     color: #606060
 }

 .gray-background {
     background-color: #7d7d7d
 }

 .green {
     color: #006000
 }

 .green-background {
     background-color: #007d00
 }

 .lime {
     color: #00bf00
 }

 .lime-background {
     background-color: #00fa00
 }

 .maroon {
     color: #600000
 }

 .maroon-background {
     background-color: #7d0000
 }

 .navy {
     color: #000060
 }

 .navy-background {
     background-color: #00007d
 }

 .olive {
     color: #606000
 }

 .olive-background {
     background-color: #7d7d00
 }

 .purple {
     color: #600060
 }

 .purple-background {
     background-color: #7d007d
 }

 .red {
     color: #bf0000
 }

 .red-background {
     background-color: #fa0000
 }

 .silver {
     color: #909090
 }

 .silver-background {
     background-color: #bcbcbc
 }

 .teal {
     color: #006060
 }

 .teal-background {
     background-color: #007d7d
 }

 .white {
     color: #bfbfbf
 }

 .white-background {
     background-color: #fafafa
 }

 .yellow {
     color: #bfbf00
 }

 .yellow-background {
     background-color: #fafa00
 }

 span.icon > .fa {
     cursor: default
 }

 a span.icon > .fa {
     cursor: inherit
 }

 .admonitionblock td.icon [class^="fa icon-"] {
     font-size: 2.5em;
     text-shadow: 1px 1px 2px rgba(0, 0, 0, .5);
     cursor: default
 }

 .admonitionblock td.icon .icon-note:before {
     content: "\f05a";
     color: #19407c
 }

 .admonitionblock td.icon .icon-tip:before {
     content: "\f0eb";
     text-shadow: 1px 1px 2px rgba(155, 155, 0, .8);
     color: #111
 }

 .admonitionblock td.icon .icon-warning:before {
     content: "\f071";
     color: #bf6900
 }

 .admonitionblock td.icon .icon-caution:before {
     content: "\f06d";
     color: #bf3400
 }

 .admonitionblock td.icon .icon-important:before {
     content: "\f06a";
     color: #bf0000
 }

 .conum[data-value] {
     display: inline-block;
     color: #fff!important;
     background-color: rgba(0, 0, 0, .8);
     -webkit-border-radius: 100px;
     border-radius: 100px;
     text-align: center;
     font-size: .75em;
     width: 1.67em;
     height: 1.67em;
     line-height: 1.67em;
     font-family: "Open Sans", "DejaVu Sans", sans-serif;
     font-style: normal;
     font-weight: bold
 }

 .conum[data-value] * {
     color: #fff!important
 }

 .conum[data-value] + b {
     display: none
 }

 .conum[data-value]:after {
     content: attr(data-value)
 }

 pre .conum[data-value] {
     position: relative;
     top: -.125em
 }

 b.conum * {
     color: inherit!important
 }

 .conum:not([data-value]):empty {
     display: none
 }

 dt,
 th.tableblock,
 td.content,
 div.footnote {
     text-rendering: optimizeLegibility
 }

 h1,
 h2,
 p,
 td.content,
 span.alt {
     /*            letter-spacing: -.01em*/
 }

 p strong,
 td.content strong,
 div.footnote strong {
     letter-spacing: -.005em
 }

 p,
 blockquote,
 dt,
 td.content,
 span.alt {
     font-size: 1.0625rem
 }

 p {
     margin-bottom: .5rem
 }

 .sidebarblock p,
 .sidebarblock dt,
 .sidebarblock td.content,
 p.tableblock {
     font-size: 1em
 }

 .exampleblock > .content {
     background-color: #fffef7;
     border-color: #e0e0dc;
     -webkit-box-shadow: 0 1px 4px #e0e0dc;
     box-shadow: 0 1px 4px #e0e0dc
 }

 .print-only {
     display: none!important
 }

 @media print {
     @page {
         margin: 1.75cm 1.5cm
     }
     * {
         -webkit-box-shadow: none!important;
         box-shadow: none!important;
         text-shadow: none!important
     }
     a {
         color: inherit!important;
         text-decoration: underline!important
     }
     a.bare,
     a[href^="#"],
     a[href^="mailto:"] {
         text-decoration: none!important
     }
     a[href^="http:"]:not(.bare):after,
     a[href^="https:"]:not(.bare):after {
         content: "(" attr(href) ")";
         display: inline-block;
         font-size: .875em;
         padding-left: .25em
     }
     abbr[title]:after {
         content: " (" attr(title) ")"
     }
     pre,
     blockquote,
     tr,
     img,
     object,
     svg {
         page-break-inside: avoid
     }
     thead {
         display: table-header-group
     }
     svg {
         max-width: 100%
     }
     p,
     blockquote,
     dt,
     td.content {
         font-size: 1em;
         orphans: 3;
         widows: 3
     }
     h2,
     h3,
     #toctitle,
     .sidebarblock > .content > .title {
         page-break-after: avoid
     }
     #toc,
     .sidebarblock,
     .exampleblock > .content {
         background: none!important
     }
     #toc {
         border-bottom: 1px solid #ddddd8!important;
         padding-bottom: 0!important
     }
     .sect1 {
         padding-bottom: 0!important
     }
     .sect1 + .sect1 {
         border: 0!important
     }
     #header > h1:first-child {
         margin-top: 1.25rem
     }
     body.book #header {
         text-align: center
     }
     body.book #header > h1:first-child {
         border: 0!important;
         margin: 2.5em 0 1em 0
     }
     body.book #header .details {
         border: 0!important;
         display: block;
         padding: 0!important
     }
     body.book #header .details span:first-child {
         margin-left: 0!important
     }
     body.book #header .details br {
         display: block
     }
     body.book #header .details br + span:before {
         content: none!important
     }
     body.book #toc {
         border: 0!important;
         text-align: left!important;
         padding: 0!important;
         margin: 0!important
     }
     body.book #toc,
     body.book #preamble,
     body.book h1.sect0,
     body.book .sect1 > h2 {
         page-break-before: always
     }
     .listingblock code[data-lang]:before {
         display: block
     }
     #footer {
         background: none!important;
         padding: 0 .9375em
     }
     #footer-text {
         color: rgba(0, 0, 0, .6)!important;
         font-size: .9em
     }
     .hide-on-print {
         display: none!important
     }
     .print-only {
         display: block!important
     }
     .hide-for-print {
         display: none!important
     }
     .show-for-print {
         display: inherit!important
     }
 }

 </style > <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" > <style >
 /* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */

 /*pre.CodeRay {background-color:#f7f7f8;}*/

 .CodeRay .line-numbers {
     border-right: 1px solid #d8d8d8;
     padding: 0 0.5em 0 .25em
 }

 .CodeRay span.line-numbers {
     display: inline-block;
     margin-right: .5em;
     color: rgba(0, 0, 0, .3)
 }

 .CodeRay .line-numbers strong {
     color: rgba(0, 0, 0, .4)
 }

 table.CodeRay {
     border-collapse: separate;
     border-spacing: 0;
     margin-bottom: 0;
     border: 0;
     background: none
 }

 table.CodeRay td {
     vertical-align: top;
     line-height: 1.45
 }

 table.CodeRay td.line-numbers {
     text-align: right
 }

 table.CodeRay td.line-numbers > pre {
     padding: 0;
     color: rgba(0, 0, 0, .3)
 }

 table.CodeRay td.code {
     padding: 0 0 0 .5em
 }

 table.CodeRay td.code > pre {
     padding: 0
 }

 .CodeRay .debug {
     color: #fff !important;
     background: #000080 !important
 }

 .CodeRay .annotation {
     color: #007
 }

 .CodeRay .attribute-name {
     color: #000080
 }

 .CodeRay .attribute-value {
     color: #700
 }

 .CodeRay .binary {
     color: #509
 }

 .CodeRay .comment {
     color: #998;
     font-style: italic
 }

 .CodeRay .char {
     color: #04d
 }

 .CodeRay .char .content {
     color: #04d
 }

 .CodeRay .char .delimiter {
     color: #039
 }

 .CodeRay .class {
     color: #458;
     font-weight: bold
 }

 .CodeRay .complex {
     color: #a08
 }

 .CodeRay .constant,
 .CodeRay .predefined-constant {
     color: #008080
 }

 .CodeRay .color {
     color: #099
 }

 .CodeRay .class-variable {
     color: #369
 }

 .CodeRay .decorator {
     color: #b0b
 }

 .CodeRay .definition {
     color: #099
 }

 .CodeRay .delimiter {
     color: #000
 }

 .CodeRay .doc {
     color: #970
 }

 .CodeRay .doctype {
     color: #34b
 }

 .CodeRay .doc-string {
     color: #d42
 }

 .CodeRay .escape {
     color: #666
 }

 .CodeRay .entity {
     color: #800
 }

 .CodeRay .error {
     color: #808
 }

 .CodeRay .exception {
     color: inherit
 }

 .CodeRay .filename {
     color: #099
 }

 .CodeRay .function {
     color: #900;
     font-weight: bold
 }

 .CodeRay .global-variable {
     color: #008080
 }

 .CodeRay .hex {
     color: #058
 }

 .CodeRay .integer,
 .CodeRay .float {
     color: #099
 }

 .CodeRay .include {
     color: #555
 }

 .CodeRay .inline {
     color: #000
 }

 .CodeRay .inline .inline {
     background: #ccc
 }

 .CodeRay .inline .inline .inline {
     background: #bbb
 }

 .CodeRay .inline .inline-delimiter {
     color: #d14
 }

 .CodeRay .inline-delimiter {
     color: #d14
 }

 .CodeRay .important {
     color: #555;
     font-weight: bold
 }

 .CodeRay .interpreted {
     color: #b2b
 }

 .CodeRay .instance-variable {
     color: #008080
 }

 .CodeRay .label {
     color: #970
 }

 .CodeRay .local-variable {
     color: #963
 }

 .CodeRay .octal {
     color: #40e
 }

 .CodeRay .predefined {
     color: #369
 }

 .CodeRay .preprocessor {
     color: #579
 }

 .CodeRay .pseudo-class {
     color: #555
 }

 .CodeRay .directive {
     font-weight: bold
 }

 .CodeRay .type {
     font-weight: bold
 }

 .CodeRay .predefined-type {
     color: inherit
 }

 .CodeRay .reserved,
 .CodeRay .keyword {
     color: #000;
     font-weight: bold
 }

 .CodeRay .key {
     color: #808
 }

 .CodeRay .key .delimiter {
     color: #606
 }

 .CodeRay .key .char {
     color: #80f
 }

 .CodeRay .value {
     color: #088
 }

 .CodeRay .regexp .delimiter {
     color: #808
 }

 .CodeRay .regexp .content {
     color: #808
 }

 .CodeRay .regexp .modifier {
     color: #808
 }

 .CodeRay .regexp .char {
     color: #d14
 }

 .CodeRay .regexp .function {
     color: #404;
     font-weight: bold
 }

 .CodeRay .string {
     color: #d20
 }

 .CodeRay .string .string .string {
     background: #ffd0d0
 }

 .CodeRay .string .content {
     color: #d14
 }

 .CodeRay .string .char {
     color: #d14
 }

 .CodeRay .string .delimiter {
     color: #d14
 }

 .CodeRay .shell {
     color: #d14
 }

 .CodeRay .shell .delimiter {
     color: #d14
 }

 .CodeRay .symbol {
     color: #990073
 }

 .CodeRay .symbol .content {
     color: #a60
 }

 .CodeRay .symbol .delimiter {
     color: #630
 }

 .CodeRay .tag {
     color: #008080
 }

 .CodeRay .tag-special {
     color: #d70
 }

 .CodeRay .variable {
     color: #036
 }

 .CodeRay .insert {
     background: #afa
 }

 .CodeRay .delete {
     background: #faa
 }

 .CodeRay .change {
     color: #aaf;
     background: #007
 }

 .CodeRay .head {
     color: #f8f;
     background: #505
 }

 .CodeRay .insert .insert {
     color: #080
 }

 .CodeRay .delete .delete {
     color: #800
 }

 .CodeRay .change .change {
     color: #66f
 }

 .CodeRay .head .head {
     color: #f4f
 }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Prosys OPC UA SDK for Java</h1>
<div class="details">
<span id="author" class="author">Server Tutorial</span><br>
<span id="revdate">Version 4.0.0</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">1. Introduction</a></li>
<li><a href="#installation">2. Installation</a></li>
<li><a href="#sample-applications">3. Sample Applications</a></li>
<li><a href="#uaserver-object">4. UaServer Object</a>
<ul class="sectlevel2">
<li><a href="#application-identity">4.1. Application Identity</a>
<ul class="sectlevel3">
<li><a href="#application-description">4.1.1. Application Description</a></li>
<li><a href="#application-instance-certificate">4.1.2. Application Instance Certificate</a></li>
<li><a href="#issuer-certificate">4.1.3. Issuer Certificate</a></li>
<li><a href="#multiple-application-instance-certificates">4.1.4. Multiple Application Instance Certificates</a></li>
<li><a href="#https-certificate">4.1.5. HTTPS Certificate</a></li>
<li><a href="#assigning-the-application-identity">4.1.6. Assigning the Application Identity</a></li>
</ul>
</li>
<li><a href="#server-endpoints">4.2. Server Endpoints</a>
<ul class="sectlevel3">
<li><a href="#endpoint-urls">4.2.1. Endpoint URLs</a></li>
<li><a href="#bindaddresses">4.2.2. BindAddresses</a></li>
<li><a href="#security-modes">4.2.3. Security Modes</a></li>
<li><a href="#https-security-policies">4.2.4. HTTPS Security Policies</a></li>
<li><a href="#user-security-tokens">4.2.5. User Security Tokens</a></li>
<li><a href="#custom-endpoint-configuration">4.2.6. Custom Endpoint Configuration</a></li>
<li><a href="#endpoint-initialization">4.2.7. Endpoint Initialization</a></li>
</ul>
</li>
<li><a href="#validating-client-applications-via-certificates">4.3. Validating Client Applications via Certificates</a>
<ul class="sectlevel3">
<li><a href="#validating-https-certificates">4.3.1. Validating HTTPS Certificates</a></li>
</ul>
</li>
<li><a href="#registration-to-a-discovery-server">4.4. Registration to a Discovery Server</a>
<ul class="sectlevel3">
<li><a href="#internal-discovery-server">4.4.1. Internal Discovery Server</a></li>
<li><a href="#local-discovery-server">4.4.2. Local Discovery Server</a></li>
</ul>
</li>
<li><a href="#server-initialization">4.5. Server Initialization</a></li>
</ul>
</li>
<li><a href="#address-space">5. Address Space</a>
<ul class="sectlevel2">
<li><a href="#standard-node-managers">5.1. Standard Node Managers</a></li>
<li><a href="#your-own-node-managers">5.2. Your Own Node Managers</a>
<ul class="sectlevel3">
<li><a href="#nodemanageruanode">5.2.1. NodeManagerUaNode</a></li>
<li><a href="#adding-nodes">5.2.2. Adding Nodes</a></li>
<li><a href="#custom-node-manager">5.2.3. Custom Node Manager</a></li>
</ul>
</li>
<li><a href="#node-manager-listener">5.3. Node Manager Listener</a></li>
<li><a href="#node-types">5.4. Node Types</a>
<ul class="sectlevel3">
<li><a href="#generic-nodes">5.4.1. Generic Nodes</a></li>
<li><a href="#instances">5.4.2. Instances</a></li>
<li><a href="#opc-ua-standard-types">5.4.3. OPC UA Standard Types</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#i-o-manager">6. I/O Manager</a>
<ul class="sectlevel2">
<li><a href="#nodes-as-data-cache">6.1. Nodes as Data Cache</a></li>
<li><a href="#custom-i-o-manager">6.2. Custom I/O Manager</a></li>
<li><a href="#i-o-manager-listener">6.3. I/O Manager Listener</a></li>
</ul>
</li>
<li><a href="#events-alarms-and-conditions">7. Events, Alarms and Conditions</a>
<ul class="sectlevel2">
<li><a href="#event-manager">7.1. Event Manager</a>
<ul class="sectlevel3">
<li><a href="#custom-event-manager">7.1.1. Custom Event Manager</a></li>
<li><a href="#event-manager-listener">7.1.2. Event Manager Listener</a></li>
</ul>
</li>
<li><a href="#defining-events-and-conditions">7.2. Defining Events and Conditions</a>
<ul class="sectlevel3">
<li><a href="#normal-events">7.2.1. Normal Events</a></li>
<li><a href="#custom-event-types">7.2.2. Custom Event Types</a></li>
<li><a href="#conditions">7.2.3. Conditions</a></li>
</ul>
</li>
<li><a href="#triggering-events">7.3. Triggering Events</a>
<ul class="sectlevel3">
<li><a href="#triggering-normal-events">7.3.1. Triggering Normal Events</a></li>
<li><a href="#triggering-conditions">7.3.2. Triggering Conditions</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#methods">8. Methods</a>
<ul class="sectlevel2">
<li><a href="#handling-methods">8.1. Handling Methods</a></li>
</ul>
</li>
<li><a href="#history-manager">9. History Manager</a></li>
<li><a href="#start-up">10. Start Up</a></li>
<li><a href="#shutdown">11. Shutdown</a></li>
<li><a href="#mybignodemanager">12. MyBigNodeManager</a>
<ul class="sectlevel2">
<li><a href="#your-node-manager">12.1. Your Node Manager</a></li>
<li><a href="#browse-support">12.2. Browse Support</a></li>
<li><a href="#nodeid-expandednodeid">12.3. NodeId &amp; ExpandedNodeId</a></li>
<li><a href="#mybigiomanager">12.4. MyBigIoManager</a></li>
<li><a href="#subscriptions-and-monitoreddataitems">12.5. Subscriptions and MonitoredDataItems</a></li>
<li><a href="#monitoredeventitems">12.6. MonitoredEventItems</a></li>
</ul>
</li>
<li><a href="#information-modeling">13. Information Modeling</a>
<ul class="sectlevel2">
<li><a href="#loading-information-models">13.1. Loading Information Models</a></li>
<li><a href="#codegen">13.2. Code Generation</a>
<ul class="sectlevel3">
<li><a href="#prosys-opc-ua-sdk-for-java-code-generator">13.2.1. Prosys OPC UA SDK for Java Code Generator</a></li>
<li><a href="#registering-the-model">13.2.2. Registering the Model</a></li>
<li><a href="#loading-the-model">13.2.3. Loading the Model</a></li>
<li><a href="#using-instances-of-generated-types">13.2.4. Using Instances of Generated Types</a></li>
<li><a href="#implementing-methods-in-generated-types">13.2.5. Implementing Methods in Generated Types</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#reverse-connections">14. Reverse Connections</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hello and welcome to OPC UA!</p>
</div>
<div class="paragraph">
<p>This is the Prosys OPC UA SDK for Java tutorial for server application development. With this quick introduction you should be able to grab the basic ideas behind the Prosys OPC UA SDK for Java. You might like to take a look at the Client Tutorial as well, but it is not a requirement.</p>
</div>
<div class="paragraph">
<p>Note that this tutorial assumes that you are already familiar with the basic concepts of OPC UA communications, although you can get started without much prior knowledge.</p>
</div>
<div class="paragraph">
<p>For a full reference on OPC UA communications, we recommend the book <em>OPC Unified Architecture</em> by Mahnke, Leitner and Damm (Springer-Verlag, 2009, ISBN 978-3-540-68898-3).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installation"><a class="anchor" href="#installation"></a>2. Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>See the installation instructions in the 'README.txt' file (or the brief version on the download page). The README file also contains notes about the usage and deployment of external libraries used by the SDK.</p>
</div>
<div class="paragraph">
<p>There is also a basic starting guide with tips on Java development tools and on using the Prosys OPC UA SDK for Java with the Eclipse IDE located in the 'Prosys_OPC_UA_SDK_for_Java_Starting_Guide' PDF file next to this guide in the distribution package.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sample-applications"><a class="anchor" href="#sample-applications"></a>3. Sample Applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The SDK contains a sample server application in the <code>SampleConsoleServer</code> Java class. This tutorial will refer to the code in the sample application while explaining the different steps to take in order to accomplish the main tasks of an OPC UA server.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="uaserver-object"><a class="anchor" href="#uaserver-object"></a>4. UaServer Object</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>UaServer</code> class is the main class you will be working with. It defines a full OPC UA server implementation which you can use in your own applications. Alternatively, you can inherit your own version of the server in case you need to modify the default behaviour or you otherwise prefer to configure your server that way. We will describe how you can simply instantiate the <code>UaServer</code> and define your server functionality by customizing the service managers that perform specific functionality in the server.</p>
</div>
<div class="paragraph">
<p>We can simply start by creating the server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">server = <span class="keyword">new</span> UaServer();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You will find the code in the 'SampleConsoleServer.java' file. Start by locating the <code>main()</code>-method from it and examine the methods called from there.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="application-identity"><a class="anchor" href="#application-identity"></a>4.1. Application Identity</h3>
<div class="paragraph">
<p>All OPC UA applications must define some characteristics of themselves. This information is communicated to other applications via the OPC UA protocol when the applications are connected.</p>
</div>
<div class="paragraph">
<p>For secure communications, the applications must also define an <em>Application Instance Certificate</em>, which they use to authenticate themselves to other applications they are communicating with. Depending on the selected security level, servers may only accept connections from clients that they trust.</p>
</div>
<div class="sect3">
<h4 id="application-description"><a class="anchor" href="#application-description"></a>4.1.1. Application Description</h4>
<div class="paragraph">
<p>The characteristics of an OPC UA application is defined in the following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">static</span> <span class="predefined-type">String</span> APP_NAME = <span class="string"><span class="delimiter">'</span><span class="content">SampleConsoleServer</span><span class="delimiter">'</span></span>;
[...]
ApplicationDescription appDescription = <span class="keyword">new</span> ApplicationDescription();
<span class="comment">// 'localhost' (all lower case) in the ApplicationName and</span>
<span class="comment">// ApplicationURI is converted to the actual host name of the computer</span>
<span class="comment">// in which the application is run</span>
appDescription.setApplicationName(<span class="keyword">new</span> LocalizedText(APP_NAME +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">@localhost</span><span class="delimiter">&quot;</span></span>));
appDescription.setApplicationUri(<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:localhost:OPCUA:</span><span class="delimiter">&quot;</span></span> + APP_NAME);
appDescription.setProductUri(<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:prosysopc.com:OPCUA:</span><span class="delimiter">&quot;</span></span> + APP_NAME);
appDescription.setApplicationType(ApplicationType.Server);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>ApplicationName</strong> is used in user interfaces as a name identifier for each application instance.</p>
</div>
<div class="paragraph">
<p><strong>ApplicationUri</strong> is a unique identifier for each running instance.</p>
</div>
<div class="paragraph">
<p><strong>ProductUri</strong>, on the other hand, is used to identify your product and should therefore be the same for all instances. It should refer to your own domain, for example, to ensure that it is globally unique.</p>
</div>
<div class="paragraph">
<p>Since the identifiers should be unique for each instance (i.e. installation), it is a good habit to include the hostname of the computer in which the application is running in both the ApplicationName and the ApplicationUri. The SDK supports this by automatically converting <code>localhost</code> to the actual hostname of the computer (e.g. 'myhost'). Alternatively, you can use <code>hostname</code>, which will be replaced with the full hostname, including the possible domain name part (e.g. 'myhost.mydomain.com').</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The URIs must be valid identifiers, i.e. they must begin with a scheme, such as ‘urn:’ and may not contain any space characters. There are some applications in the market, which use invalid URIs and may therefore cause some errors or warnings with your application.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="application-instance-certificate"><a class="anchor" href="#application-instance-certificate"></a>4.1.2. Application Instance Certificate</h4>
<div class="paragraph">
<p>You can define the Application Instance Certificate for the client by setting an <code>ApplicationIdentity</code> for the <code>UaServer</code> object. The simplest way to do this is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="directive">final</span> ApplicationIdentity identity = ApplicationIdentity.loadOrCreateCertificate(
                    appDescription,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Sample Organisation</span><span class="delimiter">&quot;</span></span>,
        <span class="comment">/* Private Key Password, optional */</span><span class="string"><span class="delimiter">&quot;</span><span class="content">opcua</span><span class="delimiter">&quot;</span></span>,
        <span class="comment">/* Key File Path */</span>privatePath,
        <span class="comment">/* CA certificate &amp; private key, optional */</span><span class="predefined-constant">null</span>,
        <span class="comment">/* Key Sizes for instance certificates to create, optional */</span>keySizes,
        <span class="comment">/* Enable renewing the certificate */</span><span class="predefined-constant">true</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this sample we are creating a self-signed certificate using the service of <code>ApplicationIdentity.loadOrCreateCertificate()</code>. On the first run, it creates the certificate and the private key and stores them in the files <code>SampleConsoleServer@hostname_keysize.der</code> and <code>SampleConsoleServer@hostname_keysize.pem</code> respectively (<code>hostname</code> is replaced with the actual hostname of the machine where the application is running and <code>keysize</code> is replaced with the size of the public and private key). The private key is used by the client to create a secret token that is sent to the client. The certificate is used by the client to decrypt the token and validate that the server created it.</p>
</div>
<div class="paragraph">
<p>The fourth parameter in <code>loadOrCreateCertificate()</code> simply defines the path where the certificate files are stored. Do not mind about it at the moment, it will be clarified later.</p>
</div>
<div class="paragraph">
<p>The last parameter enables automatic certificate renewal when a certificate expires.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As the name refers, the certificate is used to identify each application instance. That means that on every computer, the application has a different certificate. The certificate contains the ApplicationUri, which also identifies the computer in which the application is run, and must match the one defined in the <code>ApplicationDescription</code>. Therefore, we provide the <code>appDescription</code> as a parameter for <code>loadOrCreateCertificate()</code>, which extracts the ApplicationUri from it.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that if some other application gets the same key pair, it can pretend to be the same application. The private key should be kept safe in order to reliably verify the identity of this application. Additionally, you may secure the usage of the private key with a password that is required to open it for use (but you need to add that in clear text in your application code or prompt it from the user). The certificate is public and can be distributed and stored freely in the servers and anywhere else.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The SDK stores private keys in '.pem' format, which supports password protection. If you get the certificate and private key from an external CA, you may get a '.pfx' file: if such is present (and '.pem' is not present), the application will use it to read the private key.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="issuer-certificate"><a class="anchor" href="#issuer-certificate"></a>4.1.3. Issuer Certificate</h4>
<div class="paragraph">
<p>More ideally, the certificates would be signed by a recognized Certificate Authority (CA) instead of using the self-signed keys as above.</p>
</div>
<div class="paragraph">
<p>If you wish to create your own <code>KeyPair</code> in your application, you can do that with the SDK like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">KeyPair</span> issuerCertificate =
        ApplicationIdentity.loadOrCreateIssuerCertificate(
                <span class="string"><span class="delimiter">&quot;</span><span class="content">ProsysSampleCA</span><span class="delimiter">&quot;</span></span>, privatePath, <span class="string"><span class="delimiter">&quot;</span><span class="content">opcua</span><span class="delimiter">&quot;</span></span>, <span class="integer">3650</span>, <span class="predefined-constant">false</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The sample code creates the issuer key pair with a private key password (“opcua”) for “ProsysSampleCA” for 10 years (3650 days). The key pair is stored in the <code>privatePath</code> (which refers to the PKI directory of the validator, as above).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The self-made issuer key does not replace a real CA. In real installations, it is always best to establish a central CA and create all keys for the applications using the CA. In this scenario, you can copy the certificate of the CA to the trust list of each OPC UA application. This will enable the applications to automatically trust all keys created by the CA.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>HTTPS protocol may require a CA signed certificate (especially with .NET applications), and therefore it may be necessary to create your own CA key. You will need to provide the CA key to the other applications so that they can verify the Application Instance Certificates signed by this key.</p>
</div>
</div>
<div class="sect3">
<h4 id="multiple-application-instance-certificates"><a class="anchor" href="#multiple-application-instance-certificates"></a>4.1.4. Multiple Application Instance Certificates</h4>
<div class="paragraph">
<p>OPC UA specification defines different security profiles, which may require different kind of Application Instance Certificates, for example with different key sizes. The SDK enables usage of several certificates by defining an array of keySizes, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Use 0 to use the default keySize and default file names (for other</span>
<span class="comment">// values the file names will include the key size.</span>
<span class="type">int</span><span class="type">[]</span> keySizes = <span class="keyword">new</span> <span class="type">int</span><span class="type">[]</span> { <span class="integer">0</span>, <span class="integer">4096</span> };</code></pre>
</div>
</div>
<div class="paragraph">
<p>The identity is then initialized as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Define the client application identity, including the security</span>
<span class="comment">// certificate</span>
<span class="directive">final</span> ApplicationIdentity identity = ApplicationIdentity
        .loadOrCreateCertificate(appDescription, <span class="string"><span class="delimiter">&quot;</span><span class="content">Sample Organisation</span><span class="delimiter">&quot;</span></span>,
        <span class="comment">/* Private Key Password */</span><span class="string"><span class="delimiter">&quot;</span><span class="content">opcua</span><span class="delimiter">&quot;</span></span>,
        <span class="comment">/* Key File Path */</span>privatePath,
        <span class="comment">/* CA certificate &amp; private key */</span>issuerCertificate,
        <span class="comment">/* Key Sizes for instance certificates to create */</span>keySizes,
        <span class="comment">/* Enable renewing the certificate */</span><span class="predefined-constant">true</span>);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="https-certificate"><a class="anchor" href="#https-certificate"></a>4.1.5. HTTPS Certificate</h4>
<div class="paragraph">
<p>If you wish to use HTTPS for connecting to the servers, you must also define a separate HTTPS certificate. This is done with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> hostName = <span class="predefined-type">InetAddress</span>.getLocalHost().getHostName();
identity.setHttpsCertificate(ApplicationIdentity
        .loadOrCreateHttpsCertificate(appDescription, hostName,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">opcua</span><span class="delimiter">&quot;</span></span>, issuerCertificate, privatePath, <span class="predefined-constant">true</span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The HTTPS certificate is a little bit different from the Application Instance Certificates, which are used for UA TCP binary transport and application authentication. In HTTPS, the slightly different certificate is needed for the underlying TLS encryption.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Most server applications do not support HTTPS at all and in normal use cases UA TCP is the best alternative regardless.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="assigning-the-application-identity"><a class="anchor" href="#assigning-the-application-identity"></a>4.1.6. Assigning the Application Identity</h4>
<div class="paragraph">
<p>Now, we can finally just assign the created identity to the <code>UaServer</code> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">server.setApplicationIdentity(identity);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="server-endpoints"><a class="anchor" href="#server-endpoints"></a>4.2. Server Endpoints</h3>
<div class="paragraph">
<p>The server endpoints are the connection points to which the client applications can connect. Each endpoint consists of an URL address and a security settings.</p>
</div>
<div class="paragraph">
<p>The server defines which endpoints are available and the client decides which of these it will use. The <code>UaClient</code> client implementation in the SDK, for example, will pick the matching endpoint automatically according to desired security settings.</p>
</div>
<div class="sect3">
<h4 id="endpoint-urls"><a class="anchor" href="#endpoint-urls"></a>4.2.1. Endpoint URLs</h4>
<div class="paragraph">
<p>First, we define the endpoint URL(s) using <code>setPort()</code> and <code>setServerName()</code> for the transport protocols we wish to support (<code>OpcTcp</code> and <code>OpcHttps</code> are the currently supported options):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// TCP Port number for the UA TCP protocol</span>
server.setPort(Protocol.OpcTcp, <span class="integer">52520</span>);
<span class="comment">// TCP Port for the HTTPS protocol</span>
server.setPort(Protocol.OpcHttps, <span class="integer">52443</span>);
server.setServerName(<span class="string"><span class="delimiter">&quot;</span><span class="content">OPCUA/SampleConsoleServer</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The properties will define the endpoint URLs of the server as follows</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;Protocol&gt;://&lt;Hostname&gt;:&lt;Port&gt;/&lt;ServerName&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>An endpoint URL is always defined using the actual hostname. The ServerName is optional and can be defined separately for each protocol as well.</p>
</div>
</div>
<div class="sect3">
<h4 id="bindaddresses"><a class="anchor" href="#bindaddresses"></a>4.2.2. BindAddresses</h4>
<div class="paragraph">
<p>If you need to limit the accessibility of the server to some network interfaces only, you can use the <code>setBindAddresses()</code>. This is the default:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Optionally restrict the InetAddresses to which the server is bound.</span>
<span class="comment">// You may also specify the addresses for each Protocol.</span>
<span class="comment">// This is the default (isEnableIPv6 defines whether IPv6 address should</span>
<span class="comment">// be included in the bound addresses. Note that it requires Java 7 or</span>
<span class="comment">// later to work in practice in Windows):</span>
server.setBindAddresses(EndpointUtil.getInetAddresses(server.isEnableIPv6()));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The addresses can be defined separately for each protocol.</p>
</div>
</div>
<div class="sect3">
<h4 id="security-modes"><a class="anchor" href="#security-modes"></a>4.2.3. Security Modes</h4>
<div class="paragraph">
<p>The server can support different security modes. They can be configured simply like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/*
 * Define the security modes to support for the Binary protocol.
 *
 * Note that different versions of the specification might add/deprecate some modes, in this
 * example all the modes are added, but you should add some way in your application to configure
 * these. The set is empty by default, you must add at least one SecurityMode for the server to
 * start.
 */</span>
<span class="predefined-type">Set</span>&lt;SecurityPolicy&gt; supportedSecurityPolicies = <span class="keyword">new</span> <span class="predefined-type">HashSet</span>&lt;SecurityPolicy&gt;();

<span class="comment">/*
 * This policy does not support any security. Should only be used in isolated networks.
 */</span>
supportedSecurityPolicies.add(SecurityPolicy.NONE);

<span class="comment">// Modes defined in previous versions of the specification</span>
supportedSecurityPolicies.addAll(SecurityPolicy.ALL_SECURE_101);
supportedSecurityPolicies.addAll(SecurityPolicy.ALL_SECURE_102);
supportedSecurityPolicies.addAll(SecurityPolicy.ALL_SECURE_103);

<span class="comment">/*
 * Per the 1.04 specification, only these should be used. However in practice this list only
 * contains very new security policies, which most of the client applications as of today that
 * are used might not be unable to (yet) use.
 */</span>
supportedSecurityPolicies.addAll(SecurityPolicy.ALL_SECURE_104);

<span class="predefined-type">Set</span>&lt;MessageSecurityMode&gt; supportedMessageSecurityModes = <span class="keyword">new</span> <span class="predefined-type">HashSet</span>&lt;MessageSecurityMode&gt;();

<span class="comment">/*
 * This mode does not support any security. Should only be used in isolated networks. This is
 * also the only mode, which does not require certificate exchange between the client and server
 * application (when used in conjunction of only ANONYMOUS UserTokenPolicy).
 */</span>
supportedMessageSecurityModes.add(MessageSecurityMode.None);

<span class="comment">/*
 * This mode support signing, so it is possible to detect if messages are tampered. Note that
 * they are not encrypted.
 */</span>
supportedMessageSecurityModes.add(MessageSecurityMode.Sign);

<span class="comment">/*
 * This mode signs and encrypts the messages. Only this mode is recommended outside of isolated
 * networks.
 */</span>
supportedMessageSecurityModes.add(MessageSecurityMode.SignAndEncrypt);

<span class="comment">/*
 * This creates all possible combinations (NONE pairs only with None) of the configured
 * MessageSecurityModes and SecurityPolicies) for opc.tcp communication.
 */</span>
server.getSecurityModes()
    .addAll(SecurityMode.combinations(supportedMessageSecurityModes, supportedSecurityPolicies));</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="https-security-policies"><a class="anchor" href="#https-security-policies"></a>4.2.4. HTTPS Security Policies</h4>
<div class="paragraph">
<p>If you define the port number for HTTPS, you may also define the TLS security policies that are supported. Note that starting from 4.0.0 you must also define which SecurityModes are supported, since application level authentication is now based on the Application Instance Certificates.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/*
 *
 * NOTE! The MessageSecurityMode.None for HTTPS means Application level authentication is not
 * used. If used in combination with the UserTokenPolicy ANONYMOUS anyone can access the server
 * (but the traffic is encrypted). HTTPS mode is always encrypted, therefore the given
 * MessageSecurityMode only affects if the UA certificates are exchanged when forming the
 * Session.
 */</span>
server.getHttpsSecurityModes().addAll(SecurityMode
    .combinations(<span class="predefined-type">EnumSet</span>.of(MessageSecurityMode.None, MessageSecurityMode.Sign), supportedSecurityPolicies));

<span class="comment">// The TLS security policies to use for HTTPS</span>
<span class="predefined-type">Set</span>&lt;HttpsSecurityPolicy&gt; supportedHttpsSecurityPolicies = <span class="keyword">new</span> <span class="predefined-type">HashSet</span>&lt;HttpsSecurityPolicy&gt;();
<span class="comment">// (HTTPS was defined starting from OPC UA Specification 1.02)</span>
supportedHttpsSecurityPolicies.addAll(HttpsSecurityPolicy.ALL_102);
supportedHttpsSecurityPolicies.addAll(HttpsSecurityPolicy.ALL_103);
<span class="comment">// Only these are recommended by the 1.04 Specification</span>
supportedHttpsSecurityPolicies.addAll(HttpsSecurityPolicy.ALL_104);
server.getHttpsSettings().setHttpsSecurityPolicies(supportedHttpsSecurityPolicies);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The constants <code>ALL_102</code>, <code>ALL_103</code> and <code>ALL_104</code> define which (HTTPS) security policies were considered safe in which OPC UA specification versions.</p>
</div>
<div class="paragraph">
<p>In order to be able to make a connection with HTTPS, you must also be able to validate the certificates properly. See <a href="#validating-https-certificates">Validating HTTPS Certificates</a> for details about that.</p>
</div>
<div class="paragraph">
<p>In general, HTTPS is quite tricky in practice, and you should really consider twice if you really want to use that. Check how your clients support it and use it if you need it. But usually you should do better with the UA TCP protocol, instead.</p>
</div>
<div class="paragraph">
<p>If you wish to disable HTTPS from your server, you can just use <code>server.setPort(Protocol.Https, 0)</code> to undefine the HTTPS port number.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>OPC UA security is not used for HTTPS encryption, but it can be for application level authentication. If it is used for that, then the MessageSecurityMode.Sign should be used. Also note that it is dangerous to have a combination of NONE and ANONYMOUS UserTokenPolicy, as it allows anyone to connect to the server (but the traffic is encrypted).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="user-security-tokens"><a class="anchor" href="#user-security-tokens"></a>4.2.5. User Security Tokens</h4>
<div class="paragraph">
<p>You must define one or more user token policies according to the type of tokens you wish to support. For example, to define all three alternatives: anonymous, username and certificate-based user authentication, you would add them all as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">server.addUserTokenPolicy(UserTokenPolicy.ANONYMOUS);
server.addUserTokenPolicy(UserTokenPolicy.SECURE_USERNAME_PASSWORD);
server.addUserTokenPolicy(UserTokenPolicy.SECURE_CERTIFICATE);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you support user tokens, you should also implement a <code>UserValidator</code>, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">server.setUserValidator(userValidator);</code></pre>
</div>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="directive">static</span> UserValidator userValidator = <span class="keyword">new</span> UserValidator() {

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">boolean</span> onValidate(Session session, UserIdentity userIdentity) {
                <span class="comment">// Return true, if the user is allowed access to the server</span>
                <span class="comment">// Note that the UserIdentity can be of different actual types,</span>
                <span class="comment">// depending on the selected authentication mode (by the client).</span>
                println(<span class="string"><span class="delimiter">&quot;</span><span class="content">onValidate: userIdentity=</span><span class="delimiter">&quot;</span></span> + userIdentity);
                <span class="keyword">if</span> (userIdentity.getType().equals(UserTokenType.UserName))
                        <span class="keyword">if</span> (userIdentity.getName().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">opcua</span><span class="delimiter">&quot;</span></span>)
                                        &amp;&amp; userIdentity.getPassword().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">opcua</span><span class="delimiter">&quot;</span></span>))
                                <span class="keyword">return</span> <span class="predefined-constant">true</span>;
                        <span class="keyword">else</span>
                                <span class="keyword">return</span> <span class="predefined-constant">false</span>;
                <span class="keyword">if</span> (userIdentity.getType().equals(UserTokenType.Certificate))
                        <span class="comment">// Implement your strategy here, for example using the</span>
                        <span class="comment">// PkiFileBasedCertificateValidator</span>
                        <span class="keyword">return</span> <span class="predefined-constant">true</span>;
                <span class="keyword">return</span> <span class="predefined-constant">true</span>;
        }
};</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="custom-endpoint-configuration"><a class="anchor" href="#custom-endpoint-configuration"></a>4.2.6. Custom Endpoint Configuration</h4>
<div class="paragraph">
<p>If you wish to omit the automatic generation of endpoints and need more customization options, you can use <code>UaServer.addEndpoint()</code> and <code>removeEndpoint()</code> to modify the list of endpoints more flexibly. This makes it possible to, for example, define different security settings for a certain network interface.</p>
</div>
</div>
<div class="sect3">
<h4 id="endpoint-initialization"><a class="anchor" href="#endpoint-initialization"></a>4.2.7. Endpoint Initialization</h4>
<div class="paragraph">
<p>The <code>UaServer</code> will initialize automatically one endpoint for each endpoint URL and SecurityMode combination during server initialization (see <a href="#server-endpoints">Server Endpoints</a>).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="validating-client-applications-via-certificates"><a class="anchor" href="#validating-client-applications-via-certificates"></a>4.3. Validating Client Applications via Certificates</h3>
<div class="paragraph">
<p>An integral part of all OPC UA applications, in addition to defining their own security information, is of course, to validate the security information of the other party.</p>
</div>
<div class="paragraph">
<p>To validate the certificate of OPC UA clients, you need to define a <code>CertificateValidator</code> in the <code>UaServer</code>. This validator is used to validate the certificates received from the clients automatically.</p>
</div>
<div class="paragraph">
<p>To provide a standard certificate validation mechanism, the OPC UA Java Stack contains a specific implementation of the <code>CertificateValidator</code>, the <code>DefaultCertificateValidator</code>. You can create the validator as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="comment">// Use PKI files to keep track of the trusted and rejected server</span>
    <span class="comment">// certificates...</span>
    <span class="directive">final</span> PkiDirectoryCertificateStore certStore = <span class="keyword">new</span> PkiDirectoryCertificateStore();
    <span class="directive">final</span> DefaultCertificateValidator validator = <span class="keyword">new</span> DefaultCertificateValidator(certStore);
    client.setCertificateValidator(validator);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The way this validator stores the received certificates is defined by the <code>certStore</code>, which in the example is an instance of <code>PkiDirectoryCertificateStore</code>. It keeps the certificates in a file directory structure, such as
'PKI/CA/certs' and 'PKI/CA/rejected'. The trusted certificates are stored in the 'certs' folder and the untrusted in 'rejected'. By default, the certificates are not trusted so they are stored in <code>rejected</code>. You can then manually move the trusted certificates to the 'certs' directory.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you have used Java SDK 1.x or 2.x, you are familiar with <code>PkiFileBasedCertificateValidator</code> included in the SDK. Since Java SDK 3.0 the classes provided by the Java Stack, namely <code>DefaultCertificateValidator</code> and <code>PkiDirectoryCertificateStore</code>, replace the same functionality with a more flexible design. In 3.x the old validator was deprecated and is now removed in 4.x.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Additionally, you can plug a custom handler to the Validator by defining a <code>ValidationListener</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">validator.setValidationListener(validationListener);

<span class="directive">private</span> <span class="directive">static</span> DefaultCertificateValidatorListener validationListener = <span class="keyword">new</span> MyCertificateValidationListener();</code></pre>
</div>
</div>
<div class="paragraph">
<p>where the <code>validationListener</code> can be defined according to the example below. This example implementation will accept certificates even though the ApplicationUri does not match the one in the <code>ApplicationDescription</code>, as is done in the SampleConsoleServer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="directive">static</span> CertificateValidationListener validationListener = <span class="keyword">new</span> CertificateValidationListener() {

        <span class="annotation">@Override</span>
        <span class="directive">public</span> ValidationResult onValidate(Cert certificate,
                ApplicationDescription applicationDescription,
                <span class="predefined-type">EnumSet</span>&lt;CertificateCheck&gt; passedChecks) {
                <span class="comment">// Do not mind about URI...</span>
                <span class="keyword">if</span> (passedChecks.containsAll(<span class="predefined-type">EnumSet</span>.of(CertificateCheck.Trusted,
                        CertificateCheck.Validity, CertificateCheck.Signature))) {
                <span class="keyword">if</span> (!passedChecks.contains(CertificateCheck.Uri))
                        <span class="keyword">try</span> {
                        println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Client's ApplicationURI (</span><span class="delimiter">&quot;</span></span>
                                + applicationDescription.getApplicationUri()
                                + <span class="string"><span class="delimiter">&quot;</span><span class="content">) does not match the one in certificate: </span><span class="delimiter">&quot;</span></span>
                                + PkiFileBasedCertificateValidator
                                        .getApplicationUriOfCertificate(certificate));
                        } <span class="keyword">catch</span> (<span class="exception">CertificateParsingException</span> e) {
                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>(e);
                        }
                <span class="keyword">return</span> ValidationResult.AcceptPermanently;
                }
                <span class="keyword">return</span> ValidationResult.Reject;
        }
};</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="validating-https-certificates"><a class="anchor" href="#validating-https-certificates"></a>4.3.1. Validating HTTPS Certificates</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The HTTPS certificates are not used for application authentication. Instead, the SDK enables usage of Application Instance Certificates for that, similar to UA TCP. This requires usage of MessageSecurityMode=Sign to be used.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="registration-to-a-discovery-server"><a class="anchor" href="#registration-to-a-discovery-server"></a>4.4. Registration to a Discovery Server</h3>
<div class="sect3">
<h4 id="internal-discovery-server"><a class="anchor" href="#internal-discovery-server"></a>4.4.1. Internal Discovery Server</h4>
<div class="paragraph">
<p>The <code>UaServer</code> implements the DiscoveryService by itself. So you can use the FindServers service from any client application to get a list of servers (or actually just your server) and endpoints that are available from it.</p>
</div>
</div>
<div class="sect3">
<h4 id="local-discovery-server"><a class="anchor" href="#local-discovery-server"></a>4.4.2. Local Discovery Server</h4>
<div class="paragraph">
<p>The Local Discovery Server (LDS) is an application provided by the OPC Foundation that specifically keeps a list of servers that are available locally. The clients can query all available servers from the Local Discovery Server.</p>
</div>
<div class="paragraph">
<p>To get your server listed in the Local Discovery Server, you can define the Discovery Server URL for your server with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Register to the local discovery server (if present)</span>
server.setDiscoveryServerUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">opc.tcp://localhost:4840</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The standard port number used by the DiscoveryServer is 4840, and you should be able to access it without any server name, i.e. even when the actual URL for the .NET DiscoveryServer is <code>opc.tcp://localhost:4840/UADiscovery</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively, you can call <code>UaServer.registerServer()</code> yourself.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The discovery server registration is done via a secure channel. The Discovery Server must trust your server before it allows registration. This requires that you copy the application certificate of your application to the certificate store used by the Discovery Server.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you wish to handle errors in registration, you can do that in a <code>UaServerListener</code> (<code>onRegisterServerError</code>), which you can add to <code>UaServer</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="server-initialization"><a class="anchor" href="#server-initialization"></a>4.5. Server Initialization</h3>
<div class="paragraph">
<p>Once you have setup the server parameters, call</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">server.init();</code></pre>
</div>
</div>
<div class="paragraph">
<p>After this you can proceed with your own customizations, such as defining your data in the address space.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="address-space"><a class="anchor" href="#address-space"></a>5. Address Space</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Although security is crucial, the most important aspect of the server is the address space that defines the data in the server and how it is managed.</p>
</div>
<div class="paragraph">
<p>The Address Space is managed by <code>NodeManager</code> objects which are used to define the OPC UA Nodes. Nodes are used for all elements of the address space, including Objects, Variables, different types, etc.</p>
</div>
<div class="sect2">
<h3 id="standard-node-managers"><a class="anchor" href="#standard-node-managers"></a>5.1. Standard Node Managers</h3>
<div class="paragraph">
<p>By default, <code>UaServer</code> always contains a base node manager, <code>NodeManagerRoot</code>. It handles the standard OPC UA server address space, i.e. nodes located in the OPC UA standard namespace (namespaceIndex = 0). It includes the root structure of the address space consisting of the main folders (Views, Objects and Types) and the default UA types. It also manages the Server Object which is used to publish server status and diagnostic information to OPC UA clients.</p>
</div>
<div class="paragraph">
<p>In addition, the <code>UaServer</code> also contains an internal <code>NodeManagerUaServer</code> which manages the server specific diagnostics, as specified by the OPC UA specification (namespaceIndex = 1).</p>
</div>
</div>
<div class="sect2">
<h3 id="your-own-node-managers"><a class="anchor" href="#your-own-node-managers"></a>5.2. Your Own Node Managers</h3>
<div class="paragraph">
<p>In order to be able to add your own nodes into the address space of your server, you must define your own node manager(s) with your own namespace(s). You have a couple of alternatives for choosing which node manager to create.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Instead of defining a single node manager for your data, you can always decide to split your node hierarchy and manage different parts of it with different node managers.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is a good convention to define types and instances in separate namespaces. The OPC Foundation defines several companion specifications (i.e. different domain-specific information models) and their respective types can be loaded into the server in their respective namespaces. See <a href="#information-modeling">Information Modeling</a> for more about the information models.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="nodemanageruanode"><a class="anchor" href="#nodemanageruanode"></a>5.2.1. NodeManagerUaNode</h4>
<div class="paragraph">
<p>Typically, the easiest option to create your own node manager is to use <code>NodeManagerUaNode</code> in which you can create all the nodes as implementations of <code>UaNode</code> objects (or actually subtypes of <code>UaNode</code>, such as <code>UaObject</code>, <code>UaVariable</code>, etc. according to the actual NodeClass of each node).</p>
</div>
<div class="paragraph">
<p>To create your node manager, you must specify your own NamespaceURI which identifies the namespace of your product. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">myNodeManager = <span class="keyword">new</span> NodeManagerUaNode(server, <span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.prosysopc.com/OPCUA/SampleAddressSpace</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The server will also assign a NamespaceIndex for each namespace. In practice, the index will be used to refer to the namespace more often than the NamespaceURI.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The current SampleConsoleServer application is actually defining a new subclass of <code>NodeManagerUaNode</code>, which it then instantiates. And the rest of the implementation code is in the subclass. See <code>MyNodeManager.createAddressSpace()</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="adding-nodes"><a class="anchor" href="#adding-nodes"></a>5.2.2. Adding Nodes</h4>
<div class="paragraph">
<p>Next you need to create the node objects and add them to your node manager. Each node is identified by a unique NodeId. It comprises of a NamespaceIndex and the actual identifier. We must use the same NamespaceIndex that our node manager uses also in our NodeIds. So we begin by recording that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">int</span> ns = myNodeManager.getNamespaceIndex();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, we will find the base types and folders that we will use when we add our data nodes to the address space:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> UaObject objectsFolder = server.getNodeManagerRoot().getObjectsFolder();
<span class="directive">final</span> UaType baseObjectType = server.getNodeManagerRoot().getType(Identifiers.BaseObjectType);
<span class="directive">final</span> UaType baseDataVariableType = server.getNodeManagerRoot().getType(Identifiers.BaseDataVariableType);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, we are ready to define our nodes. The following example demonstrates how you can create different node types manually in the code. Later on, we will learn how to use information models to initialize types and also how to instantiate objects with complete structures in an easier way.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Folder for my objects</span>
<span class="directive">final</span> NodeId myObjectsFolderId = <span class="keyword">new</span> NodeId(ns, <span class="string"><span class="delimiter">&quot;</span><span class="content">MyObjectsFolder</span><span class="delimiter">&quot;</span></span>);
myObjectsFolder = createInstance(FolderTypeNode.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">MyObjects</span><span class="delimiter">&quot;</span></span>,         myObjectsFolderId);

<span class="local-variable">this</span>.addNodeAndReference(objectsFolder, myObjectsFolder, Identifiers.Organizes);

<span class="comment">// My Device Type</span>

<span class="comment">// The preferred way to create types is to use Information Models, but this example shows how</span>
<span class="comment">// you can do that also with your own code</span>

<span class="directive">final</span> NodeId myDeviceTypeId = <span class="keyword">new</span> NodeId(ns, <span class="string"><span class="delimiter">&quot;</span><span class="content">MyDeviceType</span><span class="delimiter">&quot;</span></span>);
UaObjectType myDeviceType = <span class="keyword">new</span> UaObjectTypeNode(<span class="local-variable">this</span>, myDeviceTypeId,<span class="string"><span class="delimiter">&quot;</span><span class="content">MyDeviceType</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Locale</span>.ENGLISH);
<span class="local-variable">this</span>.addNodeAndReference(baseObjectType, myDeviceType, Identifiers.HasSubtype);

<span class="comment">// My Device</span>
<span class="directive">final</span> NodeId myDeviceId = <span class="keyword">new</span> NodeId(ns, <span class="string"><span class="delimiter">&quot;</span><span class="content">MyDevice</span><span class="delimiter">&quot;</span></span>);
myDevice = <span class="keyword">new</span> UaObjectNode(<span class="local-variable">this</span>, myDeviceId, <span class="string"><span class="delimiter">&quot;</span><span class="content">MyDevice</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Locale</span>.ENGLISH);
myDevice.setTypeDefinition(myDeviceType);
myObjectsFolder.addReference(myDevice, Identifiers.HasComponent, <span class="predefined-constant">false</span>);

<span class="comment">// My Level Type</span>
<span class="directive">final</span> NodeId myLevelTypeId = <span class="keyword">new</span> NodeId(ns, <span class="string"><span class="delimiter">&quot;</span><span class="content">MyLevelType</span><span class="delimiter">&quot;</span></span>);
UaType myLevelType = <span class="local-variable">this</span>.addType(myLevelTypeId, <span class="string"><span class="delimiter">&quot;</span><span class="content">MyLevelType</span><span class="delimiter">&quot;</span></span>, baseDataVariableType);

<span class="comment">// My Level Measurement</span>
<span class="directive">final</span> NodeId myLevelId = <span class="keyword">new</span> NodeId(ns, <span class="string"><span class="delimiter">&quot;</span><span class="content">MyLevel</span><span class="delimiter">&quot;</span></span>);
UaType doubleType = getServer().getNodeManagerRoot().getType(Identifiers.Double);
myLevel = <span class="keyword">new</span> CacheVariable(<span class="local-variable">this</span>, myLevelId, <span class="string"><span class="delimiter">&quot;</span><span class="content">MyLevel</span><span class="delimiter">&quot;</span></span>, LocalizedText.NO_LOCALE);
myLevel.setDataType(doubleType);
myLevel.setTypeDefinition(myLevelType);
myDevice.addComponent(myLevel);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We use <code>ns</code> here, to define the NodeIds using our own NamespaceIndex.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Standard node instances (such as <code>myObjectsFolder</code>, which is of type <code>FolderTypeNode</code>) must be created with <code>NodeManagerUaNode.createInstance()</code>, instead of using the constructor against the type (with <code>new</code>).</p>
</div>
<div class="paragraph">
<p><code>MyDeviceType</code> and the rest are defined using <code>UaObjectTypeNode</code>, <code>UaObjectNode</code> and <code>CacheVariable</code>. These are the basic building blocks, corresponding to the different OPC UA NodeClasses. Custom nodes such as these can still be instantiated using the <code>new</code> command. In practice, it is advisable to use them only to add single nodes. We are doing it here mostly to show you how to use these basic building blocks.</p>
</div>
<div class="paragraph">
<p>See <a href="#information-modeling">Information Modeling</a> for more details on the standard types and about defining your own types.</p>
</div>
<div class="paragraph">
<p>Note that we are using alternative strategies for defining the OPC UA References for nodes. The basic way is to use <code>NodeManagerUaNode.addNodeAndReference()</code> for that. As the name describes, it will add the node to the node manager and it will also create a Reference from the parent node to the added node.</p>
</div>
<div class="paragraph">
<p>The more convenient way is to use <code>UaNode.addReference()</code>, which will in fact do the same if you are defining a Hierarchical Reference.
If you wish to add a HasComponent or HasProperty Reference, then you can do that directly with <code>UaNode.addComponent()</code> or <code>UaNode.addProperty()</code> respectively.</p>
</div>
</div>
<div class="sect3">
<h4 id="custom-node-manager"><a class="anchor" href="#custom-node-manager"></a>5.2.3. Custom Node Manager</h4>
<div class="paragraph">
<p>Instead of using the <code>NodeManagerUaNode</code>, you can declare a custom node manager that is derived from <code>NodeManager</code>. You will need to implement all node handling yourself, but you don’t need to instantiate a <code>UaNode</code> object in the memory for every node. This is especially useful if your OPC UA server is just wrapping an existing data store and you do not want to replicate all the data in the memory of the server. Also, if you need to provide access to a large amount of nodes (actual number depending on the amount of memory available), this may be the only option for you.</p>
</div>
<div class="paragraph">
<p>See <a href="#mybignodemanager">MyBigNodeManager</a> for a complete example of such a node manager.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="node-manager-listener"><a class="anchor" href="#node-manager-listener"></a>5.3. Node Manager Listener</h3>
<div class="paragraph">
<p>Instead of creating your own version of the <code>NodeManager</code> (or <code>NodeManagerUaNode</code>), you can simply define your own listener in which you may react to the browse and node management requests from the clients. The listener must implement the <code>NodeManagerListener</code> interface. After creating your listener you need to add it to your node manager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">myNodeManager.addListener(myNodeManagerListener);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a simple example of a listener which just denies node management actions from anonymous users:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
 * A sample implementation of a NodeManagerListener.
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyNodeManagerListener</span> <span class="directive">implements</span> NodeManagerListener {

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> onAfterAddNode(ServiceContext serviceContext, NodeId parentNodeId, UaNode parent, NodeId nodeId,
      UaNode node, NodeClass nodeClass, QualifiedName browseName, NodeAttributes attributes,
      UaReferenceType referenceType, ExpandedNodeId typeDefinitionId, UaNode typeDefinition) <span class="directive">throws</span> StatusException {
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> onAfterAddReference(ServiceContext serviceContext, NodeId sourceNodeId, UaNode sourceNode,
      ExpandedNodeId targetNodeId, UaNode targetNode, NodeId referenceTypeId, UaReferenceType referenceType,
      <span class="type">boolean</span> isForward) <span class="directive">throws</span> StatusException {
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> onAfterCreateMonitoredDataItem(ServiceContext serviceContext, Subscription subscription,
      MonitoredDataItem item) {
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> onAfterDeleteMonitoredDataItem(ServiceContext serviceContext, Subscription subscription,
      MonitoredDataItem item) {
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> onAfterModifyMonitoredDataItem(ServiceContext serviceContext, Subscription subscription,
      MonitoredDataItem item) {
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> onAddNode(ServiceContext serviceContext, NodeId parentNodeId, UaNode parent, NodeId nodeId,
      NodeClass nodeClass, QualifiedName browseName, NodeAttributes attributes, UaReferenceType referenceType,
      ExpandedNodeId typeDefinitionId, UaNode typeDefinition) <span class="directive">throws</span> StatusException {
    <span class="comment">// Notification of a node addition request.</span>
    <span class="comment">// Note that NodeManagerTable#setNodeManagementEnabled(true) must be</span>
    <span class="comment">// called to enable these methods.</span>
    <span class="comment">// Anyway, we just check the user access.</span>
    checkUserAccess(serviceContext);
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> onAddReference(ServiceContext serviceContext, NodeId sourceNodeId, UaNode sourceNode,
      ExpandedNodeId targetNodeId, UaNode targetNode, NodeId referenceTypeId, UaReferenceType referenceType,
      <span class="type">boolean</span> isForward) <span class="directive">throws</span> StatusException {
    <span class="comment">// Notification of a reference addition request.</span>
    <span class="comment">// Note that NodeManagerTable#setNodeManagementEnabled(true) must be</span>
    <span class="comment">// called to enable these methods.</span>
    <span class="comment">// Anyway, we just check the user access.</span>
    checkUserAccess(serviceContext);
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">boolean</span> onBrowseNode(ServiceContext serviceContext, ViewDescription view, NodeId nodeId, UaNode node,
      UaReference reference) {
    <span class="comment">// Perform custom filtering, for example based on the user</span>
    <span class="comment">// doing the browse. The method is called separately for each reference.</span>
    <span class="comment">// Default is to return all references for everyone</span>
    <span class="keyword">return</span> <span class="predefined-constant">true</span>;
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> onCreateMonitoredDataItem(ServiceContext serviceContext, Subscription subscription, NodeId nodeId,
      UaNode node, UnsignedInteger attributeId, NumericRange indexRange, MonitoringParameters params,
      MonitoringFilter filter, AggregateFilterResult filterResult, MonitoringMode monitoringMode)
      <span class="directive">throws</span> StatusException {
    <span class="comment">// Notification of a monitored item creation request</span>

    <span class="comment">// You may, for example start to monitor the node from a physical</span>
    <span class="comment">// device, only once you get a request for it from a client</span>
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> onDeleteMonitoredDataItem(ServiceContext serviceContext, Subscription subscription,
      MonitoredDataItem monitoredItem) {
    <span class="comment">// Notification of a monitored item delete request</span>
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> onDeleteNode(ServiceContext serviceContext, NodeId nodeId, UaNode node, <span class="type">boolean</span> deleteTargetReferences)
      <span class="directive">throws</span> StatusException {
    <span class="comment">// Notification of a node deletion request.</span>
    <span class="comment">// Note that NodeManagerTable#setNodeManagementEnabled(true) must be</span>
    <span class="comment">// called to enable these methods.</span>
    <span class="comment">// Anyway, we just check the user access.</span>
    checkUserAccess(serviceContext);
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> onDeleteReference(ServiceContext serviceContext, NodeId sourceNodeId, UaNode sourceNode,
      ExpandedNodeId targetNodeId, UaNode targetNode, NodeId referenceTypeId, UaReferenceType referenceType,
      <span class="type">boolean</span> isForward, <span class="type">boolean</span> deleteBidirectional) <span class="directive">throws</span> StatusException {
    <span class="comment">// Notification of a reference deletion request.</span>
    <span class="comment">// Note that NodeManagerTable#setNodeManagementEnabled(true) must be</span>
    <span class="comment">// called to enable these methods.</span>
    <span class="comment">// Anyway, we just check the user access.</span>
    checkUserAccess(serviceContext);
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> onGetReferences(ServiceContext serviceContext, ViewDescription viewDescription, NodeId nodeId,
      UaNode node, <span class="predefined-type">List</span>&lt;UaReference&gt; references) {
    <span class="comment">// Add custom references that are not defined in the nodes here.</span>
    <span class="comment">// Useful for non-UaNode-based node managers - or references.</span>
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> onModifyMonitoredDataItem(ServiceContext serviceContext, Subscription subscription,
      MonitoredDataItem item, UaNode node, MonitoringParameters params, MonitoringFilter filter,
      AggregateFilterResult filterResult) {
    <span class="comment">// Notification of a monitored item modification request</span>
  }

  <span class="directive">private</span> <span class="type">void</span> checkUserAccess(ServiceContext serviceContext) <span class="directive">throws</span> StatusException {
    <span class="comment">// Do not allow for anonymous users</span>
    <span class="keyword">if</span> (serviceContext.getSession().getUserIdentity().getType().equals(UserTokenType.Anonymous)) {
      <span class="keyword">throw</span> <span class="keyword">new</span> StatusException(StatusCodes.Bad_UserAccessDenied);
    }
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that node management is not enabled by default at all. In order to enable it, call <code>NodeManagerTable.setNodeManagementEnabled(true)</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="node-types"><a class="anchor" href="#node-types"></a>5.4. Node Types</h3>
<div class="paragraph">
<p>The <code>NodeManagerUaNode</code> uses <code>UaNode</code> objects to manage the nodes in the address space. These are simple to use, as you can define the OPC UA Attribute values into the objects and use them in your application to represent the data.</p>
</div>
<div class="paragraph">
<p>There are various implementations of <code>UaNode</code> as well as other interface types that define the Attributes and Reference requirements according to the respective OPC UA NodeClasses.</p>
</div>
<div class="sect3">
<h4 id="generic-nodes"><a class="anchor" href="#generic-nodes"></a>5.4.1. Generic Nodes</h4>
<div class="paragraph">
<p>The generic node types are defined in the Java package <code>com.prosysopc.ua.server.nodes</code>.</p>
</div>
<div class="paragraph">
<p>All the server-side nodes descend from <code>ServerNode</code> which implements the basis of a node owned by a <code>NodeManager</code>. <code>BaseNode</code> is the actual base implementation which adds a field for each Attribute and a list of References that it keeps in the memory. These are abstract base classes and you cannot instantiate either of them.</p>
</div>
<div class="paragraph">
<p>The classes that you will typically use are <code>UaObjectNode</code> for representing OPC UA Objects and one of the following for OPC UA Variable and Property nodes respectively:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>CacheVariable</code> &amp; <code>CacheProperty</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>They offer the same interface for all OPC UA DataTypes and you can easily keep any values in the Variables. You can use <code>CacheVariable.updateValue()</code> to provide new samples to the Variables.</p>
</div>
<div class="paragraph">
<p>In addition, you can use the following generic types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>PlainVariable</code> &amp; <code>PlainProperty</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With them, you can define the data type used for the value of the Variable or Property, and you can also access the value in a bit simpler way.</p>
</div>
<div class="paragraph">
<p>For example, if you define</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">mySwitch = <span class="keyword">new</span> PlainVariable&lt;<span class="predefined-type">Boolean</span>&gt;(myNodeManager, mySwitchId, <span class="string"><span class="delimiter">&quot;</span><span class="content">MySwitch</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Locale</span>.ENGLISH);</code></pre>
</div>
</div>
<div class="paragraph">
<p>you can set it’s value using <code>setCurrentValue()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">mySwitch.setCurrentValue(<span class="predefined-constant">false</span>);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Properties are actually defined as special kind of Variables in the OPC UA Specification. Their NodeClass is Variable but their TypeDefinition is always PropertyType. In the SDK, we use the interface <code>UaProperty</code> to enable an alternate way to separate Properties from other Variables. All Java classes of the SDK that represent Properties just inherit from the respective classes representing Variables and additionally implement the <code>UaProperty</code> interface.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="instances"><a class="anchor" href="#instances"></a>5.4.2. Instances</h4>
<div class="paragraph">
<p>Most OPC UA types are defined with a structure. Objects and Variables are both instances and may contain a specific structure as defined by their respective TypeDefinitions.
The Java SDK enables creation of complete instances, including the structure, as Java objects.
The creation of instances is based on the <code>NodeBuilder</code>, which is available from <code>NodeManagerUaNode</code>. There is also a convenience method, <code>createInstance()</code>, which can be used to create new instances of known types. For example, you can create a new DataItem with</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">DataItemType node = nodeManager.createInstance(DataItemTypeNode.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">DataItem</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, this will create a complete Object or Variable instance including its structure, as defined in the type address space. Only nodes inside the structure with the Mandatory ModellingRule are created by default, but you can configure which Optional nodes should be created using the <code>NodeBuilder</code> directly.</p>
</div>
<div class="paragraph">
<p>Please see <a href="#conditions">Conditions</a> for one example of configuring Optional nodes.</p>
</div>
</div>
<div class="sect3">
<h4 id="opc-ua-standard-types"><a class="anchor" href="#opc-ua-standard-types"></a>5.4.3. OPC UA Standard Types</h4>
<div class="paragraph">
<p>The OPC UA standard defines several types which typically define a specific structure. All of these types are modeled in the SDK and they are available as Java objects as shown in the above examples.</p>
</div>
<div class="paragraph">
<p>The standard OPC UA types included in the SDK are defined in the Java package <code>com.prosysopc.ua.types.opcua</code>.</p>
</div>
<div class="paragraph">
<p>This package contains the interface definitions. The server-specific implementations are in the ‘server’ sub-package and the respective client implementations in the <code>client</code> sub-package.</p>
</div>
<div class="paragraph">
<p>These interfaces and implementations are based on code generation, which you can also use for your own types as described in the chapter <a href="#codegen">Code Generation</a>.</p>
</div>
<div class="paragraph">
<p>The SDK does not contain any pre-generated classes for the OPC UA companion specifications by default. If you wish to use them, you can use the Code Generation to create the classes for your own needs.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="i-o-manager"><a class="anchor" href="#i-o-manager"></a>6. I/O Manager</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I/O managers are used to handle read and write calls from the client applications. The abstract base class that defines the interface is <code>IoManager</code>. The default implementation used in the <code>NodeManagerUaNode</code> is <code>IoManagerUaNode</code>. It reads attribute values directly from the <code>UaNode</code> objects of the node manager.</p>
</div>
<div class="sect2">
<h3 id="nodes-as-data-cache"><a class="anchor" href="#nodes-as-data-cache"></a>6.1. Nodes as Data Cache</h3>
<div class="paragraph">
<p>If you use <code>UaNode</code>-based node objects that cache all values in the memory, you do not need to do anything else than provide new values to the objects to make your server work as expected. Examples of such nodes are the above mentioned <code>CacheVariable</code>, <code>CacheProperty</code>, <code>PlainVariable</code> and <code>PlainProperty</code> as well as all non-variable nodes.</p>
</div>
</div>
<div class="sect2">
<h3 id="custom-i-o-manager"><a class="anchor" href="#custom-i-o-manager"></a>6.2. Custom I/O Manager</h3>
<div class="paragraph">
<p>If you go for the custom node manager, as described in <a href="#custom-node-manager">Custom Node Manager</a>, you can also use a custom <code>IoManager</code> implementation. In case you have your data already in a background system and do not wish to replicate the data in the node objects, you can refer read and write calls to the custom I/O manager that can communicate with the background system. Refer to <a href="#mybigiomanager">MyBigIoManager</a> for a sample of such a customized I/O Manager.</p>
</div>
<div class="paragraph">
<p>If you define your own <code>IoManager</code> implementation, you can assign it to your node manager with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">myNodeManager.setIoManager(myIoManager);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="i-o-manager-listener"><a class="anchor" href="#i-o-manager-listener"></a>6.3. I/O Manager Listener</h3>
<div class="paragraph">
<p>An alternative way to customize the functionalities of an I/O manager is to create your own listener implementing the <code>IoManagerListener</code> interface. It will let you keep the standard <code>IoManager</code> (or <code>IoManagerUaNode</code>), but still provide your own definitions for some of the methods. The listener is assigned to the I/O manager with</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">myNodeManager.getIoManager().setListener(myIoManagerListener);</code></pre>
</div>
</div>
<div class="paragraph">
<p>and a sample listener looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
 * A sample implementation of an IoManagerListener.
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyIoManagerListener</span> <span class="directive">implements</span> IoManagerListener {
  <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">Logger</span> logger = LoggerFactory.getLogger(MyIoManagerListener.class);

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="predefined-type">EnumSet</span>&lt;AccessLevel&gt; onGetUserAccessLevel(ServiceContext serviceContext, NodeId nodeId, UaVariable node) {
    <span class="comment">// The AccessLevel defines the accessibility of the Variable.Value</span>
    <span class="comment">// attribute</span>

    <span class="comment">// Define anonymous access</span>
    <span class="comment">// if (serviceContext.getSession().getUserIdentity().getType()</span>
    <span class="comment">// .equals(UserTokenType.Anonymous))</span>
    <span class="comment">// return EnumSet.noneOf(AccessLevel.class);</span>
    <span class="keyword">if</span> (node.getHistorizing()) {
      <span class="keyword">return</span> <span class="predefined-type">EnumSet</span>.of(AccessLevel.CurrentRead, AccessLevel.CurrentWrite, AccessLevel.HistoryRead);
    } <span class="keyword">else</span> {
      <span class="keyword">return</span> <span class="predefined-type">EnumSet</span>.of(AccessLevel.CurrentRead, AccessLevel.CurrentWrite);
    }
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="predefined-type">Boolean</span> onGetUserExecutable(ServiceContext serviceContext, NodeId nodeId, UaMethod node) {
    <span class="comment">// Enable execution of all methods that are allowed by default</span>
    <span class="keyword">return</span> <span class="predefined-constant">true</span>;
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="predefined-type">EnumSet</span>&lt;WriteAccess&gt; onGetUserWriteMask(ServiceContext serviceContext, NodeId nodeId, UaNode node) {
    <span class="comment">// Enable writing to everything that is allowed by default</span>
    <span class="comment">// The WriteMask defines the writable attributes, except for Value,</span>
    <span class="comment">// which is controlled by UserAccessLevel (above)</span>

    <span class="comment">// The following would deny write access for anonymous users:</span>
    <span class="comment">// if</span>
    <span class="comment">// (serviceContext.getSession().getUserIdentity().getType().equals(</span>
    <span class="comment">// UserTokenType.Anonymous))</span>
    <span class="comment">// return EnumSet.noneOf(WriteAccess.class);</span>
    <span class="keyword">return</span> <span class="predefined-type">EnumSet</span>.allOf(WriteAccess.class);
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">boolean</span> onReadNonValue(ServiceContext serviceContext, NodeId nodeId, UaNode node, UnsignedInteger attributeId,
      DataValue dataValue) <span class="directive">throws</span> StatusException {
    <span class="keyword">return</span> <span class="predefined-constant">false</span>;
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">boolean</span> onReadValue(ServiceContext serviceContext, NodeId nodeId, UaValueNode node, NumericRange indexRange,
      TimestampsToReturn timestampsToReturn, DateTime minTimestamp, DataValue dataValue) <span class="directive">throws</span> StatusException {
    <span class="keyword">if</span> (logger.isDebugEnabled()) {
      logger.debug(<span class="string"><span class="delimiter">&quot;</span><span class="content">onReadValue: nodeId=</span><span class="delimiter">&quot;</span></span> + nodeId + (node != <span class="predefined-constant">null</span> ? <span class="string"><span class="delimiter">&quot;</span><span class="content"> node=</span><span class="delimiter">&quot;</span></span> + node.getBrowseName() : <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>));
    }
    <span class="keyword">return</span> <span class="predefined-constant">false</span>;
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">boolean</span> onWriteNonValue(ServiceContext serviceContext, NodeId nodeId, UaNode node, UnsignedInteger attributeId,
      DataValue dataValue) <span class="directive">throws</span> StatusException {
    <span class="keyword">return</span> <span class="predefined-constant">false</span>;
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">boolean</span> onWriteValue(ServiceContext serviceContext, NodeId nodeId, UaValueNode node, NumericRange indexRange,
      DataValue dataValue) <span class="directive">throws</span> StatusException {
    logger.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">onWriteValue: nodeId=</span><span class="delimiter">&quot;</span></span> + nodeId + (node != <span class="predefined-constant">null</span> ? <span class="string"><span class="delimiter">&quot;</span><span class="content"> node=</span><span class="delimiter">&quot;</span></span> + node.getBrowseName() : <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>)
        + (indexRange != <span class="predefined-constant">null</span> ? <span class="string"><span class="delimiter">&quot;</span><span class="content"> indexRange=</span><span class="delimiter">&quot;</span></span> + indexRange : <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>) + <span class="string"><span class="delimiter">&quot;</span><span class="content"> value=</span><span class="delimiter">&quot;</span></span> + dataValue);
    <span class="keyword">return</span> <span class="predefined-constant">false</span>;
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>UaValueNode</code> is a common interface shared between <code>UaVariable</code> and <code>UaVariableType</code>. The value Attribute can be read from both nodes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The example above is a bare-bones dummy implementation, but you can define your custom I/O operations in the respective methods, and for read calls, return the results by setting the value of the <code>dataValue</code> argument inside the methods.</p>
</div>
<div class="paragraph">
<p>Also, you can perform user-specific operations and return user-specific results (e.g. for <code>onGetUserAccessLevel()</code>) by using the <code>ServiceContext</code> parameter, which contains Session information including the UserIdentity of the session.</p>
</div>
<div class="paragraph">
<p>The method result in write operations indicates if the value was already written to the actual data source. If the operation completes asynchronously, and you do not know that it succeeded yet, you should return false. If the operations fail, you should throw a <code>StatusException</code>, as usual when you need to return an error to the client.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="events-alarms-and-conditions"><a class="anchor" href="#events-alarms-and-conditions"></a>7. Events, Alarms and Conditions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To add support for OPC UA events, you must use an event manager and use event objects to trigger the events.</p>
</div>
<div class="paragraph">
<p>The event manager actually handles commands related to standard event and condition management.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Conditions are special event types defined as subtypes of ConditionType. Condition Objects typically exist in the server address space whereas all other event types are merely just triggered from the server without any Object instances that would represent them.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To trigger events you must use the respective event nodes.</p>
</div>
<div class="sect2">
<h3 id="event-manager"><a class="anchor" href="#event-manager"></a>7.1. Event Manager</h3>
<div class="paragraph">
<p>The default event manager used by the <code>NodeManagerUaNode</code> is <code>EventManagerUaNode</code>. It handles client commands related to the condition methods, such as enable, disable, acknowledge, etc. See the OPC UA Specification Part 9 for a full description of the condition types and condition methods.</p>
</div>
<div class="sect3">
<h4 id="custom-event-manager"><a class="anchor" href="#custom-event-manager"></a>7.1.1. Custom Event Manager</h4>
<div class="paragraph">
<p>Alternatively, you can replace the event manager of any node manager with your custom version. This enables you to react to the creation, modification and removal of monitored items in client subscriptions.</p>
</div>
<div class="paragraph">
<p>The event manager is automatically attached to your node manager, if you create it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EventManagerUaNode myEventManager = <span class="keyword">new</span> MyEventManager(myNodeManager);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The implementation of a custom event manager is very similar to the implementation of an event manger listener, explained below.</p>
</div>
</div>
<div class="sect3">
<h4 id="event-manager-listener"><a class="anchor" href="#event-manager-listener"></a>7.1.2. Event Manager Listener</h4>
<div class="paragraph">
<p>Instead of creating your own event manager, where you react to client actions, you can define an event manager listener that implements the <code>EventManagerListener</code> interface. The event manager listener can be plugged into the event manager as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">myNodeManager.getEventManager().setListener(myEventManagerListener);</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>myEventManagerListener</code> is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
 * A sample implementation of an EventManagerListener.
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyEventManagerListener</span> <span class="directive">implements</span> EventManagerListener {

  <span class="comment">/**
   * Internal counter for UserEventId:s. Used from {@link #getNextUserEventId()}.
   */</span>
  <span class="directive">private</span> <span class="type">int</span> eventId = <span class="integer">0</span>;

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">boolean</span> onAcknowledge(ServiceContext serviceContext, AcknowledgeableConditionTypeNode condition,
      ByteString eventId, LocalizedText comment) <span class="directive">throws</span> StatusException {
    <span class="comment">// Handle acknowledge request to a condition event</span>
    println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Acknowledge: Condition=</span><span class="delimiter">&quot;</span></span> + condition + <span class="string"><span class="delimiter">&quot;</span><span class="content">; EventId=</span><span class="delimiter">&quot;</span></span> + eventId + <span class="string"><span class="delimiter">&quot;</span><span class="content">; Comment=</span><span class="delimiter">&quot;</span></span> + comment);
    <span class="comment">// If the acknowledged event is no longer active, return an error</span>
    <span class="keyword">if</span> (!eventId.equals(condition.getEventId())) {
      <span class="keyword">throw</span> <span class="keyword">new</span> StatusException(StatusCodes.Bad_EventIdUnknown);
    }
    <span class="keyword">if</span> (condition.isAcked()) {
      <span class="keyword">throw</span> <span class="keyword">new</span> StatusException(StatusCodes.Bad_ConditionBranchAlreadyAcked);
    }

    <span class="directive">final</span> DateTime now = DateTime.currentTime();
    condition.setAcked(<span class="predefined-constant">true</span>, now);
    <span class="directive">final</span> ByteString userEventId = getNextUserEventId();
    <span class="comment">// addComment triggers a new event</span>
    condition.addComment(eventId, comment, now, userEventId);
    <span class="keyword">return</span> <span class="predefined-constant">true</span>; <span class="comment">// Handled here</span>
    <span class="comment">// NOTE: If you do not handle acknowledge here, and return false,</span>
    <span class="comment">// the EventManager (or MethodManager) will call</span>
    <span class="comment">// condition.acknowledge, which performs the same actions as this</span>
    <span class="comment">// handler, except for setting Retain</span>
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">boolean</span> onAddComment(ServiceContext serviceContext, ConditionTypeNode condition, ByteString eventId,
      LocalizedText comment) <span class="directive">throws</span> StatusException {
    <span class="comment">// Handle add command request to a condition event</span>
    println(<span class="string"><span class="delimiter">&quot;</span><span class="content">AddComment: Condition=</span><span class="delimiter">&quot;</span></span> + condition + <span class="string"><span class="delimiter">&quot;</span><span class="content">; Event=</span><span class="delimiter">&quot;</span></span> + eventId + <span class="string"><span class="delimiter">&quot;</span><span class="content">; Comment=</span><span class="delimiter">&quot;</span></span> + comment);
    <span class="comment">// Only the current eventId can get comments</span>
    <span class="keyword">if</span> (!eventId.equals(condition.getEventId())) {
      <span class="keyword">throw</span> <span class="keyword">new</span> StatusException(StatusCodes.Bad_EventIdUnknown);
    }
    <span class="comment">// triggers a new event</span>
    <span class="directive">final</span> ByteString userEventId = getNextUserEventId();
    condition.addComment(eventId, comment, DateTime.currentTime(), userEventId);
    <span class="keyword">return</span> <span class="predefined-constant">true</span>; <span class="comment">// Handled here</span>
    <span class="comment">// NOTE: If you do not handle addComment here, and return false,</span>
    <span class="comment">// the EventManager (or MethodManager) will call</span>
    <span class="comment">// condition.addComment automatically</span>
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> onAfterCreateMonitoredEventItem(ServiceContext serviceContext, Subscription subscription,
      MonitoredEventItem item) {
    <span class="comment">//</span>
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> onAfterDeleteMonitoredEventItem(ServiceContext serviceContext, Subscription subscription,
      MonitoredEventItem item) {
    <span class="comment">//</span>
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> onAfterModifyMonitoredEventItem(ServiceContext serviceContext, Subscription subscription,
      MonitoredEventItem item) {
    <span class="comment">//</span>
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> onConditionRefresh(ServiceContext serviceContext, Subscription subscription) <span class="directive">throws</span> StatusException {
    <span class="comment">//</span>
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">boolean</span> onConfirm(ServiceContext serviceContext, AcknowledgeableConditionTypeNode condition,
      ByteString eventId, LocalizedText comment) <span class="directive">throws</span> StatusException {
    <span class="comment">// Handle confirm request to a condition event</span>
    println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Confirm: Condition=</span><span class="delimiter">&quot;</span></span> + condition + <span class="string"><span class="delimiter">&quot;</span><span class="content">; EventId=</span><span class="delimiter">&quot;</span></span> + eventId + <span class="string"><span class="delimiter">&quot;</span><span class="content">; Comment=</span><span class="delimiter">&quot;</span></span> + comment);
    <span class="comment">// If the confirmed event is no longer active, return an error</span>
    <span class="keyword">if</span> (!eventId.equals(condition.getEventId())) {
      <span class="keyword">throw</span> <span class="keyword">new</span> StatusException(StatusCodes.Bad_EventIdUnknown);
    }
    <span class="keyword">if</span> (condition.isConfirmed()) {
      <span class="keyword">throw</span> <span class="keyword">new</span> StatusException(StatusCodes.Bad_ConditionBranchAlreadyConfirmed);
    }
    <span class="keyword">if</span> (!condition.isAcked()) {
      <span class="keyword">throw</span> <span class="keyword">new</span> StatusException(<span class="string"><span class="delimiter">&quot;</span><span class="content">Condition can only be confirmed when it is acknowledged.</span><span class="delimiter">&quot;</span></span>,
          StatusCodes.Bad_InvalidState);
    }
    <span class="comment">// If the condition is no longer active, set retain to false, i.e.</span>
    <span class="comment">// remove it from the visible alarms</span>
    <span class="keyword">if</span> (!(condition <span class="keyword">instanceof</span> AlarmConditionTypeNode) || !((AlarmConditionTypeNode) condition).isActive()) {
      condition.setRetain(<span class="predefined-constant">false</span>);
    }

    <span class="directive">final</span> DateTime now = DateTime.currentTime();
    condition.setConfirmed(<span class="predefined-constant">true</span>, now);
    <span class="directive">final</span> ByteString userEventId = getNextUserEventId();
    <span class="comment">// addComment triggers a new event</span>
    condition.addComment(eventId, comment, now, userEventId);
    <span class="keyword">return</span> <span class="predefined-constant">true</span>; <span class="comment">// Handled here</span>
    <span class="comment">// NOTE: If you do not handle Confirm here, and return false,</span>
    <span class="comment">// the EventManager (or MethodManager) will call</span>
    <span class="comment">// condition.confirm, which performs the same actions as this</span>
    <span class="comment">// handler</span>
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> onCreateMonitoredEventItem(ServiceContext serviceContext, NodeId nodeId, EventFilter eventFilter,
      EventFilterResult filterResult) <span class="directive">throws</span> StatusException {
    <span class="comment">// Item created</span>
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> onDeleteMonitoredEventItem(ServiceContext serviceContext, Subscription subscription,
      MonitoredEventItem monitoredItem) {
    <span class="comment">// Stop monitoring the item?</span>
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">boolean</span> onDisable(ServiceContext serviceContext, ConditionTypeNode condition) <span class="directive">throws</span> StatusException {
    <span class="comment">// Handle disable request to a condition</span>
    println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Disable: Condition=</span><span class="delimiter">&quot;</span></span> + condition);
    <span class="keyword">if</span> (condition.isEnabled()) {
      DateTime now = DateTime.currentTime();
      <span class="comment">// Setting enabled to false, also sets retain to false</span>
      condition.setEnabled(<span class="predefined-constant">false</span>, now);
      <span class="comment">// notify the clients of the change</span>
      condition.triggerEvent(now, <span class="predefined-constant">null</span>, getNextUserEventId());
    }
    <span class="keyword">return</span> <span class="predefined-constant">true</span>; <span class="comment">// Handled here</span>
    <span class="comment">// NOTE: If you do not handle disable here, and return false,</span>
    <span class="comment">// the EventManager (or MethodManager) will request the</span>
    <span class="comment">// condition to handle the call, and it will unset the enabled</span>
    <span class="comment">// state, and triggers a new notification event, as here</span>
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">boolean</span> onEnable(ServiceContext serviceContext, ConditionTypeNode condition) <span class="directive">throws</span> StatusException {
    <span class="comment">// Handle enable request to a condition</span>
    println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Enable: Condition=</span><span class="delimiter">&quot;</span></span> + condition);
    <span class="keyword">if</span> (!condition.isEnabled()) {
      DateTime now = DateTime.currentTime();
      condition.setEnabled(<span class="predefined-constant">true</span>, now);
      <span class="comment">// You should evaluate the condition now, set Retain to true,</span>
      <span class="comment">// if necessary and in that case also call triggerEvent</span>
      <span class="comment">// condition.setRetain(true);</span>
      <span class="comment">// condition.triggerEvent(now, null, getNextUserEventId());</span>
    }
    <span class="keyword">return</span> <span class="predefined-constant">true</span>; <span class="comment">// Handled here</span>
    <span class="comment">// NOTE: If you do not handle enable here, and return false,</span>
    <span class="comment">// the EventManager (or MethodManager) will request the</span>
    <span class="comment">// condition to handle the call, and it will set the enabled</span>
    <span class="comment">// state.</span>

    <span class="comment">// You should however set the status of the condition yourself</span>
    <span class="comment">// and trigger a new event if necessary</span>
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> onModifyMonitoredEventItem(ServiceContext serviceContext, Subscription subscription,
      MonitoredEventItem monitoredItem, EventFilter eventFilter, EventFilterResult filterResult)
      <span class="directive">throws</span> StatusException {
    <span class="comment">// Modify event monitoring, when the client modifies a monitored</span>
    <span class="comment">// item</span>
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">boolean</span> onOneshotShelve(ServiceContext serviceContext, AlarmConditionTypeNode condition,
      ShelvedStateMachineTypeNode stateMachine) <span class="directive">throws</span> StatusException {
    <span class="keyword">return</span> <span class="predefined-constant">false</span>;
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">boolean</span> onTimedShelve(ServiceContext serviceContext, AlarmConditionTypeNode condition,
      ShelvedStateMachineTypeNode stateMachine, <span class="type">double</span> shelvingTime) <span class="directive">throws</span> StatusException {
    <span class="keyword">return</span> <span class="predefined-constant">false</span>;
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">boolean</span> onUnshelve(ServiceContext serviceContext, AlarmConditionTypeNode condition,
      ShelvedStateMachineTypeNode stateMachine) <span class="directive">throws</span> StatusException {
    <span class="keyword">return</span> <span class="predefined-constant">false</span>;
  }

  <span class="directive">private</span> <span class="type">void</span> println(<span class="predefined-type">String</span> string) {
    MyNodeManager.println(string);
  }

  ByteString getNextUserEventId() <span class="directive">throws</span> <span class="exception">RuntimeException</span> {
    <span class="keyword">return</span> EventManager.createEventId(eventId++);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, complete event management requires quite a complex implementation. However, you do not need to define your own implementation for all the functionality. Simply return <code>false</code> in the methods where you wish the event manager to use its default implementation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="defining-events-and-conditions"><a class="anchor" href="#defining-events-and-conditions"></a>7.2. Defining Events and Conditions</h3>
<div class="paragraph">
<p>To actually model events in the address space and trigger them, you can use the event types defined in the SDK.</p>
</div>
<div class="paragraph">
<p>There are two main types of events: normal events and conditions. Events are just notifications to the client applications, whereas conditions can also contain a state. Therefore, condition nodes are typically also available in the address space as nodes.</p>
</div>
<div class="sect3">
<h4 id="normal-events"><a class="anchor" href="#normal-events"></a>7.2.1. Normal Events</h4>
<div class="paragraph">
<p>To define a normal event, you can just create it on the fly. For example (see <code>MyNodeManager.sendEvent()</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MyEventType ev = createEvent(MyEventType.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>and define the field values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ev.setMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">MyEvent</span><span class="delimiter">&quot;</span></span>);
ev.setMyVariable(<span class="keyword">new</span> <span class="predefined-type">Random</span>().nextInt());
ev.setMyProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">Property Value </span><span class="delimiter">&quot;</span></span> + ev.getMyVariable());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can just trigger the event as described below in <a href="#triggering-events">Triggering Events</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="custom-event-types"><a class="anchor" href="#custom-event-types"></a>7.2.2. Custom Event Types</h4>
<div class="paragraph">
<p>If you wish to use custom fields in your events, you will need to define custom event types. The fields are defined as Properties or Variable components of the event type.</p>
</div>
<div class="paragraph">
<p>You have two alternative ways to define new event types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define the event types in an information model XML (with <a href="https://www.prosysopc.com/products/opc-ua-modeler/">OPC UA Modeler</a>) and use the Code Generator provided with the SDK (see chapter <a href="#codegen">Code Generation</a>).</p>
</li>
<li>
<p>Write the type yourself. Check <code>MyEventType</code> and <code>MyNodeManager.createMyEventType()</code> for the latter. However, using the Code Generator is typically the easier way. See chapter <a href="#codegen">Code Generation</a> for more about the code generation.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="conditions"><a class="anchor" href="#conditions"></a>7.2.3. Conditions</h4>
<div class="paragraph">
<p>For example, ExclusiveLevelAlarmType, which is a specific Condition type is used to initialize an alarm node as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">  <span class="comment">/**
   * Create a sample alarm node structure.
   *
   * @param source the variable that is the source of the alarm
   *
   * @throws StatusException if something goes wrong in the initialization
   * @throws UaInstantiationException if something goes wrong regarding object instantiation
   */</span>
  <span class="directive">private</span> <span class="type">void</span> createAlarmNode(UaVariable source) <span class="directive">throws</span> StatusException, UaInstantiationException {

    <span class="comment">// Level Alarm from the LevelMeasurement</span>

    <span class="comment">// See the Spec. Part 9. Appendix B.2 for a similar example</span>

    <span class="type">int</span> ns = <span class="local-variable">this</span>.getNamespaceIndex();
    <span class="directive">final</span> NodeId myAlarmId = <span class="keyword">new</span> NodeId(ns, source.getNodeId().getValue() + <span class="string"><span class="delimiter">&quot;</span><span class="content">.Alarm</span><span class="delimiter">&quot;</span></span>);
    <span class="predefined-type">String</span> name = source.getBrowseName().getName() + <span class="string"><span class="delimiter">&quot;</span><span class="content">Alarm</span><span class="delimiter">&quot;</span></span>;

    <span class="comment">// Since the HighHighLimit and others are Optional nodes,</span>
    <span class="comment">// we need to define them to be instantiated.</span>
    TypeDefinitionBasedNodeBuilderConfiguration.Builder conf = TypeDefinitionBasedNodeBuilderConfiguration.builder();
    conf.addOptional(UaBrowsePath.from(Ids.LimitAlarmType, UaQualifiedName.standard(<span class="string"><span class="delimiter">&quot;</span><span class="content">HighHighLimit</span><span class="delimiter">&quot;</span></span>)));
    conf.addOptional(UaBrowsePath.from(Ids.LimitAlarmType, UaQualifiedName.standard(<span class="string"><span class="delimiter">&quot;</span><span class="content">HighLimit</span><span class="delimiter">&quot;</span></span>)));
    conf.addOptional(UaBrowsePath.from(Ids.LimitAlarmType, UaQualifiedName.standard(<span class="string"><span class="delimiter">&quot;</span><span class="content">LowLimit</span><span class="delimiter">&quot;</span></span>)));
    conf.addOptional(UaBrowsePath.from(Ids.LimitAlarmType, UaQualifiedName.standard(<span class="string"><span class="delimiter">&quot;</span><span class="content">LowLowLimit</span><span class="delimiter">&quot;</span></span>)));

    <span class="comment">// The configuration must be set to be used</span>
    <span class="comment">// this.getNodeManagerTable().setNodeBuilderConfiguration(conf.build()); //global</span>
    <span class="comment">// this.setNodeBuilderConfiguration(conf.build()); //local to this NodeManager</span>
    <span class="comment">// createNodeBuilder(ExclusiveLevelAlarmTypeNode.class, conf.build()); //NodeBuilder specific</span>
    <span class="comment">// (createInstance uses this internally)</span>

    <span class="comment">// for purpose of this sample program, it is set to this manager, normally this would be set</span>
    <span class="comment">// once after creating this NodeManager</span>
    <span class="local-variable">this</span>.setNodeBuilderConfiguration(conf.build());

    myAlarm = createInstance(ExclusiveLevelAlarmTypeNode.class, name, myAlarmId);

    <span class="comment">// ConditionSource is the node which has this condition</span>
    myAlarm.setSource(source);
    <span class="comment">// Input is the node which has the measurement that generates the alarm</span>
    myAlarm.setInput(source);

    myAlarm.setMessage(<span class="keyword">new</span> LocalizedText(<span class="string"><span class="delimiter">&quot;</span><span class="content">Level exceeded</span><span class="delimiter">&quot;</span></span>));
    myAlarm.setSeverity(<span class="integer">500</span>); <span class="comment">// Medium level warning</span>
    myAlarm.setHighHighLimit(<span class="float">90.0</span>);
    myAlarm.setHighLimit(<span class="float">70.0</span>);
    myAlarm.setLowLimit(<span class="float">30.0</span>);
    myAlarm.setLowLowLimit(<span class="float">10.0</span>);
    myAlarm.setEnabled(<span class="predefined-constant">true</span>);
    myDevice.addComponent(myAlarm); <span class="comment">// addReference(...Identifiers.HasComponent...)</span>

    <span class="comment">// + HasCondition, the SourceNode of the reference should normally</span>
    <span class="comment">// correspond to the Source set above</span>
    source.addReference(myAlarm, Identifiers.HasCondition, <span class="predefined-constant">false</span>);

    <span class="comment">// + EventSource, the target of the EventSource is normally the</span>
    <span class="comment">// source of the HasCondition reference</span>
    myDevice.addReference(source, Identifiers.HasEventSource, <span class="predefined-constant">false</span>);

    <span class="comment">// + HasNotifier, these are used to link the source of the EventSource</span>
    <span class="comment">// up in the address space hierarchy</span>
    myObjectsFolder.addReference(myDevice, Identifiers.HasNotifier, <span class="predefined-constant">false</span>);
  }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="triggering-events"><a class="anchor" href="#triggering-events"></a>7.3. Triggering Events</h3>
<div class="sect3">
<h4 id="triggering-normal-events"><a class="anchor" href="#triggering-normal-events"></a>7.3.1. Triggering Normal Events</h4>
<div class="paragraph">
<p>You must monitor the events in your client application to get notified. When you want to send an event from the server, you can create a new instance and just trigger it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ev.triggerEvent(<span class="predefined-constant">null</span>);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="triggering-conditions"><a class="anchor" href="#triggering-conditions"></a>7.3.2. Triggering Conditions</h4>
<div class="paragraph">
<p>Triggering a condition (or alarm) is basically the same, once you have the event or condition object around and you have modified it&#8217;s state according to the current situation (see above). Then you can just trigger the event:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">  <span class="comment">/**
   * Send an event notification.
   *
   * @param event The event to trigger.
   */</span>
  <span class="directive">private</span> <span class="type">void</span> triggerEvent(BaseEventTypeNode event) {
    <span class="comment">// Trigger event</span>
    <span class="directive">final</span> DateTime now = DateTime.currentTime();
    <span class="comment">// Use your own EventId to keep track of your events, if you need to (for example when alarms</span>
    <span class="comment">// are acknowledged)</span>
    ByteString myEventId = getNextUserEventId();
    <span class="comment">// If you wish, you can record the full event ID that is provided by triggerEvent, although your</span>
    <span class="comment">// own 'myEventId' is usually enough to keep track of the event.</span>
    <span class="comment">/* ByteString fullEventId = */</span>event.triggerEvent(now, now, myEventId);
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>myEventId</code> is your own identifier for the event. On the other hand, <code>fullEventId</code> is generated by the SDK and is provided back to you. To extract your custom identifier from it, you can use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ByteString userEventId = EventManager.extractUserEventId(fullEventId);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="methods"><a class="anchor" href="#methods"></a>8. Methods</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is simplest to define the Methods for OPC UA Objects in an information model (using the <a href="https://www.prosysopc.com/products/opc-ua-modeler/">OPC UA Modeler</a> software) and then using it  as input for the Code Generator provided with the SDK (see chapter <a href="#codegen">Code Generation</a>). For implementing Methods when using the code generated types, see the section <a href="#implementing-methods-in-generated-types">Implementing Methods in Generated Types</a>.</p>
</div>
<div class="paragraph">
<p>Another option is to define the Methods manually in your application code. See <code>MyNodeManager.createMethodNode()</code> for an example of this.</p>
</div>
<div class="sect2">
<h3 id="handling-methods"><a class="anchor" href="#handling-methods"></a>8.1. Handling Methods</h3>
<div class="paragraph">
<p>If you define Method nodes manually in the code, you need to also handle the related Method calls by implementing a method manager or a method manager listener.</p>
</div>
<div class="paragraph">
<p>A method manager handles incoming Method calls from clients. It dispatches the calls to various locations and returns the result to the client. The implementation of a method manager should be based on the <code>MethodManager</code> class.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can also utilize a method manager listener that implements the <code>CallableListener</code> interface. The principle is similar to the use of a method manager and is demonstrated in the example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MethodManagerUaNode m = (MethodManagerUaNode) myNodeManager
        .getMethodManager();
m.addCallListener(myMethodManagerListener);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The listener is then implemented as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyMethodManagerListener</span> <span class="directive">implements</span> CallableListener {

        <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">Logger</span> logger = <span class="predefined-type">Logger</span>
                        .getLogger(MyMethodManagerListener.class);
        <span class="directive">final</span> <span class="directive">private</span> UaNode myMethod;
        <span class="comment">/**
         * @param myMethod
         *            the method node to handle.
         */</span>
        <span class="directive">public</span> MyMethodManagerListener(UaNode myMethod) {
                <span class="local-variable">super</span>();
                <span class="local-variable">this</span>.myMethod = myMethod;
        }
                <span class="annotation">@Override</span>
                <span class="directive">public</span> <span class="type">boolean</span> onCall(ServiceContext serviceContext, NodeId objectId,
                                UaNode object, NodeId methodId, UaMethod method,
                                <span class="directive">final</span> Variant<span class="type">[]</span> inputArguments,
                                <span class="directive">final</span> StatusCode<span class="type">[]</span> inputArgumentResults,
                                <span class="directive">final</span> DiagnosticInfo<span class="type">[]</span> inputArgumentDiagnosticInfos,
                                <span class="directive">final</span> Variant<span class="type">[]</span> outputs) <span class="directive">throws</span> StatusException {
                        <span class="comment">// Handle method calls</span>
                        <span class="comment">// Note that the outputs is already allocated</span>
                        <span class="keyword">if</span> (methodId.equals(myMethod.getNodeId())) {
                                logger.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">myMethod: </span><span class="delimiter">&quot;</span></span> + <span class="predefined-type">Arrays</span>.toString(inputArguments));
                                MethodManager.checkInputArguments(<span class="keyword">new</span> <span class="predefined-type">Class</span><span class="type">[]</span> { <span class="predefined-type">String</span>.class,
                                        <span class="predefined-type">Double</span>.class }, inputArguments, inputArgumentResults,
                                        inputArgumentDiagnosticInfos, <span class="predefined-constant">false</span>);
                                <span class="predefined-type">String</span> operation;
                                <span class="keyword">try</span> {
                                        operation = (<span class="predefined-type">String</span>) inputArguments[<span class="integer">0</span>].getValue();
                                } <span class="keyword">catch</span> (<span class="exception">ClassCastException</span> e) {
                                        <span class="keyword">throw</span> inputError(<span class="integer">0</span>, e.getMessage(),
                                                inputArgumentResults,
                                                inputArgumentDiagnosticInfos);
                                }
                                <span class="type">double</span> input;
                                <span class="keyword">try</span> {
                                        input = inputArguments[<span class="integer">1</span>].intValue();
                                } <span class="keyword">catch</span> (<span class="exception">ClassCastException</span> e) {
                                        <span class="keyword">throw</span> inputError(<span class="integer">1</span>, e.getMessage(),
                                                inputArgumentResults,
                                                inputArgumentDiagnosticInfos);
                                }
                                operation = operation.toLowerCase();
                                <span class="type">double</span> result;
                                <span class="keyword">if</span> (operation.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">sin</span><span class="delimiter">&quot;</span></span>))
                                        result = <span class="predefined-type">Math</span>.sin(<span class="predefined-type">Math</span>.toRadians(input));
                                <span class="keyword">else</span> <span class="keyword">if</span> (operation.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">cos</span><span class="delimiter">&quot;</span></span>))
                                        result = <span class="predefined-type">Math</span>.cos(<span class="predefined-type">Math</span>.toRadians(input));
                                <span class="keyword">else</span> <span class="keyword">if</span> (operation.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">tan</span><span class="delimiter">&quot;</span></span>))
                                        result = <span class="predefined-type">Math</span>.tan(<span class="predefined-type">Math</span>.toRadians(input));
                                <span class="keyword">else</span> <span class="keyword">if</span> (operation.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">pow</span><span class="delimiter">&quot;</span></span>))
                                        result = input * input;
                                <span class="keyword">else</span>
                                        <span class="keyword">throw</span> inputError(<span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Unknown function '</span><span class="delimiter">&quot;</span></span> + operation
                                                + <span class="string"><span class="delimiter">&quot;</span><span class="content">': valid functions are sin, cos, tan, pow</span><span class="delimiter">&quot;</span></span>,
                                                inputArgumentResults,
                                                inputArgumentDiagnosticInfos);
                                outputs[<span class="integer">0</span>] = <span class="keyword">new</span> Variant(result);
                                <span class="keyword">return</span> <span class="predefined-constant">true</span>; <span class="comment">// Handled here</span>
                        } <span class="keyword">else</span>
                                <span class="keyword">return</span> <span class="predefined-constant">false</span>;
                }
                <span class="comment">/**
                 * Handle an error in method inputs.
                 *
                 * @param index
                 *            index of the failing input
                 * @param message
                 *            error message
                 * @param inputArgumentResults
                 *            the results array to fill in
                 * @param inputArgumentDiagnosticInfos
                 *            the diagnostics array to fill in
                 * @return StatusException that can be thrown to break further method
                 *         handling
                 */</span>
                <span class="directive">private</span> StatusException inputError(<span class="directive">final</span> <span class="type">int</span> index,
                                <span class="directive">final</span> <span class="predefined-type">String</span> message, StatusCode<span class="type">[]</span> inputArgumentResults,
                                DiagnosticInfo<span class="type">[]</span> inputArgumentDiagnosticInfos) {
                        logger.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">inputError: #</span><span class="delimiter">&quot;</span></span> + index + <span class="string"><span class="delimiter">&quot;</span><span class="content"> message=</span><span class="delimiter">&quot;</span></span> + message);
                        inputArgumentResults[index] = <span class="keyword">new</span> StatusCode(
                                        StatusCodes.Bad_InvalidArgument);
                        <span class="directive">final</span> DiagnosticInfo di = <span class="keyword">new</span> DiagnosticInfo();
                        di.setAdditionalInfo(message);
                        inputArgumentDiagnosticInfos[index] = di;
                        <span class="keyword">return</span> <span class="keyword">new</span> StatusException(StatusCodes.Bad_InvalidArgument);
                }
        };</code></pre>
</div>
</div>
<div class="paragraph">
<p>This one will only handle one method. In practice you should be prepared to handle all your Methods here.</p>
</div>
<div class="paragraph">
<p>Instead of the centralised method listener implementation of the previous example, you can also implement the <code>UaCallable</code> interface in your node objects. The <code>MethodManagerUaNode</code> will then call their <code>callMethod()</code> if the listener does not handle the Method call.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="history-manager"><a class="anchor" href="#history-manager"></a>9. History Manager</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A history manager enables you to handle all historical data and event functionality. There is no default functionality for these in the SDK, so you must keep track of the historical data yourself and implement the services.</p>
</div>
<div class="paragraph">
<p>Again, you have two different options for implementing history management:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can define your own subclass of the <code>HistoryManager</code> class and override the methods that deal with the various history operations. And then just use <code>myNodeManager.getHistoryManager()</code> to set the history manager to your node manager.</p>
</li>
<li>
<p>You can simply define a new listener in which you define the functionality.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following is a sample historian implementation, which relies on memory-based <code>ValueHistory</code> and <code>EventHistory</code> objects that handle the history of each node that is added to the historian:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
 * A sample implementation of a data historian.
 * &lt;p&gt;
 * It is implemented as a HistoryManagerListener. It could as well be a
 * HistoryManager, instead.
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyHistorian</span> <span class="directive">implements</span> HistoryManagerListener {
        <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">Logger</span> logger = <span class="predefined-type">Logger</span>.getLogger(MyHistorian.class);
        <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">Map</span>&lt;UaObjectNode, EventHistory&gt; eventHistories =
<span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;UaObjectNode, EventHistory&gt;();
        <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">Map</span>&lt;UaVariableNode, ValueHistory&gt; variableHistories =
<span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;UaVariableNode, ValueHistory&gt;();

        <span class="directive">public</span> MyHistorian() {
                <span class="local-variable">super</span>();
        }

        <span class="comment">/**
         * Add the object to the historian for event history.
         * &lt;p&gt;
         * The historian will mark it to contain history (in EventNotifier
         * attribute) and it will start monitoring events for it.
         *
         * @param node
         *            the object to initialize
         */</span>
        <span class="directive">public</span> <span class="type">void</span> addEventHistory(UaObjectNode node) {
        EventHistory history = <span class="keyword">new</span> EventHistory(node);
        <span class="comment">// History can be read</span>
        <span class="predefined-type">EnumSet</span>&lt;EventNotifierClass&gt; eventNotifier = node.getEventNotifier();
        eventNotifier.add(EventNotifierClass.HistoryRead);
        node.setEventNotifier(eventNotifier);

        eventHistories.put(node, history);
        }

        <span class="comment">/**
         * Add the variable to the historian.
         * &lt;p&gt;
         * The historian will mark it to be historized and it will start monitoring
         * value changes for it.
         *
         * @param variable
         *            the variable to initialize
         */</span>
        <span class="directive">public</span> <span class="type">void</span> addVariableHistory(UaVariableNode variable) {
        ValueHistory history = <span class="keyword">new</span> ValueHistory(variable);
        <span class="comment">// History is being collected</span>
        variable.setHistorizing(<span class="predefined-constant">true</span>);
        <span class="comment">// History can be read</span>
        <span class="directive">final</span> <span class="predefined-type">EnumSet</span>&lt;AccessLevel&gt; READ_WRITE_HISTORYREAD = <span class="predefined-type">EnumSet</span>.of(
                AccessLevel.CurrentRead, AccessLevel.CurrentWrite,
                AccessLevel.HistoryRead);
        variable.setAccessLevel(READ_WRITE_HISTORYREAD);

        variableHistories.put(variable, history);
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">Object</span> onBeginHistoryRead(ServiceContext serviceContext,
                HistoryReadDetails details, TimestampsToReturn timestampsToReturn,
                HistoryReadValueId<span class="type">[]</span> nodesToRead,
                HistoryContinuationPoint<span class="type">[]</span> continuationPoints,
                HistoryResult<span class="type">[]</span> results) <span class="directive">throws</span> ServiceException {
                <span class="keyword">return</span> <span class="predefined-constant">null</span>;
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">Object</span> onBeginHistoryUpdate(ServiceContext serviceContext,
                HistoryUpdateDetails<span class="type">[]</span> details, HistoryUpdateResult<span class="type">[]</span> results,
                DiagnosticInfo<span class="type">[]</span> diagnosticInfos) <span class="directive">throws</span> ServiceException {
                <span class="keyword">return</span> <span class="predefined-constant">null</span>;
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> onDeleteAtTimes(ServiceContext serviceContext, <span class="predefined-type">Object</span> operationContext,
                NodeId nodeId, UaNode node, DateTime<span class="type">[]</span> reqTimes,
                StatusCode<span class="type">[]</span> operationResults, DiagnosticInfo<span class="type">[]</span> operationDiagnostics)
                <span class="directive">throws</span> StatusException {
                ValueHistory history = variableHistories.get(node);
        <span class="keyword">if</span> (history != <span class="predefined-constant">null</span>)
                history.deleteAtTimes(reqTimes, operationResults,
                        operationDiagnostics);
        <span class="keyword">else</span>
                <span class="keyword">throw</span> <span class="keyword">new</span> StatusException(StatusCodes.Bad_NoData);
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> onDeleteEvents(ServiceContext serviceContext,
<span class="predefined-type">Object</span> operationContext,
                NodeId nodeId, UaNode node, ByteString<span class="type">[]</span> eventIds,
                StatusCode<span class="type">[]</span> operationResults, DiagnosticInfo<span class="type">[]</span> operationDiagnostics)
                <span class="directive">throws</span> StatusException {
        EventHistory history = eventHistories.get(node);
        <span class="keyword">if</span> (history != <span class="predefined-constant">null</span>)
                history.deleteEvents(eventIds, operationResults,
                        operationDiagnostics);
        <span class="keyword">else</span>
                <span class="keyword">throw</span> <span class="keyword">new</span> StatusException(StatusCodes.Bad_NoData);
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> onDeleteModified(ServiceContext serviceContext,
<span class="predefined-type">Object</span> operationContext,
                NodeId nodeId, UaNode node, DateTime startTime, DateTime endTime)
                <span class="directive">throws</span> StatusException {
                <span class="keyword">throw</span> <span class="keyword">new</span> StatusException(
StatusCodes.Bad_HistoryOperationUnsupported);
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> onDeleteRaw(ServiceContext serviceContext,
<span class="predefined-type">Object</span> operationContext,
                NodeId nodeId, UaNode node, DateTime startTime, DateTime endTime)
                <span class="directive">throws</span> StatusException {
        ValueHistory history = variableHistories.get(node);
        <span class="keyword">if</span> (history != <span class="predefined-constant">null</span>)
                history.deleteRaw(startTime, endTime);
        <span class="keyword">else</span>
                <span class="keyword">throw</span> <span class="keyword">new</span> StatusException(StatusCodes.Bad_NoData);
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> onEndHistoryRead(ServiceContext serviceContext,
<span class="predefined-type">Object</span> operationContext,
                HistoryReadDetails details, TimestampsToReturn timestampsToReturn,
                HistoryReadValueId<span class="type">[]</span> nodesToRead,
                HistoryContinuationPoint<span class="type">[]</span> continuationPoints,
                HistoryResult<span class="type">[]</span> results) <span class="directive">throws</span> ServiceException {
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> onEndHistoryUpdate(ServiceContext serviceContext,
                <span class="predefined-type">Object</span> operationContext, HistoryUpdateDetails<span class="type">[]</span> details,
                HistoryUpdateResult<span class="type">[]</span> results, DiagnosticInfo<span class="type">[]</span> diagnosticInfos)
                <span class="directive">throws</span> ServiceException {
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">Object</span> onReadAtTimes(ServiceContext serviceContext,
<span class="predefined-type">Object</span> operationContext,
                TimestampsToReturn timestampsToReturn, NodeId nodeId, UaNode node,
                <span class="predefined-type">Object</span> continuationPoint, DateTime<span class="type">[]</span> reqTimes,
                NumericRange indexRange, HistoryData historyData)
                <span class="directive">throws</span> StatusException {
        ValueHistory history = variableHistories.get(node);
        <span class="keyword">if</span> (history != <span class="predefined-constant">null</span>)
                historyData.setDataValues(history.readAtTimes(reqTimes));
        <span class="keyword">else</span>
                <span class="keyword">throw</span> <span class="keyword">new</span> StatusException(StatusCodes.Bad_NoData);
        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">Object</span> onReadEvents(ServiceContext serviceContext,
<span class="predefined-type">Object</span> operationContext,
                NodeId nodeId, UaNode node, <span class="predefined-type">Object</span> continuationPoint,
                DateTime startTime, DateTime endTime,
                UnsignedInteger numValuesPerNode, EventFilter filter,
                HistoryEvent historyEvent) <span class="directive">throws</span> StatusException {
        EventHistory history = eventHistories.get(node);
        <span class="keyword">if</span> (history != <span class="predefined-constant">null</span>) {
                <span class="predefined-type">List</span>&lt;HistoryEventFieldList&gt; events =
<span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;HistoryEventFieldList&gt;();
                <span class="type">int</span> firstIndex = continuationPoint == <span class="predefined-constant">null</span> ? <span class="integer">0</span>
                        : (<span class="predefined-type">Integer</span>) continuationPoint;
                <span class="predefined-type">Integer</span> newContinuationPoint = history.readEvents(startTime,
                        endTime, numValuesPerNode.intValue(), filter, events,
                        firstIndex);
                historyEvent.setEvents(events
                        .toArray(<span class="keyword">new</span> HistoryEventFieldList[events.size()]));
                <span class="keyword">return</span> newContinuationPoint;
        } <span class="keyword">else</span>
                <span class="keyword">throw</span> <span class="keyword">new</span> StatusException(StatusCodes.Bad_NoData);
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">Object</span> onReadModified(ServiceContext serviceContext,
<span class="predefined-type">Object</span> operationContext,
                TimestampsToReturn timestampsToReturn, NodeId nodeId, UaNode node,
                <span class="predefined-type">Object</span> continuationPoint, DateTime startTime, DateTime endTime,
                UnsignedInteger numValuesPerNode, NumericRange indexRange,
                HistoryModifiedData historyData) <span class="directive">throws</span> StatusException {
                <span class="keyword">throw</span> <span class="keyword">new</span> StatusException(
StatusCodes.Bad_HistoryOperationUnsupported);
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">Object</span> onReadProcessed(ServiceContext serviceContext,
                <span class="predefined-type">Object</span> operationContext, TimestampsToReturn timestampsToReturn,
                NodeId nodeId, UaNode node, <span class="predefined-type">Object</span> continuationPoint,
                DateTime startTime, DateTime endTime, <span class="predefined-type">Double</span> resampleInterval,
                NodeId aggregateType,
                AggregateConfiguration aggregateConfiguration,
                NumericRange indexRange, HistoryData historyData)
                <span class="directive">throws</span> StatusException {
                <span class="keyword">throw</span> <span class="keyword">new</span> StatusException(
StatusCodes.Bad_HistoryOperationUnsupported);
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">Object</span> onReadRaw(ServiceContext serviceContext,
<span class="predefined-type">Object</span> operationContext,
                TimestampsToReturn timestampsToReturn, NodeId nodeId, UaNode node,
                <span class="predefined-type">Object</span> continuationPoint, DateTime startTime, DateTime endTime,
                UnsignedInteger numValuesPerNode, <span class="predefined-type">Boolean</span> returnBounds,
                NumericRange indexRange, HistoryData historyData)
                <span class="directive">throws</span> StatusException {
        ValueHistory history = variableHistories.get(node);
        <span class="keyword">if</span> (history != <span class="predefined-constant">null</span>) {
                <span class="predefined-type">List</span>&lt;DataValue&gt; values = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;DataValue&gt;();
                <span class="type">int</span> firstIndex = continuationPoint == <span class="predefined-constant">null</span> ? <span class="integer">0</span>
                        : (<span class="predefined-type">Integer</span>) continuationPoint;
<span class="predefined-type">Integer</span> newContinuationPoint = history.readRaw(startTime, endTime, numValuesPerNode.intValue(), returnBounds, firstIndex,        values);
                historyData.setDataValues(values.toArray(<span class="keyword">new</span> DataValue[values
                        .size()]));
                <span class="keyword">return</span> newContinuationPoint;
        }
        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> onUpdateData(ServiceContext serviceContext,
<span class="predefined-type">Object</span> operationContext,
                NodeId nodeId, UaNode node, DataValue<span class="type">[]</span> updateValues,
                PerformUpdateType performInsertReplace,
                StatusCode<span class="type">[]</span> operationResults, DiagnosticInfo<span class="type">[]</span> operationDiagnostics)
                <span class="directive">throws</span> StatusException {
                <span class="keyword">throw</span> <span class="keyword">new</span> StatusException(
StatusCodes.Bad_HistoryOperationUnsupported);

}

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> onUpdateEvent(ServiceContext serviceContext,
 <span class="predefined-type">Object</span> operationContext,
                NodeId nodeId, UaNode node, Variant<span class="type">[]</span> eventFields,
                EventFilter filter, PerformUpdateType performInsertReplace,
                StatusCode<span class="type">[]</span> operationResults, DiagnosticInfo<span class="type">[]</span> operationDiagnostics)
                <span class="directive">throws</span> StatusException {
                <span class="keyword">throw</span> <span class="keyword">new</span> StatusException(
StatusCodes.Bad_HistoryOperationUnsupported);
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> onUpdateStructureData(ServiceContext serviceContext,
                <span class="predefined-type">Object</span> operationContext, NodeId nodeId, UaNode node,
                DataValue<span class="type">[]</span> updateValues, PerformUpdateType performUpdateType,
                StatusCode<span class="type">[]</span> operationResults, DiagnosticInfo<span class="type">[]</span> operationDiagnostics)
                <span class="directive">throws</span> StatusException {
                <span class="keyword">throw</span> <span class="keyword">new</span> StatusException(
StatusCodes.Bad_HistoryOperationUnsupported);
}
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>Go and look up the implementations for <code>ValueHistory</code> and <code>EventHistory</code> from the sample code to find out the actual algorithms. As you see, the Modified data and updates are not implemented yet, either. This implementation also requires the use of <code>UaNode</code> objects.</p>
</div>
<div class="paragraph">
<p>You must then add the listener to the history manager of your node manager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">myNodeManager.getHistoryManager().setListener(myHistoryManagerListener);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="start-up"><a class="anchor" href="#start-up"></a>10. Start Up</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once you have initialized your server, you simply need to start it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">server.start();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="shutdown"><a class="anchor" href="#shutdown"></a>11. Shutdown</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once you are ready to close the server, call <code>shutdown()</code> to notify the clients before the server actually closes down:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">server.shutdown(<span class="integer">5</span>, <span class="keyword">new</span> LocalizedText(<span class="string"><span class="delimiter">&quot;</span><span class="content">Closed by user</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Locale</span>.ENGLISH));</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The first argument for the method defines the delay (in seconds) until the server shuts down after notifying the clients. The second argument defines the reason for the shutdown.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mybignodemanager"><a class="anchor" href="#mybignodemanager"></a>12. MyBigNodeManager</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>UaNode</code>-based approach to the implementation of an OPC UA server is very good as long as you do not need to manage a huge number of data nodes. Also, if your data is already in an existing subsystem, it may not feel very reasonable to replicate it all using the <code>UaNodes</code>. In this case, you can implement a custom node manager (and other managers) which handles the service requests from the OPC UA clients and provides the requested data. Prosys OPC UA SDK for Java enables this by allowing you to override the necessary methods in the managers with your own code.</p>
</div>
<div class="paragraph">
<p>The <code>SampleConsoleServer</code> includes a sample of such a custom node manager that demonstrates the basic capabilities. We will go through the necessary aspects of this quite comprehensive example in this chapter, trying to explain the steps you need to take with your own implementations.</p>
</div>
<div class="sect2">
<h3 id="your-node-manager"><a class="anchor" href="#your-node-manager"></a>12.1. Your Node Manager</h3>
<div class="paragraph">
<p>You start by creating a new class which inherits from <code>NodeManager</code>. You will need a constructor that prepares your node manager and also a connection to your actual underlying data. Our sample is constructed like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> MyBigNodeManager(UaServer server, <span class="predefined-type">String</span> namespaceUri, <span class="type">int</span> nofItems) {
        <span class="local-variable">super</span>(server, namespaceUri);
        DataItemType = <span class="keyword">new</span> ExpandedNodeId(<span class="predefined-constant">null</span>, getNamespaceIndex(),
                <span class="string"><span class="delimiter">&quot;</span><span class="content">DataItemType</span><span class="delimiter">&quot;</span></span>);
        DataItemFolder = <span class="keyword">new</span> ExpandedNodeId(<span class="predefined-constant">null</span>, getNamespaceIndex(),
                <span class="string"><span class="delimiter">&quot;</span><span class="content">MyBigNodeManager</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">try</span> {
                getNodeManagerTable()
                        .getNodeManagerRoot()
                        .getObjectsFolder()
                        .addReference(getNamespaceTable().toNodeId(DataItemFolder),
                                Identifiers.Organizes, <span class="predefined-constant">false</span>);
        } <span class="keyword">catch</span> (ServiceResultException e) {
                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>(e);
        }
        dataItems = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;<span class="predefined-type">String</span>, MyBigNodeManager.DataItem&gt;(nofItems);
        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; nofItems; i++)
                addDataItem(<span class="predefined-type">String</span>.format(<span class="string"><span class="delimiter">&quot;</span><span class="content">DataItem_%04d</span><span class="delimiter">&quot;</span></span>, i));

        myBigIoManager = <span class="keyword">new</span> MyBigIoManager(<span class="local-variable">this</span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It takes the <code>server</code> and <code>namespaceUri</code> as parameters like all node managers do. In addition, we have a parameter for defining how many data items we initialize in our sample class.</p>
</div>
<div class="paragraph">
<p>After that, we prepare the nodes that we use by just defining the NodeIds for these. Except for the data, we also define lightweight DataItem objects. You must figure out the best way to map your data to the server with some custom DataItem objects.</p>
</div>
</div>
<div class="sect2">
<h3 id="browse-support"><a class="anchor" href="#browse-support"></a>12.2. Browse Support</h3>
<div class="paragraph">
<p>To support the OPC UA Browse service, you must implement a few abstract methods. <code>NodeManager</code> includes a default implementation for the service, which just requires you to provide the necessary information from your system. The necessary methods are</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">protected</span> <span class="directive">abstract</span> QualifiedName getBrowseName(ExpandedNodeId nodeId, <span class="directive">final</span> UaNode node);
<span class="directive">protected</span> <span class="directive">abstract</span> LocalizedText getDisplayName(ExpandedNodeId nodeId, UaNode targetNode, <span class="predefined-type">Locale</span> locale);
<span class="directive">protected</span> <span class="directive">abstract</span> NodeClass getNodeClass(ExpandedNodeId nodeId, UaNode node);
<span class="directive">protected</span> <span class="directive">abstract</span> UaReference<span class="type">[]</span> getReferences(NodeId nodeId, UaNode node);
<span class="directive">protected</span> <span class="directive">abstract</span> ExpandedNodeId getTypeDefinition(ExpandedNodeId nodeId, UaNode node);</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>getReference()</code> is the key method: for every node in your address space, you must define the OPC UA References it has. And remember, the References are typically bidirectional: in every child node there is also an inverse Reference to the parent, for example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">protected</span> UaReference<span class="type">[]</span> getReferences(NodeId nodeId, UaNode node) {
        <span class="keyword">try</span> {
                <span class="comment">// Define reference to our type</span>
                <span class="keyword">if</span> (nodeId.equals(getNamespaceTable().toNodeId(DataItemType)))
                        <span class="keyword">return</span> <span class="keyword">new</span> UaReference<span class="type">[]</span> { <span class="keyword">new</span> MyReference(<span class="keyword">new</span> ExpandedNodeId(
                                Identifiers.BaseDataVariableType), DataItemType,
                                Identifiers.HasSubtype) };
                <span class="comment">// Define reference from and to our Folder for the DataItems</span>
                <span class="keyword">if</span> (nodeId.equals(getNamespaceTable().toNodeId(DataItemFolder))) {
                        UaReference<span class="type">[]</span> folderItems = <span class="keyword">new</span> UaReference[dataItems.size() + <span class="integer">2</span>];
                        <span class="comment">// Inverse reference to the ObjectsFolder</span>
                        folderItems[<span class="integer">0</span>] = <span class="keyword">new</span> MyReference(<span class="keyword">new</span> ExpandedNodeId(
                                Identifiers.ObjectsFolder), DataItemFolder,
                                Identifiers.Organizes);
                        <span class="comment">// Type definition reference</span>
                        folderItems[<span class="integer">1</span>] = <span class="keyword">new</span> MyReference(DataItemFolder,
                                getTypeDefinition(
                                        getNamespaceTable().toExpandedNodeId(nodeId),
                                        node), Identifiers.HasTypeDefinition);
                <span class="type">int</span> i = <span class="integer">2</span>;
        <span class="comment">// Reference to all items in the folder</span>
                <span class="keyword">for</span> (DataItem d : dataItems.values()) {
                        folderItems[i] = <span class="keyword">new</span> MyReference(DataItemFolder,
                                <span class="keyword">new</span> ExpandedNodeId(<span class="predefined-constant">null</span>, getNamespaceIndex(),
                                        d.getName()), Identifiers.HasComponent);
                        i++;
                }
                <span class="keyword">return</span> folderItems;
                }
        } <span class="keyword">catch</span> (ServiceResultException e) {
                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>(e);
        }

        <span class="comment">// Define references from our DataItems</span>
        DataItem dataItem = getDataItem(nodeId);
        <span class="keyword">if</span> (dataItem == <span class="predefined-constant">null</span>)
                <span class="keyword">return</span> <span class="predefined-constant">null</span>;
        <span class="directive">final</span> ExpandedNodeId dataItemId = <span class="keyword">new</span> ExpandedNodeId(<span class="predefined-constant">null</span>,
                getNamespaceIndex(), dataItem.getName());
        <span class="keyword">return</span> <span class="keyword">new</span> UaReference<span class="type">[]</span> {
                <span class="keyword">new</span> MyReference(DataItemFolder, dataItemId,
                        Identifiers.HasComponent),
                <span class="keyword">new</span> MyReference(dataItemId, DataItemType,
                        Identifiers.HasTypeDefinition) };
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The References are defined using an implementation of the <code>UaReference</code> interface. The custom implementation is called <code>MyReference</code>. In principle, for a given Reference it must define the ExpandedNodeId for the source node (<code>sourceId</code>) and the ExpandedNodeId for the target node (<code>targetId</code>). The direction of the reference is always from the source to the target. If you include References for which “this node” is the Target, you are in practice defining an inverse reference.
The rest of the methods are rather straightforward, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">protected</span> NodeClass getNodeClass(ExpandedNodeId nodeId, UaNode node) {
        <span class="keyword">if</span> (getNamespaceTable().nodeIdEquals(nodeId, DataItemType))
                <span class="keyword">return</span> NodeClass.VariableType;
        <span class="keyword">if</span> (getNamespaceTable().nodeIdEquals(nodeId, DataItemFolder))
                <span class="keyword">return</span> NodeClass.Object;
        <span class="comment">// All data items are variables</span>
        <span class="keyword">return</span> NodeClass.Variable;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="nodeid-expandednodeid"><a class="anchor" href="#nodeid-expandednodeid"></a>12.3. NodeId &amp; ExpandedNodeId</h3>
<div class="paragraph">
<p>As you can see, all the methods take <code>nodeId</code> and <code>node</code> as arguments. The latter is always null in our case, since we are not supporting <code>UaNode</code>s in this implementation. So everything we do must be based on <code>nodeId</code>s – either of type <code>NodeId</code> or <code>ExpandedNodeId</code>. These are typically intercompatible, but you must be sure which one you are using and also note that the <code>ExpandedNodeId</code> has two flavors in practice. It can be defined using a NamespaceIndex or a NamespaceUri.</p>
</div>
<div class="paragraph">
<p>Due to these reasons checking for equality between a <code>NodeId</code> and an <code>ExpandedNodeId</code> is not always that simple: if you use <code>NodeId.equals()</code> with an <code>ExpandedNodeId</code> or <code>ExpandedNodeId.equals()</code> with either, you easily get unwanted results. The best option is to compare them with <code>getNamespaceTable().nodeIdEquals()</code>, which can check against `both the NamespaceIndex and the NamespaceUri.</p>
</div>
<div class="paragraph">
<p>You can convert between <code>NodeId</code> and <code>ExpandedNodeId</code> best with <code>getNamespaceTable().toNodeId()</code> and <code>getNamespaceTable().toExpandedNodeId()</code>.</p>
</div>
<div class="paragraph">
<p>In practice, it is best to define <code>ExpandedNodeId</code> objects with NamespaceIndices instead of NamespaceUris to keep them better compatible with the NodeIds inside your node manager.</p>
</div>
</div>
<div class="sect2">
<h3 id="mybigiomanager"><a class="anchor" href="#mybigiomanager"></a>12.4. MyBigIoManager</h3>
<div class="paragraph">
<p>Next you need to define the I/O manager which handles the Attribute services, i.e. Read and Write calls to nodes. You can start by defining a class that extends the <code>IoManager</code> class. You can then either override the <code>readAttribute()</code> and <code>writeAttribute()</code> methods or the <code>readValue()</code> and <code>readNonValue()</code> as well as the <code>writeValue()</code> and <code>writeNonValue()</code> methods. Our sample defines the <code>MyBigIoManager</code> class, which overrides <code>readValue()</code> and <code>readNonValue()</code> only – it does not support writing.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The difference between the Value versus the other OPC UA Attributes is mainly that the Value typically also has a StatusCode and a SourceTimestamp related to it. The other Attributes just have the actual value of the Attribute. Nevertheless, all read and write methods use <code>DataValue</code> structures to carry the complete values.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In our case, <code>readValue()</code> is simple, because we know that it’s only available for our DataItems (which are Variables):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">protected</span> <span class="type">void</span> readValue(ServiceContext serviceContext, NodeId nodeId,
                UaVariable node, NumericRange indexRange,
                TimestampsToReturn timestampsToReturn, DateTime minTimestamp,
                DataValue dataValue) <span class="directive">throws</span> StatusException {
        DataItem dataItem = getDataItem(nodeId);
        <span class="keyword">if</span> (dataItem == <span class="predefined-constant">null</span>)
                <span class="keyword">throw</span> <span class="keyword">new</span> StatusException(StatusCodes.Bad_NodeIdInvalid);
        dataItem.getDataValue(dataValue);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Implementation of the <code>readNonValue()</code> method is a bit more complicated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">                <span class="annotation">@Override</span>
                <span class="directive">protected</span> <span class="type">void</span> readNonValue(ServiceContext serviceContext,
                                NodeId nodeId, UaNode node, UnsignedInteger attributeId,
                                DataValue dataValue) <span class="directive">throws</span> StatusException {
                        <span class="predefined-type">Object</span> value = <span class="predefined-constant">null</span>;
                        UnsignedInteger status = StatusCodes.Bad_AttributeIdInvalid;
                        DataItem dataItem = getDataItem(nodeId);
                        <span class="directive">final</span> ExpandedNodeId expandedNodeId = getNamespaceTable()
                                        .toExpandedNodeId(nodeId);
                        <span class="keyword">if</span> (attributeId.equals(<span class="predefined-type">Attributes</span>.NodeId))
                                value = nodeId;
                        <span class="keyword">else</span> <span class="keyword">if</span> (attributeId.equals(<span class="predefined-type">Attributes</span>.BrowseName))
                                value = getBrowseName(expandedNodeId, node);
                        <span class="keyword">else</span> <span class="keyword">if</span> (attributeId.equals(<span class="predefined-type">Attributes</span>.DisplayName))
                                value = getDisplayName(expandedNodeId, node, <span class="predefined-constant">null</span>);
                        <span class="keyword">else</span> <span class="keyword">if</span> (attributeId.equals(<span class="predefined-type">Attributes</span>.Description))
                                status = StatusCodes.Bad_OutOfService;
                        <span class="keyword">else</span> <span class="keyword">if</span> (attributeId.equals(<span class="predefined-type">Attributes</span>.NodeClass))
                                value = getNodeClass(expandedNodeId, node);
                        <span class="keyword">else</span> <span class="keyword">if</span> (attributeId.equals(<span class="predefined-type">Attributes</span>.WriteMask))
                                value = UnsignedInteger.ZERO;
                        <span class="comment">// the following are only requested for the DataItems</span>
                        <span class="keyword">else</span> <span class="keyword">if</span> (dataItem != <span class="predefined-constant">null</span>) {
                                <span class="keyword">if</span> (attributeId.equals(<span class="predefined-type">Attributes</span>.DataType))
                                        value = Identifiers.Double;
                                <span class="keyword">else</span> <span class="keyword">if</span> (attributeId.equals(<span class="predefined-type">Attributes</span>.ValueRank))
                                        value = ValueRanks.Scalar;
                                <span class="keyword">else</span> <span class="keyword">if</span> (attributeId.equals(<span class="predefined-type">Attributes</span>.ArrayDimensions))
                                        status = StatusCodes.Bad_OutOfService;
                                <span class="keyword">else</span> <span class="keyword">if</span> (attributeId.equals(<span class="predefined-type">Attributes</span>.AccessLevel))
                                        value = AccessLevel.getMask(AccessLevel.READONLY);
                                <span class="keyword">else</span> <span class="keyword">if</span> (attributeId.equals(<span class="predefined-type">Attributes</span>.Historizing))
                                        value = <span class="predefined-constant">false</span>;
                        }
                        <span class="comment">// and this is only requested for the folder</span>
                        <span class="keyword">else</span> <span class="keyword">if</span> (attributeId.equals(<span class="predefined-type">Attributes</span>.EventNotifier))
                                value = EventNotifierClass.getMask(EventNotifierClass.NONE);
                        <span class="keyword">if</span> (value == <span class="predefined-constant">null</span>)
                                dataValue.setStatusCode(status);
                        <span class="keyword">else</span>
                                dataValue.setValue(<span class="keyword">new</span> Variant(value));
                        dataValue.setServerTimestamp(DateTime.currentTime());
                }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since many of the Attributes can also be accessed using the Browse service, we can simply utilize the existing methods from our node manager to provide the responses. And since we do not support writing, all nodes can be treated the same: WriteMask = 0 for all, for example.</p>
</div>
</div>
<div class="sect2">
<h3 id="subscriptions-and-monitoreddataitems"><a class="anchor" href="#subscriptions-and-monitoreddataitems"></a>12.5. Subscriptions and MonitoredDataItems</h3>
<div class="paragraph">
<p>The last part in defining a complete data access server is providing data change notifications to the clients.  This requires that you manage the MonitoredItems yourself and call <code>notifyDataChange()</code> for them. It will check the value against the deadband, filter and DataChangeTrigger of the item to see if the client really wants to see that change. The sample node manager <code>MyBigNodeManager</code> overrides <code>afterCreateMonitoredDataItem()</code> and <code>deleteMonitoredItem()</code> to keep track of which DataItems are being monitored. And whenever the values are changed (by <code>simulate()</code>), the clients are also notified:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="type">void</span> notifyMonitoredDataItems(DataItem dataItem) {
        <span class="comment">// Get the list of items watching dataItem</span>
        <span class="predefined-type">Collection</span>&lt;MonitoredDataItem&gt; c = monitoredItems
                .get(dataItem.getName());
        <span class="keyword">if</span> (c != <span class="predefined-constant">null</span>)
                <span class="keyword">for</span> (MonitoredDataItem item : c) {
                        DataValue dataValue = <span class="keyword">new</span> DataValue();
                        dataItem.getDataValue(dataValue);
                        item.notifyDataChange(dataValue);
                }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="monitoredeventitems"><a class="anchor" href="#monitoredeventitems"></a>12.6. MonitoredEventItems</h3>
<div class="paragraph">
<p>Events are monitored via MonitoredEventItems. In principle, the system is equal to monitoring the DataItems, but you must track the item creations with <code>afterCreateMonitoredEventItem()</code> (in a node manager or an event manager). And when you are ready to trigger an event, you must call <code>MonitoredEventItem.notifyEvent()</code> to send it to the client. For <code>notifyEvent()</code> you will need an <code>EventData</code> structure, which defines the values of all condition fields. You should refer to the OPC Foundation specification for that or take a look at the respective node implementations in the SDK.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="information-modeling"><a class="anchor" href="#information-modeling"></a>13. Information Modeling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To utilize the information modeling capabilities of OPC UA in your applications, you have to first create an information model. The SDK supports loading information models in the NodeSet2 XML format.
The best tool for creating the models is the <a href="https://www.prosysopc.com/products/opc-ua-modeler/">OPC UA Modeler</a>. You will need to purchase a license for it in order to generate the XML files needed for the Java Code Generator.</p>
</div>
<div class="sect2">
<h3 id="loading-information-models"><a class="anchor" href="#loading-information-models"></a>13.1. Loading Information Models</h3>
<div class="paragraph">
<p>You can load an information model (for example “SampleTypes.xml”) to the server with</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">server.getAddressSpace().loadModel(<span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">SampleTypes.xml</span><span class="delimiter">&quot;</span></span>).toURI());</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will add all types and instances defined in the XML file to the address space.</p>
</div>
<div class="paragraph">
<p>The SDK ships with the standard OPC UA information model, which is always initialized into the <code>NodeManagerRoot</code>. See <code>SampleConsoleServer.loadInformationModels()</code> for examples on loading the companion specifications.</p>
</div>
</div>
<div class="sect2">
<h3 id="codegen"><a class="anchor" href="#codegen"></a>13.2. Code Generation</h3>
<div class="paragraph">
<p>In addition to just loading the types and instances from an XML, you may wish to use the types in your Java applications. For this purpose, you can generate Java classes according to the type definitions.</p>
</div>
<div class="sect3">
<h4 id="prosys-opc-ua-sdk-for-java-code-generator"><a class="anchor" href="#prosys-opc-ua-sdk-for-java-code-generator"></a>13.2.1. Prosys OPC UA SDK for Java Code Generator</h4>
<div class="paragraph">
<p>You can generate Java classes based on information models stored in the NodeSet2 XML format with the help of the Code Generator provided with the Prosys OPC UA SDK for Java. The Code Generator is located in the 'codegen' folder of the distribution package.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>For instructions on using the Code Generator provided with the Prosys OPC UA SDK for Java, please refer to the dedicated code generation manual in the 'codegen' folder of the distribution package.</strong></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Follow the instructions in the included manual and experiment with the samples to learn how to configure and execute the code generation procedure. Then you may return to this tutorial and read the following sections on how to utilize the generated classes in your own applications.</p>
</div>
</div>
<div class="sect3">
<h4 id="registering-the-model"><a class="anchor" href="#registering-the-model"></a>13.2.2. Registering the Model</h4>
<div class="paragraph">
<p>The generated Java classes for ObjectTypes and VariableTypes are more extended versions of the standard <code>UaNode</code> implementations. In order for the SDK to use the generated classes instead of the basic implementations, the SDK must be made aware of the generated classes. This is called registering the model.</p>
</div>
</div>
<div class="sect3">
<h4 id="loading-the-model"><a class="anchor" href="#loading-the-model"></a>13.2.3. Loading the Model</h4>
<div class="paragraph">
<p>In addition to registering the Java classes to be used on the server side, the type Nodes in the information model need to be loaded to the address space of the server. The SDK reads these nodes from the address space when instantiating a type. It should be noted that the registration of the model must be done before loading the model. Otherwise, the SDK will use the default implementation for the nodes instead of the generated ones.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you load the model first and register only after that, you will get <code>ClassCastException</code>s. The SDK does not check for registration, since it also works without the generated classes by using the default implementations of the nodes.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="using-instances-of-generated-types"><a class="anchor" href="#using-instances-of-generated-types"></a>13.2.4. Using Instances of Generated Types</h4>
<div class="paragraph">
<p>The server implementation classes are generated in 'server' sub-packages under the defined generation folders.</p>
</div>
<div class="paragraph">
<p>If your information models contain any methods, you will need to implement these as well in the implementation nodes. Check your generated source (refresh the project in Eclipse first, for example) and see if it gives any errors for these.</p>
</div>
<div class="paragraph">
<p>To use the nodes then in your applications:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add the generation target directories to your project source path.</p>
</li>
<li>
<p>Register generated classes with <code>UaServer.registerModel(CodegenModel model)</code>. You can use the generated server-side InformationModel class
for the registration, for example <code>server.registerModel(example.packagename.server.ServerInformationModel.MODEL)</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Starting from 4.0.0, you can ignore this, if you have generated support for Automatic Discovery of Generated Models in Code Generator. Please see the Codegen Manual for more information.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Load the information model NodeSet2 XML with <code>server.getAddressSpace().loadModel(URI path)</code>.</p>
</li>
<li>
<p>Create instances with <code>NodeManagerUaNode.createInstance(Class class, String name)</code>.</p>
</li>
<li>
<p>Write method implementations. If your types define methods, the generated implementations will throw a <code>Bad_NotImplemented</code> StatusException
by default. You must write the actual implementation to the generated implementation ('impl') classes or write an implementation for the method interface and register it to the generated base class.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The SDK distribution package provides a sample information model in the 'SampleTypes.xml' file inside the 'models' folders of both of the the Code Generator versions (i.e. command line and Maven). The classes generated based on this model are used in the following examples. A complete example of the procedure for creating an instance of the ValveObjectType from the 'SampleTypes.xml' information model is also demonstrated in the example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// 1. Register the generated classes in your UaServer object by</span>
<span class="comment">// using the ServerInformationModel class that is generated in the server package.</span>
server.registerModel(example.packagename.server.ServerInformationModel.MODEL);

<span class="comment">// 2. Load the type nodes from the SampleTypes.xml file.</span>
server.getAddressSpace().loadModel(
        <span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">SampleTypes.xml</span><span class="delimiter">&quot;</span></span>).toURI());

<span class="comment">// 3. Now you can create an instance of ValveObjectType by using the NodeManagerUaNode:</span>
ValveObjectType sampleValve =
  manager.createInstance(ValveObjectTypeNode.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">SampleValve</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// 4. Use the instance.</span>
<span class="comment">// e.g., set the value of the PowerInput Property.</span>
sampleValve.setPowerInput(<span class="float">160.5</span>);</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>See also section <a href="#instances">Instances</a> for examples on how to create instances with optional nodes.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="implementing-methods-in-generated-types"><a class="anchor" href="#implementing-methods-in-generated-types"></a>13.2.5. Implementing Methods in Generated Types</h4>
<div class="paragraph">
<p>There are two different approaches to implementing the OPC UA Method functionality into the classes generated by the Code Generator:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Writing method handlers inside the generated classes</p>
</li>
<li>
<p>Providing outside implementations through static methods</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For the first option, the Code Generator creates a method handler for each OPC UA Method in an Object in the generated implementation class. You need to find the method handler and write your own implementation in there.</p>
</div>
<div class="paragraph">
<p>An example of a method handler is presented from the <code>ValveObjectTypeNode</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">  <span class="annotation">@Override</span>
  <span class="directive">protected</span> <span class="type">void</span> onChangeState(ServiceContext serviceContext, ValveStateDataType newState) <span class="directive">throws</span>
      StatusException {
    <span class="comment">//Implement the generated method here (and remove the code below) OR set implementation via static method setChangeStateMethodImplementation</span>
    <span class="keyword">throw</span> <span class="keyword">new</span> StatusException(StatusCodes.Bad_NotImplemented);
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the second option, the Code Generator also provides a static method in the generated base classes that allows for setting the implementation for an OPC UA Method. For example, <code>setChangeStateMethodImplementation()</code> in the base class <code>ValveObjectTypeNodeBase</code> can be used to provide an implementation for the same Method as in the previous example. The provided implementation must implement the generated interface for the Method, such as <code>ValveObjectTypeChangeStateMethod</code> for the example Method.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="reverse-connections"><a class="anchor" href="#reverse-connections"></a>14. Reverse Connections</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OPC UA Specification 1.04 defines a new way to open UA TCP connections, called Reverse Connection. In this mode, the server application will open the connection, contrary to the normal connection opened by the client. This can be useful in situations where the server is behind a firewall that cannot let client connections go through to the server.</p>
</div>
<div class="paragraph">
<p>In order to open a reverse connection with <code>UaServer</code>, you can use <code>UaServer.addReverseConnection(String clientServerEndpointUrl, String endpointUrlForClientConnection)</code>. To remove previously added reverse connections you can use <code>UaServer.removeReverseConnection(String clientServerEndpointUrl, String endpointUrlForClientConnection)</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Reverse connections can be added while the server is running, however in order to remove them the server must be shut down (see <code>removeReverseConnection</code> javadocs for more information).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>clientServerEndpointUrl</code> must be in the EndpointUrl format, for example <code>opc.tcp://client_hostname_or_ip:port</code>. The <code>endpointUrlForClientConnection</code> must be a suitable EndpointUrl, which the client will need to finalize the connection. After <code>UaServer.init()</code>, assuming you have only bound single network interface, the following should find a suitable one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> endpointUrlForClientConnection = <span class="predefined-constant">null</span>;
<span class="keyword">for</span> (EndpointDescription ed : uaServer.getEndpoints()) {
  <span class="keyword">if</span> (ed.getEndpointUrl().startsWith(<span class="string"><span class="delimiter">&quot;</span><span class="content">opc.tcp</span><span class="delimiter">&quot;</span></span>)) {
    <span class="keyword">if</span> (endpointUrlForClientConnection == <span class="predefined-constant">null</span>) {
      endpointUrlForClientConnection = ed.getEndpointUrl();
    } <span class="keyword">else</span> {
      <span class="keyword">if</span> (!endpointUrlForClientConnection.equals(ed.getEndpointUrl())) {
        logger.warn(<span class="string"><span class="delimiter">&quot;</span><span class="content">Found more than one EndpointUrl for opc.tcp, using one of them</span><span class="delimiter">&quot;</span></span>);
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2019-03-21 19:45:15 EET
</div>
</div>
</body>
</html>